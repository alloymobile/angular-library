<!-- app/pages/organ/crud-demo/crud-demo.html -->

<div class="container py-4">
  <h3 class="text-center mb-3">TdCrud</h3>

  <!-- Tabs -->
  <ul class="nav nav-tabs justify-content-center mb-3">
    <li class="nav-item">
      <button
        class="nav-link"
        [class.active]="activeTab() === 'Table'"
        (click)="setActiveTab('Table')">
        Table
      </button>
    </li>

    <li class="nav-item">
      <button
        class="nav-link"
        [class.active]="activeTab() === 'Card'"
        (click)="setActiveTab('Card')">
        Card
      </button>
    </li>
  </ul>

  <!-- Table Panel -->
  @if (activeTab() === 'Table') {
    <div class="card p-3 mb-4">
      <h5 class="mb-3 text-center">TdCrud — Table view</h5>

      <!-- Usage snippet -->
      <div class="row mb-3">
        <div class="col-12 d-flex align-items-center justify-content-center">
          <pre class="bg-light text-dark border rounded-3 p-3 small mb-0">
            <code>{{ usageSnippet() }}</code>
          </pre>
        </div>
      </div>

      <!-- Live preview -->
      <div class="row mb-4">
        <div class="col-12">
          <td-crud [crud]="crudModelTable()" (output)="handleTableOutput($event)"></td-crud>

          <div class="small text-secondary mt-2 text-center">
            <strong>Search</strong> uses <code>TdSearch</code> with debounced
            input and emits <code>type="crud"</code>,
            <code>action="search"</code> or <code>"clear"</code>.
            <br />
            <strong>Add</strong> and <strong>Edit</strong> use the shared form
            modal; <strong>Delete</strong> uses the toast confirmation modal.
            <br />
            <strong>Pagination</strong> emits
            <code>action="page"</code> with <code>pageNumber</code>.
          </div>
        </div>
      </div>

      <!-- JSON in / JSON out -->
      <div class="row g-3 align-items-stretch">
        <!-- Left: Input JSON -->
        <div class="col-12 col-lg-6">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="fw-semibold">
              Table Crud Input JSON (editable)
            </span>
            <div class="d-flex gap-2">
              <button
                type="button"
                class="btn btn-sm btn-outline-secondary"
                (click)="resetTable()">
                Reset
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline-secondary"
                (click)="formatTable()"
                title="Format JSON">
                <i
                  class="fa-solid fa-wand-magic-sparkles me-2"
                  aria-hidden="true"></i>
                Format
              </button>
            </div>
          </div>

          <textarea
            class="form-control font-monospace"
            [class.is-invalid]="parseErrorTable()"
            rows="22"
            [ngModel]="jsonTable()"
            (ngModelChange)="onJsonTableChange($event)"
            spellcheck="false">
          </textarea>
          @if (parseErrorTable()) {
            <div class="invalid-feedback d-block mt-1">{{ parseErrorTable() }}</div>
          }

          <div class="form-text">
            Required pieces:
            <ul class="mb-0 ps-3">
              <li>
                <code>type</code>: <code>"table"</code> or
                <code>"card"</code>.
              </li>
              <li>
                <code>modal.submit.name</code>,
                <code>modal.fields[].name</code>.
              </li>
              <li>
                <code>toast</code> for delete confirmation using
                <code>TdModalToast</code>.
              </li>
              <li>
                <code>search.name</code> for <code>TdSearch</code>.
              </li>
              <li>
                For <code>table</code>, <code>document.rows[].id</code> and row
                keys that match <code>modal.fields[].name</code>.
              </li>
              <li>
                For <code>card</code>, ensure each card carries values keyed by
                <code>modal.fields[].name</code>.
              </li>
            </ul>
          </div>
        </div>

        <!-- Right: Output JSON -->
        <div class="col-12 col-lg-6">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="fw-semibold">
              Output (from <code>output</code> callback)
            </span>
            <button
              type="button"
              class="btn btn-sm btn-outline-danger"
              (click)="clearTableOutput()">
              Clear
            </button>
          </div>

          <textarea
            class="form-control font-monospace"
            rows="22"
            [ngModel]="outputTable()"
            spellcheck="false"
            readonly>
          </textarea>

          <div class="form-text">
            Typical events:
            <ul class="mb-0 ps-3">
              <li>
                Search:
                <pre class="mb-0 mt-1 small">{{
'{
  "id": "...",
  "type": "crud",
  "action": "search",
  "error": false,
  "data": {
    "vendorSearch": "alpha"
  }
}'
                }}</pre>
              </li>
              <li class="mt-2">
                Sort:
                <pre class="mb-0 mt-1 small">{{
'{
  "id": "...",
  "type": "crud",
  "action": "sort",
  "error": false,
  "data": {
    "email": "asc"
  }
}'
                }}</pre>
              </li>
              <li class="mt-2">
                Create vendor:
                <pre class="mb-0 mt-1 small">{{
'{
  "id": "...",
  "type": "crud",
  "action": "create",
  "error": false,
  "data": {
    "id": "",
    "vendorName": "New Vendor Inc.",
    "email": "new@vendor.com",
    "city": "Toronto",
    "status": "active"
  }
}'
                }}</pre>
              </li>
              <li class="mt-2">
                Delete vendor (via toast confirm):
                <pre class="mb-0 mt-1 small">{{
'{
  "id": "...",
  "type": "crud",
  "action": "delete",
  "error": false,
  "data": {
    "id": "v001"
  }
}'
                }}</pre>
              </li>
              <li class="mt-2">
                Page navigation:
                <pre class="mb-0 mt-1 small">{{
'{
  "id": "...",
  "type": "crud",
  "action": "page",
  "error": false,
  "data": {
    "pageNumber": 1
  }
}'
                }}</pre>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Card Panel -->
  @if (activeTab() === 'Card') {
    <div class="card p-3 mb-4">
      <h5 class="mb-3 text-center">TdCrud — Card view</h5>

      <!-- Usage snippet -->
      <div class="row mb-3">
        <div class="col-12 d-flex align-items-center justify-content-center">
          <pre class="bg-light text-dark border rounded-3 p-3 small mb-0">
            <code>{{ usageSnippet() }}</code>
          </pre>
        </div>
      </div>

      <!-- Live preview -->
      <div class="row mb-4">
        <div class="col-12">
          <td-crud [crud]="crudModelCard()" (output)="handleCardOutput($event)"></td-crud>

          <div class="small text-secondary mt-2 text-center">
            <strong>Search</strong> uses <code>TdSearch</code> with debounced
            input and emits <code>type="crud"</code>,
            <code>action="search"</code> or <code>"clear"</code>.
            <br />
            <strong>Add</strong> and <strong>Edit</strong> use the shared form
            modal; <strong>Delete</strong> uses the toast confirmation modal.
            <br />
            <strong>Pagination</strong> emits
            <code>action="page"</code> with <code>pageNumber</code>.
          </div>
        </div>
      </div>

      <!-- JSON in / JSON out -->
      <div class="row g-3 align-items-stretch">
        <!-- Left: Input JSON -->
        <div class="col-12 col-lg-6">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="fw-semibold">
              Card Crud Input JSON (editable)
            </span>
            <div class="d-flex gap-2">
              <button
                type="button"
                class="btn btn-sm btn-outline-secondary"
                (click)="resetCard()">
                Reset
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline-secondary"
                (click)="formatCard()"
                title="Format JSON">
                <i
                  class="fa-solid fa-wand-magic-sparkles me-2"
                  aria-hidden="true"></i>
                Format
              </button>
            </div>
          </div>

          <textarea
            class="form-control font-monospace"
            [class.is-invalid]="parseErrorCard()"
            rows="22"
            [ngModel]="jsonCard()"
            (ngModelChange)="onJsonCardChange($event)"
            spellcheck="false">
          </textarea>
          @if (parseErrorCard()) {
            <div class="invalid-feedback d-block mt-1">{{ parseErrorCard() }}</div>
          }

          <div class="form-text">
            Required pieces:
            <ul class="mb-0 ps-3">
              <li>
                <code>type</code>: <code>"table"</code> or
                <code>"card"</code>.
              </li>
              <li>
                <code>modal.submit.name</code>,
                <code>modal.fields[].name</code>.
              </li>
              <li>
                <code>toast</code> for delete confirmation using
                <code>TdModalToast</code>.
              </li>
              <li>
                <code>search.name</code> for <code>TdSearch</code>.
              </li>
              <li>
                For <code>table</code>, <code>document.rows[].id</code> and row
                keys that match <code>modal.fields[].name</code>.
              </li>
              <li>
                For <code>card</code>, ensure each card carries values keyed by
                <code>modal.fields[].name</code>.
              </li>
            </ul>
          </div>
        </div>

        <!-- Right: Output JSON -->
        <div class="col-12 col-lg-6">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="fw-semibold">
              Output (from <code>output</code> callback)
            </span>
            <button
              type="button"
              class="btn btn-sm btn-outline-danger"
              (click)="clearCardOutput()">
              Clear
            </button>
          </div>

          <textarea
            class="form-control font-monospace"
            rows="22"
            [ngModel]="outputCard()"
            spellcheck="false"
            readonly>
          </textarea>

          <div class="form-text">
            Typical events:
            <ul class="mb-0 ps-3">
              <li>
                Search:
                <pre class="mb-0 mt-1 small">{{
'{
  "id": "...",
  "type": "crud",
  "action": "search",
  "error": false,
  "data": {
    "vendorSearchCard": "alpha"
  }
}'
                }}</pre>
              </li>
              <li class="mt-2">
                Edit card:
                <pre class="mb-0 mt-1 small">{{
'{
  "id": "...",
  "type": "crud",
  "action": "editinit",
  "error": false,
  "data": {
    "id": "v001",
    "vendorName": "Alpha Precast Ltd.",
    "email": "info@alphaprecast.com",
    "city": "Toronto",
    "status": "active"
  }
}'
                }}</pre>
              </li>
              <li class="mt-2">
                Create vendor:
                <pre class="mb-0 mt-1 small">{{
'{
  "id": "...",
  "type": "crud",
  "action": "create",
  "error": false,
  "data": {
    "id": "",
    "vendorName": "New Vendor Inc.",
    "email": "new@vendor.com",
    "city": "Toronto",
    "status": "active"
  }
}'
                }}</pre>
              </li>
              <li class="mt-2">
                Delete vendor (via toast confirm):
                <pre class="mb-0 mt-1 small">{{
'{
  "id": "...",
  "type": "crud",
  "action": "delete",
  "error": false,
  "data": {
    "id": "v001"
  }
}'
                }}</pre>
              </li>
              <li class="mt-2">
                Page navigation:
                <pre class="mb-0 mt-1 small">{{
'{
  "id": "...",
  "type": "crud",
  "action": "page",
  "error": false,
  "data": {
    "pageNumber": 1
  }
}'
                }}</pre>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  }
</div>