-- ============================================================================
-- ULOC and ILOC MVP 1 - IBM DB2 Database Scripts
-- Script: 05_foreign_keys.sql
-- Purpose: Foreign Key constraint definitions
-- Author: Database Administrator
-- Created: 2026-01-26
-- Note: Run this script AFTER all tables are created
-- ============================================================================

SET CURRENT SCHEMA = 'RATEMGMT';

-- ============================================================================
-- MASTER TABLE FOREIGN KEYS
-- ============================================================================

-- CATEGORY -> PRODUCT
ALTER TABLE CATEGORY
    ADD CONSTRAINT FK_CATEGORY_PRODUCT
    FOREIGN KEY (PRODUCT_ID)
    REFERENCES PRODUCT (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

-- SUB_CATEGORY -> CATEGORY
ALTER TABLE SUB_CATEGORY
    ADD CONSTRAINT FK_SUBCAT_CATEGORY
    FOREIGN KEY (CATEGORY_ID)
    REFERENCES CATEGORY (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

-- CVP_CODE -> SUB_CATEGORY
ALTER TABLE CVP_CODE
    ADD CONSTRAINT FK_CVP_SUBCATEGORY
    FOREIGN KEY (SUB_CATEGORY_ID)
    REFERENCES SUB_CATEGORY (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

-- AMOUNT_TIER -> PRODUCT
ALTER TABLE AMOUNT_TIER
    ADD CONSTRAINT FK_TIER_PRODUCT
    FOREIGN KEY (PRODUCT_ID)
    REFERENCES PRODUCT (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

-- ============================================================================
-- RATE_ILOC_DRAFT FOREIGN KEYS
-- ============================================================================

ALTER TABLE RATE_ILOC_DRAFT
    ADD CONSTRAINT FK_ILOC_DRF_TIER
    FOREIGN KEY (AMOUNT_TIER_ID)
    REFERENCES AMOUNT_TIER (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ILOC_DRAFT
    ADD CONSTRAINT FK_ILOC_DRF_SUBCAT
    FOREIGN KEY (SUB_CATEGORY_ID)
    REFERENCES SUB_CATEGORY (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ILOC_DRAFT
    ADD CONSTRAINT FK_ILOC_DRF_NOTIF
    FOREIGN KEY (NOTIFICATION_ID)
    REFERENCES NOTIFICATION (ID)
    ON DELETE SET NULL
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ILOC_DRAFT
    ADD CONSTRAINT FK_ILOC_DRF_WORKFLOW
    FOREIGN KEY (WORKFLOW_ID)
    REFERENCES WORKFLOW (ID)
    ON DELETE SET NULL
    ON UPDATE RESTRICT;

-- ============================================================================
-- RATE_ILOC_ACTIVE FOREIGN KEYS
-- ============================================================================

ALTER TABLE RATE_ILOC_ACTIVE
    ADD CONSTRAINT FK_ILOC_ACT_TIER
    FOREIGN KEY (AMOUNT_TIER_ID)
    REFERENCES AMOUNT_TIER (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ILOC_ACTIVE
    ADD CONSTRAINT FK_ILOC_ACT_SUBCAT
    FOREIGN KEY (SUB_CATEGORY_ID)
    REFERENCES SUB_CATEGORY (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ILOC_ACTIVE
    ADD CONSTRAINT FK_ILOC_ACT_NOTIF
    FOREIGN KEY (NOTIFICATION_ID)
    REFERENCES NOTIFICATION (ID)
    ON DELETE SET NULL
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ILOC_ACTIVE
    ADD CONSTRAINT FK_ILOC_ACT_WORKFLOW
    FOREIGN KEY (WORKFLOW_ID)
    REFERENCES WORKFLOW (ID)
    ON DELETE SET NULL
    ON UPDATE RESTRICT;

-- ============================================================================
-- RATE_ILOC_HISTORY FOREIGN KEYS
-- ============================================================================

ALTER TABLE RATE_ILOC_HISTORY
    ADD CONSTRAINT FK_ILOC_HST_TIER
    FOREIGN KEY (AMOUNT_TIER_ID)
    REFERENCES AMOUNT_TIER (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ILOC_HISTORY
    ADD CONSTRAINT FK_ILOC_HST_SUBCAT
    FOREIGN KEY (SUB_CATEGORY_ID)
    REFERENCES SUB_CATEGORY (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ILOC_HISTORY
    ADD CONSTRAINT FK_ILOC_HST_NOTIF
    FOREIGN KEY (NOTIFICATION_ID)
    REFERENCES NOTIFICATION (ID)
    ON DELETE SET NULL
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ILOC_HISTORY
    ADD CONSTRAINT FK_ILOC_HST_WORKFLOW
    FOREIGN KEY (WORKFLOW_ID)
    REFERENCES WORKFLOW (ID)
    ON DELETE SET NULL
    ON UPDATE RESTRICT;

-- ============================================================================
-- RATE_ULOC_DRAFT FOREIGN KEYS
-- ============================================================================

ALTER TABLE RATE_ULOC_DRAFT
    ADD CONSTRAINT FK_ULOC_DRF_CVP
    FOREIGN KEY (CVP_CODE_ID)
    REFERENCES CVP_CODE (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ULOC_DRAFT
    ADD CONSTRAINT FK_ULOC_DRF_TIER
    FOREIGN KEY (AMOUNT_TIER_ID)
    REFERENCES AMOUNT_TIER (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ULOC_DRAFT
    ADD CONSTRAINT FK_ULOC_DRF_NOTIF
    FOREIGN KEY (NOTIFICATION_ID)
    REFERENCES NOTIFICATION (ID)
    ON DELETE SET NULL
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ULOC_DRAFT
    ADD CONSTRAINT FK_ULOC_DRF_WORKFLOW
    FOREIGN KEY (WORKFLOW_ID)
    REFERENCES WORKFLOW (ID)
    ON DELETE SET NULL
    ON UPDATE RESTRICT;

-- ============================================================================
-- RATE_ULOC_ACTIVE FOREIGN KEYS
-- ============================================================================

ALTER TABLE RATE_ULOC_ACTIVE
    ADD CONSTRAINT FK_ULOC_ACT_CVP
    FOREIGN KEY (CVP_CODE_ID)
    REFERENCES CVP_CODE (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ULOC_ACTIVE
    ADD CONSTRAINT FK_ULOC_ACT_TIER
    FOREIGN KEY (AMOUNT_TIER_ID)
    REFERENCES AMOUNT_TIER (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ULOC_ACTIVE
    ADD CONSTRAINT FK_ULOC_ACT_NOTIF
    FOREIGN KEY (NOTIFICATION_ID)
    REFERENCES NOTIFICATION (ID)
    ON DELETE SET NULL
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ULOC_ACTIVE
    ADD CONSTRAINT FK_ULOC_ACT_WORKFLOW
    FOREIGN KEY (WORKFLOW_ID)
    REFERENCES WORKFLOW (ID)
    ON DELETE SET NULL
    ON UPDATE RESTRICT;

-- ============================================================================
-- RATE_ULOC_HISTORY FOREIGN KEYS
-- ============================================================================

ALTER TABLE RATE_ULOC_HISTORY
    ADD CONSTRAINT FK_ULOC_HST_CVP
    FOREIGN KEY (CVP_CODE_ID)
    REFERENCES CVP_CODE (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ULOC_HISTORY
    ADD CONSTRAINT FK_ULOC_HST_TIER
    FOREIGN KEY (AMOUNT_TIER_ID)
    REFERENCES AMOUNT_TIER (ID)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ULOC_HISTORY
    ADD CONSTRAINT FK_ULOC_HST_NOTIF
    FOREIGN KEY (NOTIFICATION_ID)
    REFERENCES NOTIFICATION (ID)
    ON DELETE SET NULL
    ON UPDATE RESTRICT;

ALTER TABLE RATE_ULOC_HISTORY
    ADD CONSTRAINT FK_ULOC_HST_WORKFLOW
    FOREIGN KEY (WORKFLOW_ID)
    REFERENCES WORKFLOW (ID)
    ON DELETE SET NULL
    ON UPDATE RESTRICT;

-- ============================================================================
-- END OF SCRIPT
-- ============================================================================
