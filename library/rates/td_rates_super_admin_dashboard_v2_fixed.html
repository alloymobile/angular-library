<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TD Bank - ULOC Super Admin Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --td-green:#008A00;
      --td-green-dark:#006B00;
      --td-green-weak:#E8F5E9;

      --bg:#ffffff;
      --panel:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;

      --blue:#2563eb;
      --blue-weak:#e8f0ff;

      --shadow:0 1px 3px rgba(0,0,0,0.06);
      --transition:.15s ease;
    }

    body{
      font-family:'DM Sans',system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }

    /* Sidebar */
    .sidebar{
      position:fixed; left:0; top:0;
      width:68px; height:100vh;
      background:#1a1d21;
      display:flex; flex-direction:column;
      z-index:1000;
    }
    .sidebar-brand{
      min-height:64px;
      border-bottom:1px solid rgba(255,255,255,0.1);
      display:flex; align-items:center; justify-content:center;
      padding:16px;
    }
    .brand-icon{
      width:36px; height:36px; border-radius:10px;
      background:var(--td-green);
      color:#fff; font-weight:900;
      display:flex; align-items:center; justify-content:center;
      letter-spacing:0.2px;
    }
    .sidebar-nav{ padding:14px 8px; flex:1; }
    .nav-item{
      position:relative;
      display:flex; flex-direction:column; align-items:center; gap:4px;
      padding:12px 8px; border-radius:10px;
      color:rgba(255,255,255,0.75);
      text-decoration:none;
      transition:all var(--transition);
      margin-bottom:4px;
    }
    .sidebar .nav-item:hover{ background:#2d3136; color:#fff; }
    .sidebar .nav-item.active{ background:var(--td-green); color:#fff; }
    .sidebar .nav-item i{ font-size:18px; }
    .nav-item span{ display:none; }
    .nav-item[data-title]::after{
      content:attr(data-title);
      position:absolute; left:74px; top:50%;
      transform:translateY(-50%);
      background:rgba(0,0,0,0.85);
      color:#fff; font-size:12px; font-weight:700;
      padding:6px 10px; border-radius:10px;
      opacity:0; pointer-events:none;
      transition:opacity var(--transition);
      white-space:nowrap;
    }
    .sidebar .nav-item:hover::after{ opacity:1; }

    .sidebar-footer{
      padding:12px;
      border-top:1px solid rgba(255,255,255,0.1);
      display:flex; justify-content:center;
    }
    .user-avatar{
      width:36px; height:36px; border-radius:999px;
      background:linear-gradient(135deg,#667eea,#764ba2);
      color:#fff; font-weight:800;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
      transition:transform var(--transition);
    }
    .user-avatar:hover{ transform:scale(1.05); }

    /* Main */
    .main{ margin-left:68px; min-height:100vh; }

    /* Top header */
    .top-header{
      position:sticky; top:0; z-index:100;
      background:var(--panel);
      border-bottom:1px solid var(--border);
      padding:14px 24px;
      display:flex; align-items:center; justify-content:space-between;
      gap:16px;
    }
    .title{
      display:flex; flex-direction:column; gap:2px;
      min-width:280px;
    }
    .title h1{
      margin:0;
      font-size:18px; font-weight:900; letter-spacing:0.2px;
      display:flex; align-items:center; gap:10px;
    }
    .title small{
      color:var(--muted);
      font-weight:700;
      font-size:12px;
    }

    .header-actions{
      display:flex; align-items:center; gap:10px;
      min-width:240px; justify-content:flex-end;
    }
    .btn-icon{
      width:40px; height:40px;
      border:none; background:transparent;
      border-radius:12px;
      color:#4b5563;
      display:flex; align-items:center; justify-content:center;
      transition:all var(--transition);
      position:relative;
    }
    .btn-icon:hover{ background:#f5f6f7; color:#111827; }
    .dot{
      position:absolute; right:10px; top:10px;
      width:8px; height:8px; border-radius:50%;
      background:#dc2626; display:none;
    }
    .btn-icon.has-dot .dot{ display:block; }

    /* Content container */
    .content{ padding:18px 24px 26px; }

    /* Page tabs */
    .page-tabs{ background:transparent; border:none; border-radius:0; box-shadow:none; padding:0; margin-bottom:14px; }
    .page-tabs .nav{ gap:0; flex-wrap:wrap; justify-content:flex-start; border-bottom:1px solid var(--border); }
    .page-tabs .nav-link{
      border:none;
      border-bottom:3px solid transparent;
      border-radius:0;
      padding:10px 14px;
      font-weight:900;
      font-size:13px;
      color:#374151;
      display:flex;
      align-items:center;
      gap:10px;
      transition:all var(--transition);
      user-select:none;
      background:transparent;
    }
    .page-tabs .nav-link:hover{ background:transparent; color:#111827; border-bottom-color:var(--blue); }
    .page-tabs .nav-item:hover{ background:transparent; }
    .page-tabs .nav-link.active{ background:transparent; color:#111827; border-bottom-color:var(--blue); box-shadow:none; }

    /* KPI cards */
    .kpi-row{ margin-bottom:14px; }
    .kpi-card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:var(--shadow);
      padding:16px 16px;
      display:flex;
      align-items:center;
      gap:14px;
      min-height:92px;
    }
    .kpi-ico{
      width:46px; height:46px;
      border-radius:16px;
      display:flex; align-items:center; justify-content:center;
      font-size:18px;
      font-weight:900;
      flex:0 0 auto;
    }
    .kpi-ico.green{ background:#E8F5E9; color:var(--td-green); }
    .kpi-ico.blue{ background:#E8F0FF; color:var(--blue); }
    .kpi-ico.amber{ background:#FEF3C7; color:#B45309; }
    .kpi-ico.purple{ background:#F3E8FF; color:#7C3AED; }

    .kpi-meta{ flex:1; min-width:0; }
    .kpi-title{
      color:#6b7280;
      font-weight:900;
      font-size:12px;
      letter-spacing:0.2px;
      margin-bottom:2px;
      text-transform:uppercase;
    }
    .kpi-value{
      font-weight:900;
      font-size:22px;
      line-height:1.05;
      margin:0;
      color:#111827;
    }
    .kpi-sub{
      margin-top:4px;
      color:#9ca3af;
      font-weight:800;
      font-size:12px;
    }

    /* Filter Bar */
    .filter-bar{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:var(--shadow);
      padding:14px 14px;
      margin-bottom:14px;
    }

    .filter-top{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .filter-title{
      display:flex; align-items:center; gap:10px;
      font-weight:900; font-size:14px;
    }
    .clear-all{
      color:var(--td-green);
      font-weight:900;
      text-decoration:none;
      font-size:13px;
      cursor:pointer;
    }
    .clear-all:hover{ text-decoration:underline; }

    .field-label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.4px;
      color:#6b7280;
      font-weight:900;
      margin-bottom:6px;
    }

    .control{
      width:100%;
      padding:9px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#fff;
      font-size:13px;
      font-weight:700;
      color:#111827;
      transition:all var(--transition);
    }
    .control:focus{
      outline:none;
      border-color:var(--td-green);
      box-shadow:0 0 0 3px var(--td-green-weak);
    }

    .search-wrap{ position:relative; }
    .search-wrap i{
      position:absolute; left:14px; top:50%;
      transform:translateY(-50%);
      color:#9ca3af;
    }
    .search-wrap input{ padding-left:40px; }

    /* Multi select */
    .multi-select{ position:relative; }
    .multi-btn{
      width:100%;
      display:flex; align-items:center; justify-content:space-between;
      padding:9px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#fff;
      font-size:13px;
      font-weight:800;
      cursor:pointer;
      transition:all var(--transition);
      user-select:none;
    }
    .multi-btn:hover{ border-color:#d1d5db; background:#fafafa; }
    .multi-btn.disabled{
      background:#fafafa;
      color:var(--muted);
      cursor:not-allowed;
    }
    .multi-menu{
      position:absolute;
      left:0; top:calc(100% + 8px);
      width:100%;
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:0 12px 28px rgba(0,0,0,0.12);
      padding:10px;
      z-index:200;
      display:none;
      max-height:240px;
      overflow:auto;
    }
    .multi-menu.open{ display:block; }
    .multi-item{
      display:flex; align-items:center; gap:10px;
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      user-select:none;
    }
    .multi-item:hover{ background:#f6f7f8; }
    .multi-item input{
      width:16px; height:16px;
      accent-color:var(--td-green);
      cursor:pointer;
    }
    .multi-item span{ font-weight:800; font-size:13px; }

    .hint{
      color:#9ca3af;
      font-size:12px;
      font-weight:700;
      margin-top:8px;
    }

    /* Table area */
    .table-card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    .table-toolbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding:12px 14px;
      border-bottom:1px solid var(--border);
      background:#fff;
      flex-wrap:wrap;
    }

    .toolbar-left{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .toolbar-right{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      justify-content:flex-end;
    }

    .chip{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      padding:7px 10px;
      font-size:12px;
      font-weight:900;
      color:#111827;
      user-select:none;
    }
    .chip i{ color:#6b7280; }
    .chip strong{ color:var(--td-green); }

    .mini-btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#fff;
      color:#374151;
      font-weight:900;
      font-size:12px;
      cursor:pointer;
      transition:all var(--transition);
      user-select:none;
    }
    .mini-btn:hover{ background:#f5f6f7; border-color:#d1d5db; color:#111827; }
    .mini-btn.primary{
      background:var(--td-green);
      border-color:var(--td-green);
      color:#fff;
    }
    .mini-btn.primary:hover{
      background:var(--td-green-dark);
      border-color:var(--td-green-dark);
    }

    /* Rate table */
    .table-container{ overflow-x:auto; }
    table.rate-table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }
    .rate-table thead th{
      background:#fff;
      border-bottom:1px solid var(--border);
      color:#6b7280;
      font-weight:900;
      font-size:12px;
      padding:12px 12px;
      white-space:nowrap;
    }
    .rate-table thead th.tier{
      text-align:center;
      border-left:1px solid var(--border);
    }
    .rate-table thead .sub th{
      background:#fafafa;
      padding:8px 10px;
      font-size:11px;
      font-weight:900;
      border-bottom:1px solid var(--border);
    }

    .rate-table tbody td{
      padding:10px 12px;
      border-bottom:1px solid var(--border);
      vertical-align:middle;
      color:#111827;
    }
    .rate-table tbody tr:hover{ background:#fafbfc; }
    .rate-table tbody tr:last-child td{ border-bottom:none; }

    .select-cell{ width:54px; text-align:center; }
    .select-cell input{ width:18px; height:18px; accent-color:var(--td-green); cursor:pointer; }

    .cvp-cell{ font-weight:900; letter-spacing:0.2px; }

    .rate-cell{
      text-align:center;
      border-left:1px solid var(--border);
      min-width:60px;
      font-weight:900;
    }

    .current-pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px;
      border-radius:999px;
      background:#f3f4f6;
      color:#111827;
      font-size:12px;
      font-weight:900;
      white-space:nowrap;
    }
    .current-pill i{ color:#6b7280; }

    .new-input{
      width:86px;
      text-align:center;
      padding:7px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      font-weight:900;
      transition:all var(--transition);
      outline:none;
      background:#fff;
    }
    .new-input:focus{
      border-color:var(--blue);
      box-shadow:0 0 0 3px var(--blue-weak);
    }

    .disc-input{
      width:140px;
      padding:7px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      font-weight:800;
      transition:all var(--transition);
      outline:none;
      background:#fff;
    }
    .disc-input:focus{
      border-color:var(--blue);
      box-shadow:0 0 0 3px var(--blue-weak);
    }

    .changed{
      border-color:rgba(37,99,235,0.6)!important;
      box-shadow:0 0 0 3px rgba(37,99,235,0.12);
    }

    /* Row actions */
    .actions-cell{ width:190px; text-align:center; }
    .action-group{
      display:inline-flex;
      border:1px solid #9ca3af;
      border-radius:10px;
      overflow:hidden;
      background:#fff;
    }
    .action-btn{
      width:44px; height:36px;
      border:none;
      background:#fff;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
      transition:all var(--transition);
      color:#374151;
    }
    .action-btn + .action-btn{ border-left:1px solid #9ca3af; }
    .action-btn:hover{ background:#f5f6f7; color:#111827; }
    .action-btn.danger:hover{ background:#fee2e2; color:#991b1b; }

    /* Status pills */
    .status-pill{
      display:inline-flex; align-items:center; justify-content:center;
      padding:7px 12px;
      border-radius:999px;
      font-weight:900;
      font-size:12px;
      white-space:nowrap;
    }
    .status-active{ background:#dcfce7; color:#166534; }
    .status-expiring{ background:#fef3c7; color:#92400e; }
    .status-inactive{ background:#f3f4f6; color:#6b7280; }
    .status-approved{ background:#dcfce7; color:#166534; }
    .status-declined{ background:#fee2e2; color:#991b1b; }
    .status-pending{ background:#fef3c7; color:#92400e; }

    /* Pagination bar */
    .pager{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding:12px 14px;
      border-top:1px solid var(--border);
      background:#fff;
      flex-wrap:wrap;
    }
    .pager-left{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      color:#6b7280; font-weight:800; font-size:12px;
    }
    .pager-right{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pager-select{
      padding:8px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      font-weight:900;
      font-size:12px;
      color:#111827;
      background:#fff;
    }

    .page-controls{
      display:flex; align-items:center; gap:8px;
    }
    .page-btn{
      width:40px; height:36px;
      border:none;
      border-radius:12px;
      background:#e5e7eb;
      color:#374151;
      font-weight:900;
      cursor:pointer;
      transition:all var(--transition);
    }
    .page-btn:hover{ filter:brightness(0.95); }
    .page-pill{
      width:44px; height:36px;
      border-radius:12px;
      background:var(--td-green);
      color:#fff;
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
    }

    /* Tier hide */
    .tier-hidden{ display:none!important; }

    /* Toast */
    .toast-wrap{
      position:fixed;
      right:18px; bottom:18px;
      z-index:2000;
      display:flex; flex-direction:column; gap:10px;
      pointer-events:none;
    }
    .toast-lite{
      pointer-events:auto;
      min-width:320px;
      background:#111827;
      color:#fff;
      border-radius:14px;
      padding:12px 14px;
      box-shadow:0 12px 28px rgba(0,0,0,0.22);
      display:flex;
      align-items:flex-start;
      gap:12px;
      animation:slideIn .18s ease-out;
    }
    .toast-lite .tmeta{ flex:1; }
    .toast-lite .t1{ font-weight:900; font-size:13px; }
    .toast-lite .t2{ font-weight:700; font-size:12px; opacity:0.85; margin-top:2px; }
    .toast-lite button{
      border:none; background:transparent;
      color:rgba(255,255,255,0.8);
      cursor:pointer;
      padding:0;
    }
    .toast-lite button:hover{ color:#fff; }
    @keyframes slideIn{ from{ transform:translateY(10px); opacity:0 } to{ transform:translateY(0); opacity:1 } }

    /* Responsive */
    @media (max-width: 992px){
      .top-header{ flex-wrap:wrap; }
      .title{ min-width:auto; }
      .header-actions{ min-width:auto; }
    }
    @media (max-width: 576px){
      .content{ padding:14px 14px 22px; }
      .pager{ flex-direction:column; align-items:stretch; }
      .pager-right{ justify-content:space-between; }
    }

    /* Prime pill */
    .prime-pill{
      display:flex; align-items:center; gap:8px;
      padding:8px 10px;
      border:1px solid #e5e7eb;
      border-radius:999px;
      background:#fff;
      box-shadow:0 6px 16px rgba(15,23,42,.08);
      margin-right:8px;
    }
    .prime-label{ font-size:12px; font-weight:900; color:#6b7280; letter-spacing:.06em; text-transform:uppercase; }
    .prime-value{ font-size:14px; font-weight:900; color:#111827; }

    /* ---- Section visibility per tab ---- */
    .section-view,.section-status,.section-approve,.section-history{ display:none; }
    body.mode-view .section-view{ display:block; }
    body.mode-status .section-status{ display:block; }
    body.mode-approve .section-approve{ display:block; }
    body.mode-history .section-history{ display:block; }

    body.mode-view .section-grid,
    body.mode-status .section-grid,
    body.mode-approve .section-grid,
    body.mode-history .section-grid{ display:none; }

    /* Hide KPI cards except for Enter mode */
    body.mode-view .kpi-row,
    body.mode-status .kpi-row,
    body.mode-approve .kpi-row,
    body.mode-history .kpi-row{ display:none !important; }

    /* Hide Enter filter bar when not in Enter mode */
    body.mode-view .filter-bar-enter,
    body.mode-status .filter-bar-enter,
    body.mode-approve .filter-bar-enter,
    body.mode-history .filter-bar-enter{ display:none !important; }

    /* Show View filter bar only in View mode */
    .filter-bar-view{ display:none; }
    body.mode-view .filter-bar-view{ display:block; }

    /* View Rates table styles */
    .view-rate-table thead th.tier-header{
      text-align:center;
      border-left:1px solid var(--border);
      background:#f7f8fa;
    }
    .view-rate-table thead .tier-row th{
      padding:8px 10px;
      font-size:11px;
      background:#f1f3f5;
      font-weight:700;
      border-bottom:1px solid var(--border);
    }
    .view-rate-table .rate-cell{
      text-align:center;
      border-left:1px solid var(--border);
      min-width:64px;
      font-weight:600;
    }

    /* Compact table styles for Approve/Status/History */
    #statusTable .rate-cell,
    #approveTable .rate-cell,
    #historyTable .rate-cell{
      min-width:50px;
      font-size:11px;
      padding:6px 4px;
    }
    #statusTable thead th,
    #approveTable thead th,
    #historyTable thead th{
      font-size:11px;
      padding:10px 6px;
    }
    #statusTable tbody td,
    #approveTable tbody td,
    #historyTable tbody td{
      padding:8px 6px;
      font-size:12px;
    }

  </style>
</head>

<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-brand">
      <div class="brand-icon">TD</div>
    </div>

    <nav class="sidebar-nav">
      <a href="#" class="nav-item active" data-title="ULOC"><i class="fas fa-credit-card"></i><span>ULOC</span></a>
      <a href="#" class="nav-item" data-title="ILOC"><i class="fas fa-landmark"></i><span>ILOC</span></a>
    </nav>

    <div class="sidebar-footer">
      <div class="user-avatar" title="Profile">SA</div>
    </div>
  </aside>

  <main class="main">
    <!-- Header -->
    <header class="top-header">
      <div class="title">
        <h1><i class="fas fa-shield-halved" style="color: var(--blue)"></i> Super Admin Dashboard</h1>
        <small>Full access to view, enter, approve, and audit rates.</small>
      </div>

      <div class="header-actions">
        <div class="prime-pill" title="Prime Rate">
          <span class="prime-label">Prime</span>
          <span class="prime-value" id="primeRateTop">7.20%</span>
        </div>
        <button class="btn-icon has-dot" id="btnNotif" title="Notifications"><span class="dot"></span><i class="far fa-bell"></i></button>
        <button class="btn-icon has-dot" id="btnMsg" title="Messages"><span class="dot"></span><i class="far fa-comment-dots"></i></button>
        <button class="btn-icon" title="Help"><i class="far fa-circle-question"></i></button>
      </div>
    </header>

    <div class="content">
      <!-- PAGE TABS (5 tabs) -->
      <section class="page-tabs" aria-label="Rate pages">
        <ul class="nav nav-tabs" id="rateTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link" type="button" data-mode="view" role="tab" aria-selected="false"><i class="far fa-eye"></i> View Rates</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link active" type="button" data-mode="enter" role="tab" aria-selected="true"><i class="fas fa-pen-to-square"></i> Enter Rates</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" type="button" data-mode="status" role="tab" aria-selected="false"><i class="far fa-circle-check"></i> Approved Status</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" type="button" data-mode="approve" role="tab" aria-selected="false"><i class="fas fa-gavel"></i> Approve</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" type="button" data-mode="history" role="tab" aria-selected="false"><i class="far fa-clock"></i> History</button>
          </li>
        </ul>
      </section>

      <!-- KPI CARDS (only for Enter mode) -->
      <section class="kpi-row">
        <div class="row g-3 justify-content-center">
          <div class="col-12 col-md-6 col-xl-3">
            <div class="kpi-card">
              <div class="kpi-ico green"><i class="fas fa-percent"></i></div>
              <div class="kpi-meta">
                <div class="kpi-title">Prime Rate</div>
                <p class="kpi-value">7.20%</p>
                <div class="kpi-sub">Base reference</div>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-6 col-xl-3">
            <div class="kpi-card">
              <div class="kpi-ico blue"><i class="fas fa-pen"></i></div>
              <div class="kpi-meta">
                <div class="kpi-title">Rows Edited</div>
                <p class="kpi-value" id="kpiEditedCard">0</p>
                <div class="kpi-sub">Draft changes</div>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-6 col-xl-3">
            <div class="kpi-card">
              <div class="kpi-ico amber"><i class="fas fa-triangle-exclamation"></i></div>
              <div class="kpi-meta">
                <div class="kpi-title">Validation</div>
                <p class="kpi-value" id="kpiInvalidCard">0</p>
                <div class="kpi-sub">Needs attention</div>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-6 col-xl-3">
            <div class="kpi-card">
              <div class="kpi-ico purple"><i class="fas fa-layer-group"></i></div>
              <div class="kpi-meta">
                <div class="kpi-title">Batch</div>
                <p class="kpi-value">ULOC–JAN22</p>
                <div class="kpi-sub">Save Draft / Submit</div>
              </div>
            </div>
          </div>
        </div>
      </section>

<!-- ==================== VIEW RATES FILTER BAR ==================== -->
<section class="filter-bar filter-bar-view">
  <div class="filter-top">
    <div class="filter-title"><i class="fas fa-filter" style="color:#9ca3af"></i> Filters</div>
    <a class="clear-all" href="#" id="clearAllView">Clear all</a>
  </div>

  <div class="row g-3 align-items-end mb-1">
    <div class="col-12 col-lg-8 mx-lg-auto">
      <div class="field-label">Search</div>
      <div class="search-wrap">
        <i class="fas fa-search"></i>
        <input class="control" id="viewSearch" type="text" placeholder="Search CVP, subcategory, dates, rates..." />
      </div>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-12 col-lg-4">
      <div class="field-label">Category</div>
      <select class="control" id="viewCategorySelect">
        <option value="ALL" selected>All Categories</option>
        <option value="NEW_TO_BANK">New to Bank</option>
        <option value="STAFF">Staff</option>
        <option value="PROMOTION">Promotion</option>
        <option value="ALL_PROGRAMS">All Programs</option>
      </select>
      <div class="hint">Pick a category to narrow results.</div>
    </div>

    <div class="col-12 col-lg-4">
      <div class="field-label">Subcategory</div>
      <div class="multi-select" id="viewSubcategoryMulti">
        <button class="multi-btn disabled" id="viewSubcategoryBtn" type="button">
          <span id="viewSubcategoryBtnLabel">Select a category first</span>
          <i class="fas fa-chevron-down" style="color:#9ca3af"></i>
        </button>
        <div class="multi-menu" id="viewSubcategoryMenu"></div>
      </div>
      <div class="hint">If a category has no subcategories, stays disabled.</div>
    </div>

    <div class="col-12 col-lg-4">
      <div class="field-label">Amount Tiers</div>
      <div class="multi-select" id="viewTierMulti">
        <button class="multi-btn" id="viewTierBtn" type="button">
          <span id="viewTierBtnLabel">All tiers selected</span>
          <i class="fas fa-chevron-down" style="color:#9ca3af"></i>
        </button>
        <div class="multi-menu" id="viewTierMenu">
          <label class="multi-item"><input type="checkbox" class="viewTierCheck" value="T1" checked><span>&lt;5k</span></label>
          <label class="multi-item"><input type="checkbox" class="viewTierCheck" value="T2" checked><span>5–10k</span></label>
          <label class="multi-item"><input type="checkbox" class="viewTierCheck" value="T3" checked><span>10–15k</span></label>
          <label class="multi-item"><input type="checkbox" class="viewTierCheck" value="T4" checked><span>15–20k</span></label>
          <label class="multi-item"><input type="checkbox" class="viewTierCheck" value="T5" checked><span>&gt;20k</span></label>
        </div>
      </div>
      <div class="hint">Select tiers to show in the table.</div>
    </div>
  </div>
</section>

<!-- ==================== VIEW RATES TABLE (Target/Floor per tier) ==================== -->
<section class="table-card section-view" id="viewSection">
  <div class="table-toolbar">
    <div class="toolbar-left">
      <span class="chip"><i class="far fa-eye"></i> View Mode (Read-Only)</span>
    </div>
    <div class="toolbar-right">
      <button class="mini-btn" id="btnViewDownload"><i class="fas fa-download"></i> Download</button>
    </div>
  </div>

  <div class="table-container">
    <table class="rate-table view-rate-table" id="viewTable">
      <thead>
        <tr>
          <th rowspan="2">CVP</th>
          <th class="tier-header view-tier-T1" colspan="2">&lt;5k</th>
          <th class="tier-header view-tier-T2" colspan="2">5–10k</th>
          <th class="tier-header view-tier-T3" colspan="2">10–15k</th>
          <th class="tier-header view-tier-T4" colspan="2">15–20k</th>
          <th class="tier-header view-tier-T5" colspan="2">&gt;20k</th>
          <th rowspan="2">Eff. Date</th>
          <th rowspan="2">Expiry</th>
        </tr>
        <tr class="tier-row">
          <th class="tier-header view-tier-T1">Target</th>
          <th class="tier-header view-tier-T1">Floor</th>
          <th class="tier-header view-tier-T2">Target</th>
          <th class="tier-header view-tier-T2">Floor</th>
          <th class="tier-header view-tier-T3">Target</th>
          <th class="tier-header view-tier-T3">Floor</th>
          <th class="tier-header view-tier-T4">Target</th>
          <th class="tier-header view-tier-T4">Floor</th>
          <th class="tier-header view-tier-T5">Target</th>
          <th class="tier-header view-tier-T5">Floor</th>
        </tr>
      </thead>
      <tbody id="viewTbody">
        <tr data-category="ALL_PROGRAMS" data-subcategory="">
          <td class="cvp-cell">AAXX</td>
          <td class="rate-cell view-tier-T1">2.99</td><td class="rate-cell view-tier-T1">2.49</td>
          <td class="rate-cell view-tier-T2">2.99</td><td class="rate-cell view-tier-T2">2.49</td>
          <td class="rate-cell view-tier-T3">2.99</td><td class="rate-cell view-tier-T3">2.49</td>
          <td class="rate-cell view-tier-T4">2.99</td><td class="rate-cell view-tier-T4">2.49</td>
          <td class="rate-cell view-tier-T5">2.99</td><td class="rate-cell view-tier-T5">2.49</td>
          <td>2025-06-03</td>
          <td>—</td>
        </tr>
        <tr data-category="STAFF" data-subcategory="STF_CORE">
          <td class="cvp-cell">STF1</td>
          <td class="rate-cell view-tier-T1">2.50</td><td class="rate-cell view-tier-T1">2.10</td>
          <td class="rate-cell view-tier-T2">2.55</td><td class="rate-cell view-tier-T2">2.15</td>
          <td class="rate-cell view-tier-T3">2.60</td><td class="rate-cell view-tier-T3">2.20</td>
          <td class="rate-cell view-tier-T4">2.65</td><td class="rate-cell view-tier-T4">2.25</td>
          <td class="rate-cell view-tier-T5">2.70</td><td class="rate-cell view-tier-T5">2.30</td>
          <td>2025-06-01</td>
          <td>—</td>
        </tr>
        <tr data-category="NEW_TO_BANK" data-subcategory="NTB_NEW">
          <td class="cvp-cell">NEW1</td>
          <td class="rate-cell view-tier-T1">3.10</td><td class="rate-cell view-tier-T1">2.70</td>
          <td class="rate-cell view-tier-T2">3.10</td><td class="rate-cell view-tier-T2">2.70</td>
          <td class="rate-cell view-tier-T3">3.10</td><td class="rate-cell view-tier-T3">2.70</td>
          <td class="rate-cell view-tier-T4">3.10</td><td class="rate-cell view-tier-T4">2.70</td>
          <td class="rate-cell view-tier-T5">3.10</td><td class="rate-cell view-tier-T5">2.70</td>
          <td>2025-05-20</td>
          <td>—</td>
        </tr>
        <tr data-category="PROMOTION" data-subcategory="">
          <td class="cvp-cell">PRM9</td>
          <td class="rate-cell view-tier-T1">2.80</td><td class="rate-cell view-tier-T1">2.40</td>
          <td class="rate-cell view-tier-T2">2.85</td><td class="rate-cell view-tier-T2">2.45</td>
          <td class="rate-cell view-tier-T3">2.90</td><td class="rate-cell view-tier-T3">2.50</td>
          <td class="rate-cell view-tier-T4">2.95</td><td class="rate-cell view-tier-T4">2.55</td>
          <td class="rate-cell view-tier-T5">3.00</td><td class="rate-cell view-tier-T5">2.60</td>
          <td>2025-06-10</td>
          <td>2025-07-31</td>
        </tr>
        <tr data-category="STAFF" data-subcategory="STF_PREMIUM">
          <td class="cvp-cell">STF2</td>
          <td class="rate-cell view-tier-T1">2.45</td><td class="rate-cell view-tier-T1">2.05</td>
          <td class="rate-cell view-tier-T2">2.50</td><td class="rate-cell view-tier-T2">2.10</td>
          <td class="rate-cell view-tier-T3">2.55</td><td class="rate-cell view-tier-T3">2.15</td>
          <td class="rate-cell view-tier-T4">2.60</td><td class="rate-cell view-tier-T4">2.20</td>
          <td class="rate-cell view-tier-T5">2.65</td><td class="rate-cell view-tier-T5">2.25</td>
          <td>2025-06-05</td>
          <td>—</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pager">
    <div class="pager-left"><span id="viewPagerInfo">Showing 1–5 of 5</span></div>
    <div class="pager-right">
      <span style="color:#6b7280; font-weight:900; font-size:12px;">Rows</span>
      <select class="pager-select" id="viewRowsPerPage">
        <option value="5">5</option>
        <option value="10" selected>10</option>
        <option value="25">25</option>
      </select>
      <div class="page-controls">
        <button class="page-btn" id="viewBtnPrev" title="Prev"><i class="fas fa-chevron-left"></i></button>
        <div class="page-pill" id="viewPagePill">1</div>
        <button class="page-btn" id="viewBtnNext" title="Next"><i class="fas fa-chevron-right"></i></button>
      </div>
    </div>
  </div>
</section>

<!-- ==================== ENTER RATES FILTER BAR ==================== -->
<section class="filter-bar filter-bar-enter">
  <div class="filter-top">
    <div class="filter-title"><i class="fas fa-filter" style="color:#9ca3af"></i> Filters</div>
    <a class="clear-all" href="#" id="clearAll">Clear all</a>
  </div>

  <div class="row g-3 align-items-end mb-1">
    <div class="col-12 col-lg-8 mx-lg-auto">
      <div class="field-label">Search</div>
      <div class="search-wrap">
        <i class="fas fa-search"></i>
        <input class="control" id="globalSearch" type="text" placeholder="Search CVP, Current, New, Discretion, dates, status..." />
      </div>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-12 col-lg-3">
      <div class="field-label">Category</div>
      <select class="control" id="categorySelect">
        <option value="ALL" selected>All</option>
        <option value="STAFF">Staff</option>
        <option value="PROMO">Promotion</option>
        <option value="NTB">New to Bank</option>
      </select>
      <div class="hint">Choose a category to narrow the list.</div>
    </div>

    <div class="col-12 col-lg-3">
      <div class="field-label">Subcategory</div>
      <select class="control" id="subcategorySelect">
        <option value="ALL" selected>All subcategories</option>
      </select>
      <div class="hint" id="subHint">If a category has no subcategories, this stays disabled.</div>
    </div>

    <div class="col-12 col-lg-3">
      <div class="field-label">Status</div>
      <div class="multi-select" id="statusMulti">
        <button type="button" class="multi-btn" id="statusBtn">
          <span id="statusBtnLabel">All statuses selected</span>
          <i class="fas fa-chevron-down" style="color:#9ca3af"></i>
        </button>
        <div class="multi-menu" id="statusMenu">
          <label class="multi-item"><input type="checkbox" class="statusCheck" value="ACTIVE" checked><span>Active</span></label>
          <label class="multi-item"><input type="checkbox" class="statusCheck" value="EXPIRING" checked><span>Expiring</span></label>
          <label class="multi-item"><input type="checkbox" class="statusCheck" value="INACTIVE" checked><span>Inactive</span></label>
        </div>
      </div>
      <div class="hint">Select one or more statuses.</div>
    </div>

    <div class="col-12 col-lg-3">
      <div class="field-label">Amount Tiers</div>
      <div class="multi-select" id="tierMulti">
        <button type="button" class="multi-btn" id="tierBtn">
          <span id="tierBtnLabel">All tiers selected</span>
          <i class="fas fa-chevron-down" style="color:#9ca3af"></i>
        </button>
        <div class="multi-menu" id="tierMenu">
          <label class="multi-item"><input type="checkbox" class="tierCheck" value="T1" checked><span>&lt;5k</span></label>
          <label class="multi-item"><input type="checkbox" class="tierCheck" value="T2" checked><span>5–10k</span></label>
          <label class="multi-item"><input type="checkbox" class="tierCheck" value="T3" checked><span>10–15k</span></label>
          <label class="multi-item"><input type="checkbox" class="tierCheck" value="T4" checked><span>15–20k</span></label>
          <label class="multi-item"><input type="checkbox" class="tierCheck" value="T5" checked><span>&gt;20k</span></label>
        </div>
      </div>
      <div class="hint">Pick tiers to show in the grid.</div>
    </div>
  </div>
</section>

<!-- ==================== ENTER RATES TABLE ==================== -->
<section class="table-card section-grid" id="gridSection">
  <div class="table-toolbar">
    <div class="toolbar-left">
      <button class="mini-btn" id="btnCopyNewAcross"><i class="fas fa-wand-magic-sparkles"></i> Copy New Down</button>
      <button class="mini-btn" id="btnCopyDiscAcross"><i class="fas fa-copy"></i> Copy Discretion Down</button>
    </div>
    <div class="toolbar-right">
      <button class="mini-btn" id="btnUpload"><i class="fas fa-upload"></i> Upload</button>
      <button class="mini-btn" id="btnDownload"><i class="fas fa-download"></i> Download</button>
      <button class="mini-btn" id="btnEmail"><i class="fas fa-envelope"></i> Email</button>
      <button class="mini-btn" id="btnSaveDraft"><i class="fas fa-floppy-disk"></i> Save Draft</button>
      <button class="mini-btn primary" id="btnSubmit"><i class="fas fa-paper-plane"></i> Submit</button>
    </div>
  </div>

  <div class="table-container">
    <table class="rate-table" id="rateTable">
      <thead>
        <tr>
          <th rowspan="2" class="select-cell"><input type="checkbox" id="selectAll" title="Select all"></th>
          <th rowspan="2">CVP</th>
          <th colspan="3" class="tier tier-T1 tier-head">&lt;5k</th>
          <th colspan="3" class="tier tier-T2 tier-head">5–10k</th>
          <th colspan="3" class="tier tier-T3 tier-head">10–15k</th>
          <th colspan="3" class="tier tier-T4 tier-head">15–20k</th>
          <th colspan="3" class="tier tier-T5 tier-head">&gt;20k</th>
          <th rowspan="2">Eff. Date</th>
          <th rowspan="2">Expiry</th>
          <th rowspan="2">Status</th>
          <th rowspan="2">Actions</th>
        </tr>
        <tr class="sub">
          <th class="tier tier-T1">Current</th>
          <th class="tier tier-T1">New</th>
          <th class="tier tier-T1">Disc.</th>
          <th class="tier tier-T2">Current</th>
          <th class="tier tier-T2">New</th>
          <th class="tier tier-T2">Disc.</th>
          <th class="tier tier-T3">Current</th>
          <th class="tier tier-T3">New</th>
          <th class="tier tier-T3">Disc.</th>
          <th class="tier tier-T4">Current</th>
          <th class="tier tier-T4">New</th>
          <th class="tier tier-T4">Disc.</th>
          <th class="tier tier-T5">Current</th>
          <th class="tier tier-T5">New</th>
          <th class="tier tier-T5">Disc.</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr data-category="STAFF" data-subcategory="ALL" data-status="ACTIVE">
          <td class="select-cell"><input class="rowCheck" type="checkbox"></td>
          <td class="cvp-cell">STF1</td>
          <td class="rate-cell tier-T1"><span class="current-pill"><i class="fas fa-lock"></i> 2.50</span></td>
          <td class="rate-cell tier-T1"><input class="new-input" data-tier="T1" placeholder="—"></td>
          <td class="rate-cell tier-T1"><input class="disc-input" data-tier="T1" placeholder="—"></td>
          <td class="rate-cell tier-T2"><span class="current-pill"><i class="fas fa-lock"></i> 2.55</span></td>
          <td class="rate-cell tier-T2"><input class="new-input" data-tier="T2" placeholder="—"></td>
          <td class="rate-cell tier-T2"><input class="disc-input" data-tier="T2" placeholder="—"></td>
          <td class="rate-cell tier-T3"><span class="current-pill"><i class="fas fa-lock"></i> 2.60</span></td>
          <td class="rate-cell tier-T3"><input class="new-input" data-tier="T3" placeholder="—"></td>
          <td class="rate-cell tier-T3"><input class="disc-input" data-tier="T3" placeholder="—"></td>
          <td class="rate-cell tier-T4"><span class="current-pill"><i class="fas fa-lock"></i> 2.65</span></td>
          <td class="rate-cell tier-T4"><input class="new-input" data-tier="T4" placeholder="—"></td>
          <td class="rate-cell tier-T4"><input class="disc-input" data-tier="T4" placeholder="—"></td>
          <td class="rate-cell tier-T5"><span class="current-pill"><i class="fas fa-lock"></i> 2.70</span></td>
          <td class="rate-cell tier-T5"><input class="new-input" data-tier="T5" placeholder="—"></td>
          <td class="rate-cell tier-T5"><input class="disc-input" data-tier="T5" placeholder="—"></td>
          <td>2025-06-01</td>
          <td>—</td>
          <td><span class="status-pill status-active">Active</span></td>
          <td class="actions-cell">
            <div class="action-group">
              <button class="action-btn act-copy-new" title="Copy New"><i class="fas fa-arrows-left-right"></i></button>
              <button class="action-btn act-copy-disc" title="Copy Disc"><i class="fas fa-repeat"></i></button>
              <button class="action-btn danger act-delete" title="Delete"><i class="fas fa-trash"></i></button>
            </div>
          </td>
        </tr>
        <tr data-category="STAFF" data-subcategory="ALL" data-status="ACTIVE">
          <td class="select-cell"><input class="rowCheck" type="checkbox"></td>
          <td class="cvp-cell">STF2</td>
          <td class="rate-cell tier-T1"><span class="current-pill"><i class="fas fa-lock"></i> 2.45</span></td>
          <td class="rate-cell tier-T1"><input class="new-input" data-tier="T1" placeholder="—"></td>
          <td class="rate-cell tier-T1"><input class="disc-input" data-tier="T1" placeholder="—"></td>
          <td class="rate-cell tier-T2"><span class="current-pill"><i class="fas fa-lock"></i> 2.50</span></td>
          <td class="rate-cell tier-T2"><input class="new-input" data-tier="T2" placeholder="—"></td>
          <td class="rate-cell tier-T2"><input class="disc-input" data-tier="T2" placeholder="—"></td>
          <td class="rate-cell tier-T3"><span class="current-pill"><i class="fas fa-lock"></i> 2.55</span></td>
          <td class="rate-cell tier-T3"><input class="new-input" data-tier="T3" placeholder="—"></td>
          <td class="rate-cell tier-T3"><input class="disc-input" data-tier="T3" placeholder="—"></td>
          <td class="rate-cell tier-T4"><span class="current-pill"><i class="fas fa-lock"></i> 2.60</span></td>
          <td class="rate-cell tier-T4"><input class="new-input" data-tier="T4" placeholder="—"></td>
          <td class="rate-cell tier-T4"><input class="disc-input" data-tier="T4" placeholder="—"></td>
          <td class="rate-cell tier-T5"><span class="current-pill"><i class="fas fa-lock"></i> 2.65</span></td>
          <td class="rate-cell tier-T5"><input class="new-input" data-tier="T5" placeholder="—"></td>
          <td class="rate-cell tier-T5"><input class="disc-input" data-tier="T5" placeholder="—"></td>
          <td>2025-06-05</td>
          <td>—</td>
          <td><span class="status-pill status-active">Active</span></td>
          <td class="actions-cell">
            <div class="action-group">
              <button class="action-btn act-copy-new" title="Copy New"><i class="fas fa-arrows-left-right"></i></button>
              <button class="action-btn act-copy-disc" title="Copy Disc"><i class="fas fa-repeat"></i></button>
              <button class="action-btn danger act-delete" title="Delete"><i class="fas fa-trash"></i></button>
            </div>
          </td>
        </tr>
        <tr data-category="PROMO" data-subcategory="SPRING25" data-status="EXPIRING">
          <td class="select-cell"><input class="rowCheck" type="checkbox"></td>
          <td class="cvp-cell">PRM2</td>
          <td class="rate-cell tier-T1"><span class="current-pill"><i class="fas fa-lock"></i> 2.85</span></td>
          <td class="rate-cell tier-T1"><input class="new-input" data-tier="T1" placeholder="—"></td>
          <td class="rate-cell tier-T1"><input class="disc-input" data-tier="T1" placeholder="—"></td>
          <td class="rate-cell tier-T2"><span class="current-pill"><i class="fas fa-lock"></i> 2.90</span></td>
          <td class="rate-cell tier-T2"><input class="new-input" data-tier="T2" placeholder="—"></td>
          <td class="rate-cell tier-T2"><input class="disc-input" data-tier="T2" placeholder="—"></td>
          <td class="rate-cell tier-T3"><span class="current-pill"><i class="fas fa-lock"></i> 2.95</span></td>
          <td class="rate-cell tier-T3"><input class="new-input" data-tier="T3" placeholder="—"></td>
          <td class="rate-cell tier-T3"><input class="disc-input" data-tier="T3" placeholder="—"></td>
          <td class="rate-cell tier-T4"><span class="current-pill"><i class="fas fa-lock"></i> 3.00</span></td>
          <td class="rate-cell tier-T4"><input class="new-input" data-tier="T4" placeholder="—"></td>
          <td class="rate-cell tier-T4"><input class="disc-input" data-tier="T4" placeholder="—"></td>
          <td class="rate-cell tier-T5"><span class="current-pill"><i class="fas fa-lock"></i> 3.05</span></td>
          <td class="rate-cell tier-T5"><input class="new-input" data-tier="T5" placeholder="—"></td>
          <td class="rate-cell tier-T5"><input class="disc-input" data-tier="T5" placeholder="—"></td>
          <td>2025-06-10</td>
          <td>2025-07-31</td>
          <td><span class="status-pill status-expiring">Expiring</span></td>
          <td class="actions-cell">
            <div class="action-group">
              <button class="action-btn act-copy-new" title="Copy New"><i class="fas fa-arrows-left-right"></i></button>
              <button class="action-btn act-copy-disc" title="Copy Disc"><i class="fas fa-repeat"></i></button>
              <button class="action-btn danger act-delete" title="Delete"><i class="fas fa-trash"></i></button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pager">
    <div class="pager-left"><span id="pagerInfo">Showing 1–3 of 3</span></div>
    <div class="pager-right">
      <span style="color:#6b7280; font-weight:900; font-size:12px;">Rows</span>
      <select class="pager-select" id="rowsPerPage">
        <option value="5" selected>5</option>
        <option value="10">10</option>
        <option value="20">20</option>
      </select>
      <div class="page-controls">
        <button class="page-btn" id="btnPrev" title="Prev"><i class="fas fa-chevron-left"></i></button>
        <div class="page-pill" id="pagePill">1</div>
        <button class="page-btn" id="btnNext" title="Next"><i class="fas fa-chevron-right"></i></button>
      </div>
    </div>
  </div>
</section>

<!-- ==================== APPROVED STATUS TABLE (Full Row Records) ==================== -->
<section class="table-card section-status" id="statusSection">
  <div class="table-toolbar">
    <div class="toolbar-left">
      <span class="chip"><i class="fas fa-list-check"></i> Submissions & approval results</span>
    </div>
    <div class="toolbar-right">
      <button class="mini-btn" id="btnStatusDownload"><i class="fas fa-download"></i> Download</button>
    </div>
  </div>

  <div class="table-container">
    <table class="rate-table" id="statusTable">
      <thead>
        <tr>
          <th rowspan="2">CVP</th>
          <th class="tier tier-T1" colspan="2" style="text-align:center;border-left:1px solid var(--border);">&lt;5k</th>
          <th class="tier tier-T2" colspan="2" style="text-align:center;border-left:1px solid var(--border);">5–10k</th>
          <th class="tier tier-T3" colspan="2" style="text-align:center;border-left:1px solid var(--border);">10–15k</th>
          <th class="tier tier-T4" colspan="2" style="text-align:center;border-left:1px solid var(--border);">15–20k</th>
          <th class="tier tier-T5" colspan="2" style="text-align:center;border-left:1px solid var(--border);">&gt;20k</th>
          <th rowspan="2">Eff.</th>
          <th rowspan="2">Expiry</th>
          <th rowspan="2">Submitted</th>
          <th rowspan="2">Result</th>
          <th rowspan="2">Decision By</th>
          <th rowspan="2">Decision On</th>
          <th rowspan="2">Comment</th>
        </tr>
        <tr class="sub">
          <th class="tier tier-T1" style="border-left:1px solid var(--border);">Curr</th>
          <th class="tier tier-T1">Disc</th>
          <th class="tier tier-T2" style="border-left:1px solid var(--border);">Curr</th>
          <th class="tier tier-T2">Disc</th>
          <th class="tier tier-T3" style="border-left:1px solid var(--border);">Curr</th>
          <th class="tier tier-T3">Disc</th>
          <th class="tier tier-T4" style="border-left:1px solid var(--border);">Curr</th>
          <th class="tier tier-T4">Disc</th>
          <th class="tier tier-T5" style="border-left:1px solid var(--border);">Curr</th>
          <th class="tier tier-T5">Disc</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="cvp-cell">AAXX</td>
          <td class="rate-cell tier-T1">2.99</td><td class="rate-cell tier-T1">P-0.5</td>
          <td class="rate-cell tier-T2">2.99</td><td class="rate-cell tier-T2">P-0.5</td>
          <td class="rate-cell tier-T3">2.99</td><td class="rate-cell tier-T3">P-0.5</td>
          <td class="rate-cell tier-T4">2.99</td><td class="rate-cell tier-T4">P-0.5</td>
          <td class="rate-cell tier-T5">2.99</td><td class="rate-cell tier-T5">P-0.5</td>
          <td>06-10</td>
          <td>—</td>
          <td>06-08</td>
          <td><span class="status-pill status-approved">Approved</span></td>
          <td>approver1</td>
          <td>06-09</td>
          <td>OK</td>
        </tr>
        <tr>
          <td class="cvp-cell">STF1</td>
          <td class="rate-cell tier-T1">2.50</td><td class="rate-cell tier-T1">—</td>
          <td class="rate-cell tier-T2">2.55</td><td class="rate-cell tier-T2">—</td>
          <td class="rate-cell tier-T3">2.60</td><td class="rate-cell tier-T3">P-0.3</td>
          <td class="rate-cell tier-T4">2.65</td><td class="rate-cell tier-T4">P-0.3</td>
          <td class="rate-cell tier-T5">2.70</td><td class="rate-cell tier-T5">P-0.3</td>
          <td>06-15</td>
          <td>—</td>
          <td>06-08</td>
          <td><span class="status-pill status-declined">Declined</span></td>
          <td>approver1</td>
          <td>06-09</td>
          <td>Use standard margin</td>
        </tr>
        <tr>
          <td class="cvp-cell">STF9</td>
          <td class="rate-cell tier-T1">2.52</td><td class="rate-cell tier-T1">—</td>
          <td class="rate-cell tier-T2">2.57</td><td class="rate-cell tier-T2">—</td>
          <td class="rate-cell tier-T3">2.62</td><td class="rate-cell tier-T3">—</td>
          <td class="rate-cell tier-T4">2.67</td><td class="rate-cell tier-T4">—</td>
          <td class="rate-cell tier-T5">2.72</td><td class="rate-cell tier-T5">P-0.2</td>
          <td>06-12</td>
          <td>07-01</td>
          <td>06-09</td>
          <td><span class="status-pill status-pending">Pending</span></td>
          <td>—</td>
          <td>—</td>
          <td>—</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pager">
    <div class="pager-left"><span>Full row records with all tier data + approval metadata.</span></div>
    <div class="pager-right"><span style="color:#6b7280; font-weight:900; font-size:12px;">—</span></div>
  </div>
</section>

<!-- ==================== APPROVE TABLE (Full Row Records with Decision Controls) ==================== -->
<section class="table-card section-approve" id="approveSection">
  <div class="table-toolbar">
    <div class="toolbar-left">
      <span class="chip"><i class="fas fa-gavel"></i> Pending submissions for approval</span>
    </div>
    <div class="toolbar-right">
      <button class="mini-btn" id="btnApproveDownload"><i class="fas fa-download"></i> Download</button>
      <button class="mini-btn primary" id="btnApproveSubmit"><i class="fas fa-paper-plane"></i> Submit Decisions</button>
    </div>
  </div>

  <div class="table-container">
    <table class="rate-table" id="approveTable">
      <thead>
        <tr>
          <th rowspan="2">CVP</th>
          <th class="tier tier-T1" colspan="2" style="text-align:center;border-left:1px solid var(--border);">&lt;5k</th>
          <th class="tier tier-T2" colspan="2" style="text-align:center;border-left:1px solid var(--border);">5–10k</th>
          <th class="tier tier-T3" colspan="2" style="text-align:center;border-left:1px solid var(--border);">10–15k</th>
          <th class="tier tier-T4" colspan="2" style="text-align:center;border-left:1px solid var(--border);">15–20k</th>
          <th class="tier tier-T5" colspan="2" style="text-align:center;border-left:1px solid var(--border);">&gt;20k</th>
          <th rowspan="2">By</th>
          <th rowspan="2">Submitted</th>
          <th rowspan="2">Eff.</th>
          <th rowspan="2">Expiry</th>
          <th rowspan="2">Decision</th>
          <th rowspan="2">Comment</th>
        </tr>
        <tr class="sub">
          <th class="tier tier-T1" style="border-left:1px solid var(--border);">Curr</th>
          <th class="tier tier-T1">Req</th>
          <th class="tier tier-T2" style="border-left:1px solid var(--border);">Curr</th>
          <th class="tier tier-T2">Req</th>
          <th class="tier tier-T3" style="border-left:1px solid var(--border);">Curr</th>
          <th class="tier tier-T3">Req</th>
          <th class="tier tier-T4" style="border-left:1px solid var(--border);">Curr</th>
          <th class="tier tier-T4">Req</th>
          <th class="tier tier-T5" style="border-left:1px solid var(--border);">Curr</th>
          <th class="tier tier-T5">Req</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="cvp-cell">AAXX</td>
          <td class="rate-cell tier-T1">2.50</td><td class="rate-cell tier-T1" style="background:var(--blue-weak);">2.65</td>
          <td class="rate-cell tier-T2">2.55</td><td class="rate-cell tier-T2" style="background:var(--blue-weak);">2.70</td>
          <td class="rate-cell tier-T3">2.60</td><td class="rate-cell tier-T3" style="background:var(--blue-weak);">2.75</td>
          <td class="rate-cell tier-T4">2.65</td><td class="rate-cell tier-T4" style="background:var(--blue-weak);">2.80</td>
          <td class="rate-cell tier-T5">2.70</td><td class="rate-cell tier-T5" style="background:var(--blue-weak);">2.85</td>
          <td>user1</td>
          <td>06-08</td>
          <td>06-10</td>
          <td>—</td>
          <td style="min-width:120px;">
            <select class="control approveDecision" style="padding:6px 8px;">
              <option value="APPROVE">Approve</option>
              <option value="DECLINE">Decline</option>
            </select>
          </td>
          <td style="min-width:160px;">
            <input class="control approveComment" type="text" placeholder="Comment..." style="padding:6px 8px;">
          </td>
        </tr>
        <tr>
          <td class="cvp-cell">STF9</td>
          <td class="rate-cell tier-T1">2.52</td><td class="rate-cell tier-T1">2.52</td>
          <td class="rate-cell tier-T2">2.57</td><td class="rate-cell tier-T2">2.57</td>
          <td class="rate-cell tier-T3">2.62</td><td class="rate-cell tier-T3" style="background:var(--blue-weak);">2.68</td>
          <td class="rate-cell tier-T4">2.67</td><td class="rate-cell tier-T4" style="background:var(--blue-weak);">2.73</td>
          <td class="rate-cell tier-T5">2.72</td><td class="rate-cell tier-T5" style="background:var(--blue-weak);">2.78</td>
          <td>user2</td>
          <td>06-09</td>
          <td>06-12</td>
          <td>07-01</td>
          <td style="min-width:120px;">
            <select class="control approveDecision" style="padding:6px 8px;">
              <option value="APPROVE">Approve</option>
              <option value="DECLINE">Decline</option>
            </select>
          </td>
          <td style="min-width:160px;">
            <input class="control approveComment" type="text" placeholder="Comment..." style="padding:6px 8px;">
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pager">
    <div class="pager-left"><span>All tiers for each CVP shown in one row. Yellow cells = changed values.</span></div>
    <div class="pager-right"><span style="color:#6b7280; font-weight:900; font-size:12px;">—</span></div>
  </div>
</section>

<!-- ==================== HISTORY TABLE (Full Row + Verified By/On columns) ==================== -->
<section class="table-card section-history" id="historySection">
  <div class="table-toolbar">
    <div class="toolbar-left">
      <span class="chip"><i class="far fa-clock"></i> Audit trail (full records)</span>
    </div>
    <div class="toolbar-right">
      <button class="mini-btn" id="btnHistoryDownload"><i class="fas fa-download"></i> Download</button>
    </div>
  </div>

  <div class="table-container">
    <table class="rate-table" id="historyTable">
      <thead>
        <tr>
          <th rowspan="2">CVP</th>
          <th class="tier tier-T1" colspan="2" style="text-align:center;border-left:1px solid var(--border);">&lt;5k</th>
          <th class="tier tier-T2" colspan="2" style="text-align:center;border-left:1px solid var(--border);">5–10k</th>
          <th class="tier tier-T3" colspan="2" style="text-align:center;border-left:1px solid var(--border);">10–15k</th>
          <th class="tier tier-T4" colspan="2" style="text-align:center;border-left:1px solid var(--border);">15–20k</th>
          <th class="tier tier-T5" colspan="2" style="text-align:center;border-left:1px solid var(--border);">&gt;20k</th>
          <th rowspan="2">Changed By</th>
          <th rowspan="2">Changed On</th>
          <th rowspan="2">Decision</th>
          <th rowspan="2">Decision By</th>
          <th rowspan="2">Decision On</th>
          <th rowspan="2">Verified By</th>
          <th rowspan="2">Verified On</th>
          <th rowspan="2">Comment</th>
        </tr>
        <tr class="sub">
          <th class="tier tier-T1" style="border-left:1px solid var(--border);">Old</th>
          <th class="tier tier-T1">New</th>
          <th class="tier tier-T2" style="border-left:1px solid var(--border);">Old</th>
          <th class="tier tier-T2">New</th>
          <th class="tier tier-T3" style="border-left:1px solid var(--border);">Old</th>
          <th class="tier tier-T3">New</th>
          <th class="tier tier-T4" style="border-left:1px solid var(--border);">Old</th>
          <th class="tier tier-T4">New</th>
          <th class="tier tier-T5" style="border-left:1px solid var(--border);">Old</th>
          <th class="tier tier-T5">New</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="cvp-cell">AAXX</td>
          <td class="rate-cell tier-T1">2.50</td><td class="rate-cell tier-T1">2.65</td>
          <td class="rate-cell tier-T2">2.55</td><td class="rate-cell tier-T2">2.70</td>
          <td class="rate-cell tier-T3">2.60</td><td class="rate-cell tier-T3">2.75</td>
          <td class="rate-cell tier-T4">2.65</td><td class="rate-cell tier-T4">2.80</td>
          <td class="rate-cell tier-T5">2.70</td><td class="rate-cell tier-T5">2.85</td>
          <td>user1</td>
          <td>06-08</td>
          <td><span class="status-pill status-approved">Approved</span></td>
          <td>approver1</td>
          <td>06-09</td>
          <td>verifier1</td>
          <td>06-10</td>
          <td>OK</td>
        </tr>
        <tr>
          <td class="cvp-cell">STF1</td>
          <td class="rate-cell tier-T1">2.45</td><td class="rate-cell tier-T1">2.50</td>
          <td class="rate-cell tier-T2">2.50</td><td class="rate-cell tier-T2">2.55</td>
          <td class="rate-cell tier-T3">2.55</td><td class="rate-cell tier-T3">2.60</td>
          <td class="rate-cell tier-T4">2.60</td><td class="rate-cell tier-T4">2.65</td>
          <td class="rate-cell tier-T5">2.65</td><td class="rate-cell tier-T5">2.70</td>
          <td>user1</td>
          <td>06-05</td>
          <td><span class="status-pill status-declined">Declined</span></td>
          <td>approver1</td>
          <td>06-06</td>
          <td>—</td>
          <td>—</td>
          <td>Use standard margin</td>
        </tr>
        <tr>
          <td class="cvp-cell">PRM2</td>
          <td class="rate-cell tier-T1">2.80</td><td class="rate-cell tier-T1">2.85</td>
          <td class="rate-cell tier-T2">2.85</td><td class="rate-cell tier-T2">2.90</td>
          <td class="rate-cell tier-T3">2.90</td><td class="rate-cell tier-T3">2.95</td>
          <td class="rate-cell tier-T4">2.95</td><td class="rate-cell tier-T4">3.00</td>
          <td class="rate-cell tier-T5">3.00</td><td class="rate-cell tier-T5">3.05</td>
          <td>user2</td>
          <td>06-10</td>
          <td><span class="status-pill status-approved">Approved</span></td>
          <td>approver2</td>
          <td>06-11</td>
          <td>verifier2</td>
          <td>06-12</td>
          <td>Q3 promo approved</td>
        </tr>
        <tr>
          <td class="cvp-cell">STF9</td>
          <td class="rate-cell tier-T1">2.52</td><td class="rate-cell tier-T1">2.52</td>
          <td class="rate-cell tier-T2">2.57</td><td class="rate-cell tier-T2">2.57</td>
          <td class="rate-cell tier-T3">2.62</td><td class="rate-cell tier-T3">2.68</td>
          <td class="rate-cell tier-T4">2.67</td><td class="rate-cell tier-T4">2.73</td>
          <td class="rate-cell tier-T5">2.72</td><td class="rate-cell tier-T5">2.78</td>
          <td>user2</td>
          <td>06-09</td>
          <td><span class="status-pill status-pending">Pending</span></td>
          <td>—</td>
          <td>—</td>
          <td>—</td>
          <td>—</td>
          <td>—</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pager">
    <div class="pager-left"><span>Full audit trail: all tiers per CVP + Changed/Decision/Verified metadata.</span></div>
    <div class="pager-right"><span style="color:#6b7280; font-weight:900; font-size:12px;">—</span></div>
  </div>
</section>

<div class="toast-wrap" id="toastWrap" aria-live="polite" aria-atomic="true"></div>
    </div>
  </main>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    function toast(title, msg, icon="fa-circle-check"){
      const wrap = $("#toastWrap");
      const el = document.createElement("div");
      el.className = "toast-lite";
      el.innerHTML = `
        <div class="ticon"><i class="fas ${icon}"></i></div>
        <div class="tmeta">
          <div class="t1">${title}</div>
          <div class="t2">${msg}</div>
        </div>
        <button aria-label="Close"><i class="fas fa-xmark"></i></button>
      `;
      el.querySelector("button").addEventListener("click", () => el.remove());
      wrap.appendChild(el);
      setTimeout(() => el.remove(), 3800);
    }

    // Subcategory mapping
    const SUBS = {
      "STAFF": ["ALL"],
      "PROMO": ["SPRING25", "SUMMER25"],
      "NTB": ["ALL"]
    };

    function rebuildSubcategories(){
      const cat = $("#categorySelect").value;
      const subSel = $("#subcategorySelect");
      const hint = $("#subHint");
      const list = (cat === "ALL") ? ["ALL subcategories"] : (SUBS[cat] || []);
      subSel.innerHTML = "";

      if (cat === "ALL") {
        subSel.add(new Option("All subcategories", "ALL", true, true));
        subSel.disabled = false;
        hint.textContent = "If a category has no subcategories, this stays disabled.";
        return;
      }

      if (!list.length || (list.length === 1 && list[0] === "ALL")) {
        subSel.add(new Option("All subcategories", "ALL", true, true));
        subSel.disabled = true;
        hint.textContent = "This category has no subcategories.";
        return;
      }

      subSel.add(new Option("All subcategories", "ALL", true, true));
      list.forEach(v => subSel.add(new Option(v, v)));
      subSel.disabled = false;
      hint.textContent = "Pick a subcategory to narrow the table.";
    }

    $("#categorySelect").addEventListener("change", () => {
      rebuildSubcategories();
      applyAll();
    });
    $("#subcategorySelect").addEventListener("change", applyAll);

    // Tier multi-select
    function closeMenus(except){
      if (except !== "tierMenu") $("#tierMenu")?.classList.remove("open");
      if (except !== "statusMenu") $("#statusMenu")?.classList.remove("open");
      if (except !== "viewTierMenu") $("#viewTierMenu")?.classList.remove("open");
      if (except !== "viewSubcategoryMenu") $("#viewSubcategoryMenu")?.classList.remove("open");
    }

    $("#statusBtn")?.addEventListener("click", (e) => {
      e.preventDefault();
      closeMenus("statusMenu");
      $("#statusMenu").classList.toggle("open");
    });

    $("#tierBtn").addEventListener("click", (e) => {
      e.preventDefault();
      closeMenus("tierMenu");
      $("#tierMenu").classList.toggle("open");
    });

    document.addEventListener("click", (e) => {
      const inTier = $("#tierMulti")?.contains(e.target);
      const inStatus = $("#statusMulti")?.contains(e.target);
      const inViewTier = $("#viewTierMulti")?.contains(e.target);
      const inViewSub = $("#viewSubcategoryMulti")?.contains(e.target);
      if (!inTier && !inStatus && !inViewTier && !inViewSub) closeMenus(null);
    });

    function getSelectedTiers(){
      return $$(".tierCheck").filter(cb => cb.checked).map(cb => cb.value);
    }
    function updateTierLabel(){
      const n = getSelectedTiers().length;
      $("#tierBtnLabel").textContent = (n === 5) ? "All tiers selected" : (n === 0) ? "No tiers selected" : `${n} tier(s) selected`;
    }
    function applyTierVisibility(){
      const selected = new Set(getSelectedTiers());
      ["T1","T2","T3","T4","T5"].forEach(t => {
        const hide = !selected.has(t);
        $$(".tier-" + t).forEach(el => el.classList.toggle("tier-hidden", hide));
      });
    }
    $$(".tierCheck").forEach(cb => cb.addEventListener("change", () => {
      updateTierLabel();
      applyTierVisibility();
    }));

    function getSelectedStatuses(){
      return $$(".statusCheck").filter(cb => cb.checked).map(cb => cb.value);
    }
    function updateStatusLabel(){
      const n = getSelectedStatuses().length;
      $("#statusBtnLabel").textContent = (n === 3) ? "All statuses selected" : (n === 0) ? "No statuses selected" : `${n} status(es) selected`;
    }
    $$(".statusCheck").forEach(cb => cb.addEventListener("change", () => {
      updateStatusLabel();
      applyAll();
    }));
    updateStatusLabel();

    // Filtering + Pagination
    let currentPage = 1;
    function getActiveStatusSet(){
      return new Set($$(".statusCheck").filter(cb => cb.checked).map(cb => cb.value));
    }

    function matchesFilters(tr){
      const cat = $("#categorySelect").value;
      const sub = $("#subcategorySelect").value;
      const term = $("#globalSearch").value.trim().toLowerCase();
      const statusSet = getActiveStatusSet();
      const rowCat = tr.getAttribute("data-category") || "STAFF";
      const rowSub = tr.getAttribute("data-subcategory") || "ALL";
      const rowStatus = tr.getAttribute("data-status") || "ACTIVE";
      const catOk = (cat === "ALL") || (rowCat === cat);
      const subOk = (sub === "ALL") || (rowSub === sub);
      const statusOk = statusSet.has(rowStatus);
      const searchOk = !term || tr.textContent.toLowerCase().includes(term);
      return catOk && subOk && statusOk && searchOk;
    }

    function getFilteredRows(){
      return $$("#tbody tr").filter(matchesFilters);
    }

    function pageSize(){
      return Number($("#rowsPerPage").value) || 5;
    }

    function clampPage(){
      const total = getFilteredRows().length;
      const size = pageSize();
      const maxPage = Math.max(1, Math.ceil(total / size));
      if (currentPage > maxPage) currentPage = maxPage;
      if (currentPage < 1) currentPage = 1;
    }

    function renderPage(){
      const rows = $$("#tbody tr");
      const filtered = rows.filter(matchesFilters);
      const size = pageSize();
      const start = (currentPage - 1) * size;
      const end = start + size;
      rows.forEach(r => r.style.display = "none");
      filtered.slice(start, end).forEach(r => r.style.display = "");
      const total = filtered.length;
      const showing = Math.min(end, total);
      $("#pagerInfo").textContent = total === 0 ? "No results" : `Showing ${start + 1}–${showing} of ${total}`;
      $("#pagePill").textContent = currentPage;
    }

    function applyAll(){
      clampPage();
      renderPage();
    }

    $("#globalSearch").addEventListener("input", () => { currentPage = 1; applyAll(); });
    $("#rowsPerPage").addEventListener("change", () => { currentPage = 1; applyAll(); });
    $("#btnPrev").addEventListener("click", () => { if (currentPage > 1) { currentPage--; applyAll(); } });
    $("#btnNext").addEventListener("click", () => {
      const total = getFilteredRows().length;
      const maxPage = Math.max(1, Math.ceil(total / pageSize()));
      if (currentPage < maxPage) { currentPage++; applyAll(); }
    });

    // Row actions
    function bindRowActions(tr){
      tr.querySelector(".act-copy-new")?.addEventListener("click", () => {
        const inputs = tr.querySelectorAll(".new-input");
        const first = Array.from(inputs).find(i => i.value.trim());
        if (first) inputs.forEach(i => i.value = first.value);
        toast("Copied", "New rate copied across tiers.", "fa-check");
      });
      tr.querySelector(".act-copy-disc")?.addEventListener("click", () => {
        const inputs = tr.querySelectorAll(".disc-input");
        const first = Array.from(inputs).find(i => i.value.trim());
        if (first) inputs.forEach(i => i.value = first.value);
        toast("Copied", "Discretion copied across tiers.", "fa-check");
      });
      tr.querySelector(".act-delete")?.addEventListener("click", () => {
        tr.remove();
        toast("Row removed", "Row deleted.", "fa-trash");
        applyAll();
      });
    }
    $$("#tbody tr").forEach(tr => bindRowActions(tr));

    // Clear all
    $("#clearAll").addEventListener("click", (e) => {
      e.preventDefault();
      $("#categorySelect").value = "ALL";
      rebuildSubcategories();
      $("#subcategorySelect").value = "ALL";
      $("#globalSearch").value = "";
      $$(".statusCheck").forEach(cb => cb.checked = true);
      $$(".tierCheck").forEach(cb => cb.checked = true);
      updateTierLabel();
      updateStatusLabel();
      applyTierVisibility();
      $$(".rowCheck").forEach(cb => cb.checked = false);
      $("#selectAll").checked = false;
      applyAll();
      toast("Cleared", "Filters reset.", "fa-filter-circle-xmark");
    });

    // Button placeholders
    $("#btnUpload")?.addEventListener("click", () => toast("Upload", "Upload Excel/CSV (placeholder).", "fa-upload"));
    $("#btnDownload")?.addEventListener("click", () => toast("Download", "Download current + draft (placeholder).", "fa-download"));
    $("#btnEmail")?.addEventListener("click", () => toast("Email", "Email reviewers (placeholder).", "fa-envelope"));
    $("#btnSaveDraft")?.addEventListener("click", () => toast("Draft saved", "Stored locally (placeholder).", "fa-floppy-disk"));
    $("#btnSubmit")?.addEventListener("click", () => toast("Submitted", "Submitted for review (placeholder).", "fa-paper-plane"));
    $("#btnNotif")?.addEventListener("click", () => toast("Notifications", "Rate alerts (placeholder).", "fa-bell"));
    $("#btnMsg")?.addEventListener("click", () => toast("Messages", "Comments (placeholder).", "fa-comment-dots"));
    $("#btnViewDownload")?.addEventListener("click", () => toast("Download", "Download view data (placeholder).", "fa-download"));
    $("#btnStatusDownload")?.addEventListener("click", () => toast("Download", "Download status data (placeholder).", "fa-download"));
    $("#btnApproveDownload")?.addEventListener("click", () => toast("Download", "Download approve data (placeholder).", "fa-download"));
    $("#btnApproveSubmit")?.addEventListener("click", () => toast("Decisions submitted", "Approval decisions saved (placeholder).", "fa-paper-plane"));
    $("#btnHistoryDownload")?.addEventListener("click", () => toast("Download", "Download history data (placeholder).", "fa-download"));

    // Init
    rebuildSubcategories();
    updateTierLabel();
    applyTierVisibility();
    applyAll();

    // =============== VIEW RATES TAB LOGIC ===============
    const VIEW_CATEGORY_SUBS = {
      "ALL": [],
      "NEW_TO_BANK": [{ id: "NTB_NEW", name: "New Customer" }, { id: "NTB_MORTGAGE_XSELL", name: "Mortgage Cross-sell" }],
      "STAFF": [{ id: "STF_CORE", name: "Core Staff" }, { id: "STF_PREMIUM", name: "Premium Staff" }],
      "PROMOTION": [],
      "ALL_PROGRAMS": []
    };

    let viewCurrentPage = 1;

    $("#viewSubcategoryBtn")?.addEventListener("click", (e) => {
      e.preventDefault();
      if ($("#viewSubcategoryBtn").classList.contains("disabled")) return;
      closeMenus("viewSubcategoryMenu");
      $("#viewSubcategoryMenu").classList.toggle("open");
    });

    $("#viewTierBtn")?.addEventListener("click", (e) => {
      e.preventDefault();
      closeMenus("viewTierMenu");
      $("#viewTierMenu").classList.toggle("open");
    });

    function buildViewSubcategories(category) {
      const subs = VIEW_CATEGORY_SUBS[category] || [];
      const menu = $("#viewSubcategoryMenu");
      menu.innerHTML = "";
      if (!subs.length) {
        $("#viewSubcategoryBtn").classList.add("disabled");
        $("#viewSubcategoryBtnLabel").textContent = "No subcategories";
        return;
      }
      $("#viewSubcategoryBtn").classList.remove("disabled");
      $("#viewSubcategoryBtnLabel").textContent = "All subcategories";
      subs.forEach((s) => {
        const label = document.createElement("label");
        label.className = "multi-item";
        label.innerHTML = `<input type="checkbox" class="viewSubcatCheck" value="${s.id}"><span>${s.name}</span>`;
        menu.appendChild(label);
      });
      $$(".viewSubcatCheck").forEach(cb => cb.addEventListener("change", applyViewFilters));
    }

    function getSelectedViewTiers() {
      return $$(".viewTierCheck").filter(cb => cb.checked).map(cb => cb.value);
    }

    function updateViewTierButtonLabel() {
      const tiers = getSelectedViewTiers();
      if (tiers.length === 5) $("#viewTierBtnLabel").textContent = "All tiers selected";
      else if (tiers.length === 0) $("#viewTierBtnLabel").textContent = "No tiers selected";
      else $("#viewTierBtnLabel").textContent = `${tiers.length} tier(s) selected`;
    }

    function applyViewTierVisibility() {
      const selected = new Set(getSelectedViewTiers());
      ["T1","T2","T3","T4","T5"].forEach(t => {
        $$(".view-tier-" + t).forEach(el => el.classList.toggle("tier-hidden", !selected.has(t)));
      });
    }

    $$(".viewTierCheck").forEach(cb => cb.addEventListener("change", () => {
      updateViewTierButtonLabel();
      applyViewTierVisibility();
    }));

    function viewMatchesFilters(row) {
      const category = $("#viewCategorySelect").value;
      const subSelected = $$(".viewSubcatCheck").filter(cb => cb.checked).map(cb => cb.value);
      const term = $("#viewSearch").value.trim().toLowerCase();
      const rowCat = row.getAttribute("data-category") || "";
      const rowSub = row.getAttribute("data-subcategory") || "";
      const catOk = (category === "ALL") || (rowCat === category);
      const subOk = (subSelected.length === 0) || subSelected.includes(rowSub);
      const searchOk = !term || row.textContent.toLowerCase().includes(term);
      return catOk && subOk && searchOk;
    }

    function applyViewFilters() {
      const rows = $$("#viewTbody tr");
      const filtered = rows.filter(viewMatchesFilters);
      viewCurrentPage = 1;
      const pageSize = Number($("#viewRowsPerPage").value) || 10;
      rows.forEach(r => r.style.display = "none");
      filtered.slice(0, pageSize).forEach(r => r.style.display = "");
      const total = filtered.length;
      $("#viewPagerInfo").textContent = total === 0 ? "No results" : `Showing 1–${Math.min(pageSize, total)} of ${total}`;
      $("#viewPagePill").textContent = 1;
    }

    $("#viewCategorySelect")?.addEventListener("change", () => {
      buildViewSubcategories($("#viewCategorySelect").value);
      applyViewFilters();
    });
    $("#viewSearch")?.addEventListener("input", applyViewFilters);
    $("#viewRowsPerPage")?.addEventListener("change", applyViewFilters);

    $("#clearAllView")?.addEventListener("click", (e) => {
      e.preventDefault();
      $("#viewCategorySelect").value = "ALL";
      $("#viewSearch").value = "";
      $$(".viewTierCheck").forEach(cb => cb.checked = true);
      buildViewSubcategories("ALL");
      updateViewTierButtonLabel();
      applyViewTierVisibility();
      applyViewFilters();
    });

    // Init View
    buildViewSubcategories("ALL");
    updateViewTierButtonLabel();
    applyViewTierVisibility();
    applyViewFilters();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Tab mode switching (5 tabs)
    (function(){
      const tabs = Array.from(document.querySelectorAll('#rateTabs .nav-link'));
      const titleH1 = document.querySelector('.top-header .title h1');
      const subtitle = document.querySelector('.top-header .title small');

      const MODE_META = {
        view:    { icon: 'far fa-eye',           color: 'var(--blue)', text: 'View Rates',      sub: 'Admin view of all rates (read-only).' },
        enter:   { icon: 'fas fa-pen-to-square', color: 'var(--blue)', text: 'Enter Rates',     sub: 'Only New Rate + Discretion are editable.' },
        status:  { icon: 'far fa-circle-check',  color: 'var(--blue)', text: 'Approved Status', sub: 'Track approvals/declines for submissions.' },
        approve: { icon: 'fas fa-gavel',         color: 'var(--blue)', text: 'Approve Rates',   sub: 'Review and approve/decline pending changes.' },
        history: { icon: 'far fa-clock',         color: 'var(--blue)', text: 'Rate History',    sub: 'Full audit trail with verification data.' }
      };

      function setMode(mode){
        tabs.forEach(t => {
          const active = (t.getAttribute('data-mode') === mode);
          t.classList.toggle('active', active);
          t.setAttribute('aria-selected', active ? 'true' : 'false');
        });
        document.body.classList.remove('mode-view','mode-enter','mode-status','mode-approve','mode-history');
        document.body.classList.add('mode-' + mode);
        const meta = MODE_META[mode] || MODE_META.enter;
        if (titleH1) titleH1.innerHTML = `<i class="${meta.icon}" style="color:${meta.color}"></i> ${meta.text}`;
        if (subtitle) subtitle.textContent = meta.sub;
      }

      setMode('enter');

      tabs.forEach(t => t.addEventListener('click', (e) => {
        e.preventDefault();
        setMode(t.getAttribute('data-mode'));
      }));
    })();
  </script>
</body>
</html>