<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TD Bank - ULOC Enter Rates (Full Width)</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --td-green:#008A00;
      --td-green-dark:#006B00;
      --td-green-weak:#E8F5E9;

      --bg:#ffffff;
      --panel:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;

      --blue:#2563eb;
      --blue-weak:#e8f0ff;

      --shadow:0 1px 3px rgba(0,0,0,0.06);
      --transition:.15s ease;
    }

    body{
      font-family:'DM Sans',system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }

    /* Sidebar - only ULOC / ILOC */
    .sidebar{
      position:fixed; left:0; top:0;
      width:68px; height:100vh;
      background:#1a1d21;
      display:flex; flex-direction:column;
      z-index:1000;
    }
    .sidebar-brand{
      min-height:64px;
      border-bottom:1px solid rgba(255,255,255,0.1);
      display:flex; align-items:center; justify-content:center;
      padding:16px;
    }
    .brand-icon{
      width:36px; height:36px; border-radius:10px;
      background:var(--td-green);
      color:#fff; font-weight:900;
      display:flex; align-items:center; justify-content:center;
      letter-spacing:0.2px;
    }
    .sidebar-nav{ padding:14px 8px; flex:1; }
    .nav-item{
      position:relative;
      display:flex; flex-direction:column; align-items:center; gap:4px;
      padding:12px 8px; border-radius:10px;
      color:rgba(255,255,255,0.75);
      text-decoration:none;
      transition:all var(--transition);
      margin-bottom:4px;
    }
    .sidebar .nav-item:hover{ background:#2d3136; color:#fff; }
    .sidebar .nav-item.active{ background:var(--td-green); color:#fff; }
    .sidebar .nav-item i{ font-size:18px; }
    .nav-item span{ display:none; }
    .nav-item[data-title]::after{
      content:attr(data-title);
      position:absolute; left:74px; top:50%;
      transform:translateY(-50%);
      background:rgba(0,0,0,0.85);
      color:#fff; font-size:12px; font-weight:700;
      padding:6px 10px; border-radius:10px;
      opacity:0; pointer-events:none;
      transition:opacity var(--transition);
      white-space:nowrap;
    }
    .sidebar .nav-item:hover::after{ opacity:1; }

    .sidebar-footer{
      padding:12px;
      border-top:1px solid rgba(255,255,255,0.1);
      display:flex; justify-content:center;
    }
    .user-avatar{
      width:36px; height:36px; border-radius:999px;
      background:linear-gradient(135deg,#667eea,#764ba2);
      color:#fff; font-weight:800;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
      transition:transform var(--transition);
    }
    .user-avatar:hover{ transform:scale(1.05); }

    /* Main */
    .main{ margin-left:68px; min-height:100vh; }

    /* Top header */
    .top-header{
      position:sticky; top:0; z-index:100;
      background:var(--panel);
      border-bottom:1px solid var(--border);
      padding:14px 24px;
      display:flex; align-items:center; justify-content:space-between;
      gap:16px;
    }
    .title{
      display:flex; flex-direction:column; gap:2px;
      min-width:280px;
    }
    .title h1{
      margin:0;
      font-size:18px; font-weight:900; letter-spacing:0.2px;
      display:flex; align-items:center; gap:10px;
    }
    .title small{
      color:var(--muted);
      font-weight:700;
      font-size:12px;
    }

    /* Mode tabs (keep these) */
    .mode-tabs{
      display:flex; align-items:center; justify-content:center;
      gap:10px; flex:1;
      min-width:520px;
    }
    .mode-link{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px;
      border-radius:12px;
      text-decoration:none;
      font-weight:900;
      font-size:13px;
      color:var(--blue);
      transition:all var(--transition);
      border:1px solid transparent;
      user-select:none;
    }
    .mode-link:hover{ background:#f6f8ff; }
    .mode-link.active{
      background:var(--blue); color:#fff;
      box-shadow:0 10px 22px rgba(37,99,235,0.18);
    }

    .header-actions{
      display:flex; align-items:center; gap:10px;
      min-width:240px; justify-content:flex-end;
    }
    .btn-icon{
      width:40px; height:40px;
      border:none; background:transparent;
      border-radius:12px;
      color:#4b5563;
      display:flex; align-items:center; justify-content:center;
      transition:all var(--transition);
      position:relative;
    }
    .btn-icon:hover{ background:#f5f6f7; color:#111827; }
    .dot{
      position:absolute; right:10px; top:10px;
      width:8px; height:8px; border-radius:50%;
      background:#dc2626; display:none;
    }
    .btn-icon.has-dot .dot{ display:block; }

    /* Content container */
    .content{ padding:18px 24px 26px; }
    /* Page tabs (View / Enter / Approve / History) */
    .page-tabs{ background:transparent; border:none; border-radius:0; box-shadow:none; padding:0; margin-bottom:14px; }
    .page-tabs .nav{ gap:0; flex-wrap:wrap; justify-content:flex-start; border-bottom:1px solid var(--border); }
    .page-tabs .nav-link{
      border:none;
      border-bottom:3px solid transparent;
      border-radius:0;
      padding:10px 14px;
      font-weight:900;
      font-size:13px;
      color:#374151;
      display:flex;
      align-items:center;
      gap:10px;
      transition:all var(--transition);
      user-select:none;
      background:transparent;
    }
    .page-tabs .nav-link:hover{ background:transparent; color:#111827; border-bottom-color:var(--blue); }
    .page-tabs .nav-item:hover{ background:transparent; }
    .page-tabs .nav-link.active{ background:transparent; color:#111827; border-bottom-color:var(--blue); box-shadow:none; }

    /* KPI cards (dashboard summary) */
    .kpi-row{ margin-bottom:14px; }
    .kpi-card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:var(--shadow);
      padding:16px 16px;
      display:flex;
      align-items:center;
      gap:14px;
      min-height:92px;
    }
    .kpi-ico{
      width:46px; height:46px;
      border-radius:16px;
      display:flex; align-items:center; justify-content:center;
      font-size:18px;
      font-weight:900;
      flex:0 0 auto;
    }
    .kpi-ico.green{ background:#E8F5E9; color:var(--td-green); }
    .kpi-ico.blue{ background:#E8F0FF; color:var(--blue); }
    .kpi-ico.amber{ background:#FEF3C7; color:#B45309; }
    .kpi-ico.purple{ background:#F3E8FF; color:#7C3AED; }

    .kpi-meta{ flex:1; min-width:0; }
    .kpi-title{
      color:#6b7280;
      font-weight:900;
      font-size:12px;
      letter-spacing:0.2px;
      margin-bottom:2px;
      text-transform:uppercase;
    }
    .kpi-value{
      font-weight:900;
      font-size:22px;
      line-height:1.05;
      margin:0;
      color:#111827;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .kpi-sub{
      margin-top:4px;
      color:#9ca3af;
      font-weight:800;
      font-size:12px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* Centering filters nicely */
    .filter-row-center{ align-items:center; }
    .filter-block{
      height:100%;
      display:flex;
      flex-direction:column;
      justify-content:center;
    }
    .hint.placeholder-hint{ opacity:0; }
/* Filter Bar - full width */
    .filter-bar{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:var(--shadow);
      padding:14px 14px;
      margin-bottom:14px;
    }

    .filter-top{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .filter-title{
      display:flex; align-items:center; gap:10px;
      font-weight:900; font-size:14px;
    }
    .clear-all{
      color:var(--td-green);
      font-weight:900;
      text-decoration:none;
      font-size:13px;
      cursor:pointer;
    }
    .clear-all:hover{ text-decoration:underline; }

    .field-label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.4px;
      color:#6b7280;
      font-weight:900;
      margin-bottom:6px;
    }

    .control{
      width:100%;
      padding:9px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#fff;
      font-size:13px;
      font-weight:700;
      color:#111827;
      transition:all var(--transition);
    }
    .control:focus{
      outline:none;
      border-color:var(--td-green);
      box-shadow:0 0 0 3px var(--td-green-weak);
    }

    .search-wrap{ position:relative; }
    .search-wrap i{
      position:absolute; left:14px; top:50%;
      transform:translateY(-50%);
      color:#9ca3af;
    }
    .search-wrap input{
      padding-left:40px;
    }

    /* Status checkboxes */
    .status-box{
      display:flex; gap:12px; flex-wrap:wrap;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:12px;
      background:#fff;
    }
    .status-box label{
      display:flex; align-items:center; gap:8px;
      font-weight:800; font-size:13px;
      color:#111827;
      user-select:none;
      cursor:pointer;
    }
    .status-box input{
      width:18px; height:18px;
      accent-color:var(--td-green);
      cursor:pointer;
    }

    /* Multi select tiers */
    .multi-select{ position:relative; }
    .multi-btn{
      width:100%;
      display:flex; align-items:center; justify-content:space-between;
      padding:9px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#fff;
      font-size:13px;
      font-weight:800;
      cursor:pointer;
      transition:all var(--transition);
      user-select:none;
    }
    .multi-btn:hover{ border-color:#d1d5db; background:#fafafa; }
    .multi-menu{
      position:absolute;
      left:0; top:calc(100% + 8px);
      width:100%;
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:0 12px 28px rgba(0,0,0,0.12);
      padding:10px;
      z-index:200;
      display:none;
      max-height:240px;
      overflow:auto;
    }
    .multi-menu.open{ display:block; }
    .multi-item{
      display:flex; align-items:center; gap:10px;
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      user-select:none;
    }
    .multi-item:hover{ background:#f6f7f8; }
    .multi-item input{
      width:16px; height:16px;
      accent-color:var(--td-green);
      cursor:pointer;
    }
    .multi-item span{ font-weight:800; font-size:13px; }

    .hint{
      color:#9ca3af;
      font-size:12px;
      font-weight:700;
      margin-top:8px;
    }

    /* Table area */
    .table-card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    .table-toolbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding:12px 14px;
      border-bottom:1px solid var(--border);
      background:#fff;
      flex-wrap:wrap;
    }

    .toolbar-left{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .toolbar-right{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      justify-content:flex-end;
    }

    .chip{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      padding:7px 10px;
      font-size:12px;
      font-weight:900;
      color:#111827;
      user-select:none;
    }
    .chip i{ color:#6b7280; }
    .chip strong{ color:var(--td-green); }

    .mini-btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#fff;
      color:#374151;
      font-weight:900;
      font-size:12px;
      cursor:pointer;
      transition:all var(--transition);
      user-select:none;
    }
    .mini-btn:hover{ background:#f5f6f7; border-color:#d1d5db; color:#111827; }
    .mini-btn.primary{
      background:var(--td-green);
      border-color:var(--td-green);
      color:#fff;
    }
    .mini-btn.primary:hover{
      background:var(--td-green-dark);
      border-color:var(--td-green-dark);
    }

    /* Rate table */
    .table-container{ overflow-x:auto; }
    table.rate-table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }
    .rate-table thead th{
      background:#fff;
      border-bottom:1px solid var(--border);
      color:#6b7280;
      font-weight:900;
      font-size:12px;
      padding:12px 12px;
      white-space:nowrap;
    }
    .rate-table thead th.tier{
      text-align:center;
      border-left:1px solid var(--border);
    }
    .rate-table thead .sub th{
      background:#fafafa;
      padding:8px 10px;
      font-size:11px;
      font-weight:900;
      border-bottom:1px solid var(--border);
    }

    .rate-table tbody td{
      padding:10px 12px;
      border-bottom:1px solid var(--border);
      vertical-align:middle;
      color:#111827;
    }
    .rate-table tbody tr:hover{ background:#fafbfc; }
    .rate-table tbody tr:last-child td{ border-bottom:none; }

    .select-cell{ width:54px; text-align:center; }
    .select-cell input{ width:18px; height:18px; accent-color:var(--td-green); cursor:pointer; }

    .cvp-cell{ font-weight:900; letter-spacing:0.2px; }

    .rate-cell{
      text-align:center;
      border-left:1px solid var(--border);
      min-width:92px;
      font-weight:900;
    }

    .current-pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px;
      border-radius:999px;
      background:#f3f4f6;
      color:#111827;
      font-size:12px;
      font-weight:900;
      white-space:nowrap;
    }
    .current-pill i{ color:#6b7280; }

    .new-input{
      width:86px;
      text-align:center;
      padding:7px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      font-weight:900;
      transition:all var(--transition);
      outline:none;
      background:#fff;
    }
    .new-input:focus{
      border-color:var(--blue);
      box-shadow:0 0 0 3px var(--blue-weak);
    }

    .disc-input{
      width:140px;
      padding:7px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      font-weight:800;
      transition:all var(--transition);
      outline:none;
      background:#fff;
    }
    .disc-input:focus{
      border-color:var(--blue);
      box-shadow:0 0 0 3px var(--blue-weak);
    }

    .changed{
      border-color:rgba(37,99,235,0.6)!important;
      box-shadow:0 0 0 3px rgba(37,99,235,0.12);
    }

    /* Row actions (segmented) */
    .actions-cell{ width:190px; text-align:center; }
    .action-group{
      display:inline-flex;
      border:1px solid #9ca3af;
      border-radius:10px;
      overflow:hidden;
      background:#fff;
    }
    .action-btn{
      width:44px; height:36px;
      border:none;
      background:#fff;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
      transition:all var(--transition);
      color:#374151;
    }
    .action-btn + .action-btn{ border-left:1px solid #9ca3af; }
    .action-btn:hover{ background:#f5f6f7; color:#111827; }
    .action-btn.danger:hover{ background:#fee2e2; color:#991b1b; }

    /* Row status pill */
    .status-pill{
      display:inline-flex; align-items:center; justify-content:center;
      padding:7px 12px;
      border-radius:999px;
      font-weight:900;
      font-size:12px;
      white-space:nowrap;
    }
    .status-active{ background:#dcfce7; color:#166534; }
    .status-expiring{ background:#fef3c7; color:#92400e; }
    .status-inactive{ background:#f3f4f6; color:#6b7280; }

    /* Pagination bar */
    .pager{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding:12px 14px;
      border-top:1px solid var(--border);
      background:#fff;
      flex-wrap:wrap;
    }
    .pager-left{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      color:#6b7280; font-weight:800; font-size:12px;
    }
    .pager-right{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pager-select{
      padding:8px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      font-weight:900;
      font-size:12px;
      color:#111827;
      background:#fff;
    }

    .page-controls{
      display:flex; align-items:center; gap:8px;
    }
    .page-btn{
      width:40px; height:36px;
      border:none;
      border-radius:12px;
      background:#e5e7eb;
      color:#374151;
      font-weight:900;
      cursor:pointer;
      transition:all var(--transition);
    }
    .page-btn:hover{ filter:brightness(0.95); }
    .page-pill{
      width:44px; height:36px;
      border-radius:12px;
      background:var(--td-green);
      color:#fff;
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
    }

    /* Tier hide */
    .tier-hidden{ display:none!important; }

    /* Toast */
    .toast-wrap{
      position:fixed;
      right:18px; bottom:18px;
      z-index:2000;
      display:flex; flex-direction:column; gap:10px;
      pointer-events:none;
    }
    .toast-lite{
      pointer-events:auto;
      min-width:320px;
      background:#111827;
      color:#fff;
      border-radius:14px;
      padding:12px 14px;
      box-shadow:0 12px 28px rgba(0,0,0,0.22);
      display:flex;
      align-items:flex-start;
      gap:12px;
      animation:slideIn .18s ease-out;
    }
    .toast-lite .tmeta{ flex:1; }
    .toast-lite .t1{ font-weight:900; font-size:13px; }
    .toast-lite .t2{ font-weight:700; font-size:12px; opacity:0.85; margin-top:2px; }
    .toast-lite button{
      border:none; background:transparent;
      color:rgba(255,255,255,0.8);
      cursor:pointer;
      padding:0;
    }
    .toast-lite button:hover{ color:#fff; }
    @keyframes slideIn{ from{ transform:translateY(10px); opacity:0 } to{ transform:translateY(0); opacity:1 } }

    /* Responsive */
    @media (max-width: 1200px){
                        .mode-tabs{ min-width:420px; }
    }
    @media (max-width: 992px){
      .mode-tabs{ display:none; }
            .filter-grid .span-2,       .top-header{ flex-wrap:wrap; }
      .title{ min-width:auto; }
      .header-actions{ min-width:auto; }
    }
    @media (max-width: 576px){
      .content{ padding:14px 14px 22px; }
            .filter-grid .span-2,       .pager{ flex-direction:column; align-items:stretch; }
      .pager-right{ justify-content:space-between; }
    }
  
    /* ---- Mode toggles (View / Enter / Approve / History) ---- */
    body.mode-view .new-col,
    body.mode-view td.new-col{ display:none !important; }

    body.mode-view .select-cell,
    body.mode-view .actions-cell{ display:none !important; }

    body.mode-view .toolbar-left,
    body.mode-view #btnUpload,
    body.mode-view #btnEmail,
    body.mode-view #btnSaveDraft,
    body.mode-view #btnSubmit{ display:none !important; }

    body.mode-view .new-input,
    body.mode-view .disc-input{ 
      pointer-events:none; 
      background:transparent !important; 
      border:none !important;
      box-shadow:none !important;
      padding:0 !important;
    }
    body.mode-view .disc-input{ text-align:center; font-weight:900; }

    /* Approve: hide editing + row actions, show approve controls */
    body.mode-approve .new-input,
    body.mode-approve .disc-input{
      pointer-events:none;
      background:transparent !important;
      border:none !important;
      box-shadow:none !important;
      padding:0 !important;
    }
    body.mode-approve .action-group{ display:none !important; }
    body.mode-approve .approve-controls{ display:flex !important; }

    /* History: read-only + no row actions */
    body.mode-history .new-input,
    body.mode-history .disc-input{
      pointer-events:none;
      background:transparent !important;
      border:none !important;
      box-shadow:none !important;
      padding:0 !important;
    }
    body.mode-history .actions-cell{ display:none !important; }
    body.mode-history .select-cell{ display:none !important; }

    /* Enter: show normal actions */
    body.mode-enter .approve-controls{ display:none !important; }

  
    /* ---- Prime pill in top bar ---- */
    .prime-pill{
      display:flex; align-items:center; gap:8px;
      padding:8px 10px;
      border:1px solid #e5e7eb;
      border-radius:999px;
      background:#fff;
      box-shadow:0 6px 16px rgba(15,23,42,.08);
      margin-right:8px;
    }
    .prime-label{ font-size:12px; font-weight:900; color:#6b7280; letter-spacing:.06em; text-transform:uppercase; }
    .prime-value{ font-size:14px; font-weight:900; color:#111827; }

    /* ---- Section visibility per tab ---- */
    .section-approve,.section-history,.section-status{ display:none; }
    body.mode-approve .section-approve{ display:block; }
    body.mode-history .section-history{ display:block; }
    body.mode-status .section-status{ display:block; }

    body.mode-approve .section-grid,
    body.mode-history .section-grid,
    body.mode-status .section-grid{ display:none; }

    /* View Rates: remove KPI cards */
    body.mode-view .kpi-row{ display:none !important; }
    body.mode-approve .kpi-row,
    body.mode-history .kpi-row,
    body.mode-status .kpi-row{ display:none !important; }

    /* Approve Rates: no Status filter (pending-only) */
    body.mode-approve #statusFilterCol{ display:none !important; }

    /* Approve/Status table controls */
    #approveTable .control, #statusTable .control{
      width:100%;
      border-radius:12px;
      border:1px solid #e5e7eb;
      background:#fff;
      padding:10px 12px;
      font-weight:800;
      color:#111827;
    }
    
  </style>
</head>

<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-brand">
      <div class="brand-icon">TD</div>
    </div>

    <nav class="sidebar-nav">
      <a href="#" class="nav-item active" data-title="ULOC"><i class="fas fa-credit-card"></i><span>ULOC</span></a>
      <a href="#" class="nav-item" data-title="ILOC"><i class="fas fa-landmark"></i><span>ILOC</span></a>
    </nav>

    <div class="sidebar-footer">
      <div class="user-avatar" title="Profile">JD</div>
    </div>
  </aside>

  <main class="main">
    <!-- Header -->
    <header class="top-header">
      <div class="title">
        <h1><i class="fas fa-pen-to-square" style="color: var(--blue)"></i> Enter Rates (e-Log)</h1>
        <small>Only New Rate + Discretion are editable. Current stays visible.</small>
      </div>

<div class="header-actions">
        <div class="prime-pill" title="Prime Rate">
          <span class="prime-label">Prime</span>
          <span class="prime-value" id="primeRateTop">7.20%</span>
        </div>
        <button class="btn-icon has-dot" id="btnNotif" title="Notifications"><span class="dot"></span><i class="far fa-bell"></i></button>
        <button class="btn-icon has-dot" id="btnMsg" title="Messages"><span class="dot"></span><i class="far fa-comment-dots"></i></button>
        <button class="btn-icon" title="Help"><i class="far fa-circle-question"></i></button>
      </div>
    </header>

    <div class="content">
      <!-- PAGE TABS -->
      <section class="page-tabs" aria-label="Rate pages">
        <ul class="nav nav-tabs" id="rateTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link" type="button" data-mode="view" role="tab" aria-selected="false"><i class="far fa-eye"></i> View Rate</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link active" type="button" data-mode="enter" role="tab" aria-selected="true"><i class="fas fa-pen-to-square"></i> Enter Rate</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" type="button" data-mode="approve" role="tab" aria-selected="false"><i class="far fa-circle-check"></i> Approve Rate</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" type="button" data-mode="history" role="tab" aria-selected="false"><i class="far fa-clock"></i> History</button>
          </li>
        </ul>
      </section>

<!-- KPI CARDS (dashboard summary) -->
      <section class="kpi-row">
        <div class="row g-3 justify-content-center">
          <div class="col-12 col-md-6 col-xl-3">
            <div class="kpi-card">
              <div class="kpi-ico green"><i class="fas fa-percent"></i></div>
              <div class="kpi-meta">
                <div class="kpi-title">Prime Rate</div>
                <p class="kpi-value" id="kpiPrime">7.20%</p>
                <div class="kpi-sub">Base reference</div>
              </div>
            </div>
          </div>

          <div class="col-12 col-md-6 col-xl-3">
            <div class="kpi-card">
              <div class="kpi-ico blue"><i class="fas fa-pen"></i></div>
              <div class="kpi-meta">
                <div class="kpi-title">Rows Edited</div>
                <p class="kpi-value" id="kpiEditedCard">0</p>
                <div class="kpi-sub">Draft changes</div>
              </div>
            </div>
          </div>

          <div class="col-12 col-md-6 col-xl-3">
            <div class="kpi-card">
              <div class="kpi-ico amber"><i class="fas fa-triangle-exclamation"></i></div>
              <div class="kpi-meta">
                <div class="kpi-title">Validation</div>
                <p class="kpi-value" id="kpiInvalidCard">0</p>
                <div class="kpi-sub">Needs attention</div>
              </div>
            </div>
          </div>

          <div class="col-12 col-md-6 col-xl-3">
            <div class="kpi-card">
              <div class="kpi-ico purple"><i class="fas fa-layer-group"></i></div>
              <div class="kpi-meta">
                <div class="kpi-title">Batch</div>
                <p class="kpi-value" id="kpiBatch">ULOC–JAN22</p>
                <div class="kpi-sub">Save Draft / Submit</div>
              </div>
            </div>
          </div>
        </div>
      </section>

<!-- FILTER BAR (full width) -->
      <section class="filter-bar">
        <div class="filter-top">
          <div class="filter-title"><i class="fas fa-filter" style="color:#9ca3af"></i> Filters</div>
          <a class="clear-all" href="#" id="clearAll">Clear all</a>
        </div>

        <!-- Row 1: Search (full width or centered 8-col on lg) -->
        <div class="row g-3 align-items-end mb-1">
          <div class="col-12 col-lg-8 mx-lg-auto">
            <div class="field-label">Search</div>
            <div class="search-wrap">
              <i class="fas fa-search"></i>
              <input class="control" id="globalSearch" type="text" placeholder="Search CVP, Current, New, Discretion, dates, status..." />
            </div>
          </div>
        </div>

        <!-- Row 2: 4 filters (3/3/3/3 on lg) -->
        <div class="row g-3 filter-row-center">
          <div class="col-12 col-lg-3">
            <div class="filter-block">
              <div class="field-label">Category</div>
              <select class="control" id="categorySelect">
                <option value="ALL" selected>All</option>
                <option value="STAFF">Staff</option>
                <option value="PROMO">Promotion</option>
                <option value="NTB">New to Bank</option>
              </select>
              <div class="hint">Choose a category to narrow the list.</div>
            </div>
          </div>

          <div class="col-12 col-lg-3">
            <div class="filter-block">
              <div class="field-label">Subcategory</div>
              <select class="control" id="subcategorySelect">
                <option value="ALL" selected>All subcategories</option>
              </select>
              <div class="hint" id="subHint">If a category has no subcategories, this stays disabled.</div>
            </div>
          </div>

          
          <div class="col-12 col-lg-3" id="statusFilterCol">
            <div class="filter-block">
              <div class="field-label">Status</div>
              <div class="multi-select" id="statusMulti">
                <button type="button" class="multi-btn" id="statusBtn">
                  <span id="statusBtnLabel">All statuses selected</span>
                  <i class="fas fa-chevron-down" style="color:#9ca3af"></i>
                </button>
                <div class="multi-menu" id="statusMenu">
                  <label class="multi-item"><input type="checkbox" class="statusCheck" value="ACTIVE" checked><span>Active</span></label>
                  <label class="multi-item"><input type="checkbox" class="statusCheck" value="EXPIRING" checked><span>Expiring</span></label>
                  <label class="multi-item"><input type="checkbox" class="statusCheck" value="INACTIVE" checked><span>Inactive</span></label>
                </div>
              </div>
              <div class="hint">Select one or more statuses.</div>
            </div>
          </div>


          <div class="col-12 col-lg-3">
            <div class="filter-block">
              <div class="field-label">Amount Tiers</div>
              <div class="multi-select" id="tierMulti">
                <button type="button" class="multi-btn" id="tierBtn">
                  <span id="tierBtnLabel">All tiers selected</span>
                  <i class="fas fa-chevron-down" style="color:#9ca3af"></i>
                </button>
                <div class="multi-menu" id="tierMenu">
                  <label class="multi-item"><input type="checkbox" class="tierCheck" value="T1" checked><span>&lt;5k</span></label>
                  <label class="multi-item"><input type="checkbox" class="tierCheck" value="T2" checked><span>5–10k</span></label>
                  <label class="multi-item"><input type="checkbox" class="tierCheck" value="T3" checked><span>10–15k</span></label>
                  <label class="multi-item"><input type="checkbox" class="tierCheck" value="T4" checked><span>15–20k</span></label>
                  <label class="multi-item"><input type="checkbox" class="tierCheck" value="T5" checked><span>&gt;20k</span></label>
                </div>
              </div>
              <div class="hint">Pick tiers to show in the grid.</div>
            </div>
          </div>
        </div>
      </section>

      
      <!-- TABLE (full width) -->
<section class="table-card section-grid" id="gridSection">
        <div class="table-toolbar">
          <div class="toolbar-left">
            </span>

            <button class="mini-btn" id="btnCopyNewAcross"><i class="fas fa-wand-magic-sparkles"></i> Copy New Down</button>
            <button class="mini-btn" id="btnCopyDiscAcross"><i class="fas fa-copy"></i> Copy Discretion Down</button>
</div>

          <div class="toolbar-right">
            <button class="mini-btn" id="btnUpload"><i class="fas fa-upload"></i> Upload</button>
            <button class="mini-btn" id="btnDownload"><i class="fas fa-download"></i> Download</button>
            <button class="mini-btn" id="btnEmail"><i class="fas fa-envelope"></i> Email</button>

            <button class="mini-btn" id="btnSaveDraft"><i class="fas fa-floppy-disk"></i> Save Draft</button>
            <button class="mini-btn primary" id="btnSubmit"><i class="fas fa-paper-plane"></i> Submit</button>
          </div>
        </div>

        <div class="table-container">
          <table class="rate-table" id="rateTable">
            <thead>
              <tr>
                <th rowspan="2" class="select-cell">
                  <input type="checkbox" id="selectAll" title="Select all rows on this page">
                </th>
                <th rowspan="2">CVP</th>

                <th colspan="3" class="tier tier-T1 tier-head">&lt;5k</th>
                <th colspan="3" class="tier tier-T2 tier-head">5–10k</th>
                <th colspan="3" class="tier tier-T3 tier-head">10–15k</th>
                <th colspan="3" class="tier tier-T4 tier-head">15–20k</th>
                <th colspan="3" class="tier tier-T5 tier-head">&gt;20k</th>

                <th rowspan="2">Eff. Date</th>
                <th rowspan="2">Expiry</th>
                <th rowspan="2">Status</th>
                <th rowspan="2">Actions</th>
              </tr>

              <tr class="sub">
                <th class="tier tier-T1">Current</th>
                <th class="tier tier-T1 new-col">New</th>
                <th class="tier tier-T1">Discretion</th>

                <th class="tier tier-T2">Current</th>
                <th class="tier tier-T2 new-col">New</th>
                <th class="tier tier-T2">Discretion</th>

                <th class="tier tier-T3">Current</th>
                <th class="tier tier-T3 new-col">New</th>
                <th class="tier tier-T3">Discretion</th>

                <th class="tier tier-T4">Current</th>
                <th class="tier tier-T4 new-col">New</th>
                <th class="tier tier-T4">Discretion</th>

                <th class="tier tier-T5">Current</th>
                <th class="tier tier-T5 new-col">New</th>
                <th class="tier tier-T5">Discretion</th>
              </tr>
            </thead>

            <tbody id="tbody">
              <tr data-category="STAFF" data-subcategory="ALL" data-status="ACTIVE">
                <td class="select-cell"><input class="rowCheck" type="checkbox"></td>
                <td class="cvp-cell">STF1</td>

                <td class="rate-cell tier-T1"><span class="current-pill"><i class="fas fa-lock"></i> 2.50</span></td>
                <td class="rate-cell tier-T1 new-col"><input class="new-input" data-tier="T1" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T1"><input class="disc-input" data-tier="T1" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T2"><span class="current-pill"><i class="fas fa-lock"></i> 2.55</span></td>
                <td class="rate-cell tier-T2 new-col"><input class="new-input" data-tier="T2" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T2"><input class="disc-input" data-tier="T2" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T3"><span class="current-pill"><i class="fas fa-lock"></i> 2.60</span></td>
                <td class="rate-cell tier-T3 new-col"><input class="new-input" data-tier="T3" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T3"><input class="disc-input" data-tier="T3" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T4"><span class="current-pill"><i class="fas fa-lock"></i> 2.65</span></td>
                <td class="rate-cell tier-T4 new-col"><input class="new-input" data-tier="T4" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T4"><input class="disc-input" data-tier="T4" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T5"><span class="current-pill"><i class="fas fa-lock"></i> 2.70</span></td>
                <td class="rate-cell tier-T5 new-col"><input class="new-input" data-tier="T5" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T5"><input class="disc-input" data-tier="T5" data-kind="disc" placeholder="—"></td>

                <td>2025-06-01</td>
                <td>—</td>
                <td><span class="status-pill status-active">Active</span></td>
                <td class="actions-cell">
                  <div class="action-group">
                    <button class="action-btn act-copy-new" title="Copy New across this row"><i class="fas fa-arrows-left-right"></i></button>
                    <button class="action-btn act-copy-disc" title="Copy Discretion across this row"><i class="fas fa-repeat"></i></button>
<button class="action-btn danger act-delete" title="Delete row"><i class="fas fa-trash"></i></button>
                  </div>

                  <div class="approve-controls" style="display:none; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap;">
                    <select class="control" style="max-width:140px; padding:8px 10px; border-radius:12px; font-weight:800;">
                      <option value="PENDING" selected>Pending</option>
                      <option value="APPROVED">Approve</option>
                      <option value="DECLINED">Decline</option>
                    </select>
                    <input class="control" type="text" placeholder="Comment (optional)" style="max-width:220px; padding:8px 10px; border-radius:12px; font-weight:700;">
                  </div>

                </td>
              </tr>

              <tr data-category="STAFF" data-subcategory="ALL" data-status="ACTIVE">
                <td class="select-cell"><input class="rowCheck" type="checkbox"></td>
                <td class="cvp-cell">STF2</td>

                <td class="rate-cell tier-T1"><span class="current-pill"><i class="fas fa-lock"></i> 2.45</span></td>
                <td class="rate-cell tier-T1 new-col"><input class="new-input" data-tier="T1" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T1"><input class="disc-input" data-tier="T1" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T2"><span class="current-pill"><i class="fas fa-lock"></i> 2.50</span></td>
                <td class="rate-cell tier-T2 new-col"><input class="new-input" data-tier="T2" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T2"><input class="disc-input" data-tier="T2" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T3"><span class="current-pill"><i class="fas fa-lock"></i> 2.55</span></td>
                <td class="rate-cell tier-T3 new-col"><input class="new-input" data-tier="T3" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T3"><input class="disc-input" data-tier="T3" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T4"><span class="current-pill"><i class="fas fa-lock"></i> 2.60</span></td>
                <td class="rate-cell tier-T4 new-col"><input class="new-input" data-tier="T4" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T4"><input class="disc-input" data-tier="T4" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T5"><span class="current-pill"><i class="fas fa-lock"></i> 2.65</span></td>
                <td class="rate-cell tier-T5 new-col"><input class="new-input" data-tier="T5" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T5"><input class="disc-input" data-tier="T5" data-kind="disc" placeholder="—"></td>

                <td>2025-06-05</td>
                <td>—</td>
                <td><span class="status-pill status-active">Active</span></td>
                <td class="actions-cell">
                  <div class="action-group">
                    <button class="action-btn act-copy-new" title="Copy New across this row"><i class="fas fa-arrows-left-right"></i></button>
                    <button class="action-btn act-copy-disc" title="Copy Discretion across this row"><i class="fas fa-repeat"></i></button>
<button class="action-btn danger act-delete" title="Delete row"><i class="fas fa-trash"></i></button>
                  </div>

                  <div class="approve-controls" style="display:none; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap;">
                    <select class="control" style="max-width:140px; padding:8px 10px; border-radius:12px; font-weight:800;">
                      <option value="PENDING" selected>Pending</option>
                      <option value="APPROVED">Approve</option>
                      <option value="DECLINED">Decline</option>
                    </select>
                    <input class="control" type="text" placeholder="Comment (optional)" style="max-width:220px; padding:8px 10px; border-radius:12px; font-weight:700;">
                  </div>

                </td>
              </tr>

              <tr data-category="STAFF" data-subcategory="ALL" data-status="EXPIRING">
                <td class="select-cell"><input class="rowCheck" type="checkbox"></td>
                <td class="cvp-cell">STF9</td>

                <td class="rate-cell tier-T1"><span class="current-pill"><i class="fas fa-lock"></i> 2.52</span></td>
                <td class="rate-cell tier-T1 new-col"><input class="new-input" data-tier="T1" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T1"><input class="disc-input" data-tier="T1" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T2"><span class="current-pill"><i class="fas fa-lock"></i> 2.57</span></td>
                <td class="rate-cell tier-T2 new-col"><input class="new-input" data-tier="T2" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T2"><input class="disc-input" data-tier="T2" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T3"><span class="current-pill"><i class="fas fa-lock"></i> 2.62</span></td>
                <td class="rate-cell tier-T3 new-col"><input class="new-input" data-tier="T3" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T3"><input class="disc-input" data-tier="T3" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T4"><span class="current-pill"><i class="fas fa-lock"></i> 2.67</span></td>
                <td class="rate-cell tier-T4 new-col"><input class="new-input" data-tier="T4" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T4"><input class="disc-input" data-tier="T4" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T5"><span class="current-pill"><i class="fas fa-lock"></i> 2.72</span></td>
                <td class="rate-cell tier-T5 new-col"><input class="new-input" data-tier="T5" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T5"><input class="disc-input" data-tier="T5" data-kind="disc" placeholder="—"></td>

                <td>2025-06-09</td>
                <td>2025-07-01</td>
                <td><span class="status-pill status-expiring">Expiring</span></td>
                <td class="actions-cell">
                  <div class="action-group">
                    <button class="action-btn act-copy-new" title="Copy New across this row"><i class="fas fa-arrows-left-right"></i></button>
                    <button class="action-btn act-copy-disc" title="Copy Discretion across this row"><i class="fas fa-repeat"></i></button>
<button class="action-btn danger act-delete" title="Delete row"><i class="fas fa-trash"></i></button>
                  </div>

                  <div class="approve-controls" style="display:none; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap;">
                    <select class="control" style="max-width:140px; padding:8px 10px; border-radius:12px; font-weight:800;">
                      <option value="PENDING" selected>Pending</option>
                      <option value="APPROVED">Approve</option>
                      <option value="DECLINED">Decline</option>
                    </select>
                    <input class="control" type="text" placeholder="Comment (optional)" style="max-width:220px; padding:8px 10px; border-radius:12px; font-weight:700;">
                  </div>

                </td>
              </tr>

              <tr data-category="PROMO" data-subcategory="SPRING25" data-status="ACTIVE">
                <td class="select-cell"><input class="rowCheck" type="checkbox"></td>
                <td class="cvp-cell">PRM2</td>

                <td class="rate-cell tier-T1"><span class="current-pill"><i class="fas fa-lock"></i> 2.85</span></td>
                <td class="rate-cell tier-T1 new-col"><input class="new-input" data-tier="T1" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T1"><input class="disc-input" data-tier="T1" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T2"><span class="current-pill"><i class="fas fa-lock"></i> 2.90</span></td>
                <td class="rate-cell tier-T2 new-col"><input class="new-input" data-tier="T2" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T2"><input class="disc-input" data-tier="T2" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T3"><span class="current-pill"><i class="fas fa-lock"></i> 2.95</span></td>
                <td class="rate-cell tier-T3 new-col"><input class="new-input" data-tier="T3" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T3"><input class="disc-input" data-tier="T3" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T4"><span class="current-pill"><i class="fas fa-lock"></i> 3.00</span></td>
                <td class="rate-cell tier-T4 new-col"><input class="new-input" data-tier="T4" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T4"><input class="disc-input" data-tier="T4" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T5"><span class="current-pill"><i class="fas fa-lock"></i> 3.05</span></td>
                <td class="rate-cell tier-T5 new-col"><input class="new-input" data-tier="T5" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T5"><input class="disc-input" data-tier="T5" data-kind="disc" placeholder="—"></td>

                <td>2025-06-10</td>
                <td>—</td>
                <td><span class="status-pill status-active">Active</span></td>
                <td class="actions-cell">
                  <div class="action-group">
                    <button class="action-btn act-copy-new" title="Copy New across this row"><i class="fas fa-arrows-left-right"></i></button>
                    <button class="action-btn act-copy-disc" title="Copy Discretion across this row"><i class="fas fa-repeat"></i></button>
<button class="action-btn danger act-delete" title="Delete row"><i class="fas fa-trash"></i></button>
                  </div>

                  <div class="approve-controls" style="display:none; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap;">
                    <select class="control" style="max-width:140px; padding:8px 10px; border-radius:12px; font-weight:800;">
                      <option value="PENDING" selected>Pending</option>
                      <option value="APPROVED">Approve</option>
                      <option value="DECLINED">Decline</option>
                    </select>
                    <input class="control" type="text" placeholder="Comment (optional)" style="max-width:220px; padding:8px 10px; border-radius:12px; font-weight:700;">
                  </div>

                </td>
              </tr>

              <tr data-category="NTB" data-subcategory="ALL" data-status="INACTIVE">
                <td class="select-cell"><input class="rowCheck" type="checkbox"></td>
                <td class="cvp-cell">NTB7</td>

                <td class="rate-cell tier-T1"><span class="current-pill"><i class="fas fa-lock"></i> 3.25</span></td>
                <td class="rate-cell tier-T1 new-col"><input class="new-input" data-tier="T1" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T1"><input class="disc-input" data-tier="T1" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T2"><span class="current-pill"><i class="fas fa-lock"></i> 3.25</span></td>
                <td class="rate-cell tier-T2 new-col"><input class="new-input" data-tier="T2" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T2"><input class="disc-input" data-tier="T2" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T3"><span class="current-pill"><i class="fas fa-lock"></i> 3.25</span></td>
                <td class="rate-cell tier-T3 new-col"><input class="new-input" data-tier="T3" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T3"><input class="disc-input" data-tier="T3" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T4"><span class="current-pill"><i class="fas fa-lock"></i> 3.25</span></td>
                <td class="rate-cell tier-T4 new-col"><input class="new-input" data-tier="T4" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T4"><input class="disc-input" data-tier="T4" data-kind="disc" placeholder="—"></td>

                <td class="rate-cell tier-T5"><span class="current-pill"><i class="fas fa-lock"></i> 3.25</span></td>
                <td class="rate-cell tier-T5 new-col"><input class="new-input" data-tier="T5" data-kind="new" placeholder="—"></td>
                <td class="rate-cell tier-T5"><input class="disc-input" data-tier="T5" data-kind="disc" placeholder="—"></td>

                <td>2025-05-01</td>
                <td>2025-06-01</td>
                <td><span class="status-pill status-inactive">Inactive</span></td>
                <td class="actions-cell">
                  <div class="action-group">
                    <button class="action-btn act-copy-new" title="Copy New across this row"><i class="fas fa-arrows-left-right"></i></button>
                    <button class="action-btn act-copy-disc" title="Copy Discretion across this row"><i class="fas fa-repeat"></i></button>
<button class="action-btn danger act-delete" title="Delete row"><i class="fas fa-trash"></i></button>
                  </div>

                  <div class="approve-controls" style="display:none; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap;">
                    <select class="control" style="max-width:140px; padding:8px 10px; border-radius:12px; font-weight:800;">
                      <option value="PENDING" selected>Pending</option>
                      <option value="APPROVED">Approve</option>
                      <option value="DECLINED">Decline</option>
                    </select>
                    <input class="control" type="text" placeholder="Comment (optional)" style="max-width:220px; padding:8px 10px; border-radius:12px; font-weight:700;">
                  </div>

                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="pager">
          <div class="pager-left">
            <span id="pagerInfo">Showing 1–5 of 5</span>
          </div>

          <div class="pager-right">
            <span style="color:#6b7280; font-weight:900; font-size:12px;">Rows</span>
            <select class="pager-select" id="rowsPerPage">
              <option value="5" selected>5</option>
              <option value="10">10</option>
              <option value="20">20</option>
            </select>

            <div class="page-controls">
              <button class="page-btn" id="btnPrev" title="Prev"><i class="fas fa-chevron-left"></i></button>
              <div class="page-pill" id="pagePill">1</div>
              <button class="page-btn" id="btnNext" title="Next"><i class="fas fa-chevron-right"></i></button>
            </div>
          </div>
        </div>
      </section>

      <section class="table-card section-approve" id="approveSection">
        <div class="table-toolbar">
          <div class="toolbar-left">
            <span class="chip"><i class="fas fa-circle-notch"></i> Pending tier changes</span>
          </div>
          <div class="toolbar-right">
            <button class="mini-btn" id="btnApproveDownload"><i class="fas fa-download"></i> Download</button>
            <button class="mini-btn primary" id="btnApproveSubmit"><i class="fas fa-paper-plane"></i> Submit Decisions</button>
          </div>
        </div>

        <div class="table-container">
          <table class="rate-table" id="approveTable">
            <thead>
              <tr>
                <th>CVP</th>
                <th>Amount Tier</th>
                <th>Current</th>
                <th>Requested</th>
                <th>Any Change?</th>
                <th>Submitted By</th>
                <th>Submitted On</th>
                <th>Eff. Date</th>
                <th>Expiry</th>
                <th>Decision</th>
                <th>Comment</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="cvp-cell">AAXX</td>
                <td>&lt;5k</td>
                <td><span class="current-pill"><i class="fas fa-lock"></i> 2.50</span></td>
                <td><span class="current-pill" style="background:var(--blue-weak);"><i class="fas fa-pen"></i> 2.65</span></td>
                <td>Yes</td>
                <td>user1</td>
                <td>2025-06-08</td>
                <td>2025-06-10</td>
                <td>—</td>
                <td style="min-width:160px;">
                  <select class="control approveDecision">
                    <option value="APPROVE">Approve</option>
                    <option value="DECLINE">Decline</option>
                  </select>
                </td>
                <td style="min-width:260px;">
                  <input class="control approveComment" type="text" placeholder="Comment (required if declined)" />
                </td>
              </tr>

              <tr>
                <td class="cvp-cell">AAXX</td>
                <td>5–10k</td>
                <td><span class="current-pill"><i class="fas fa-lock"></i> 2.55</span></td>
                <td><span class="current-pill" style="background:var(--blue-weak);"><i class="fas fa-pen"></i> 2.70</span></td>
                <td>Yes</td>
                <td>user1</td>
                <td>2025-06-08</td>
                <td>2025-06-10</td>
                <td>—</td>
                <td>
                  <select class="control approveDecision">
                    <option value="APPROVE">Approve</option>
                    <option value="DECLINE">Decline</option>
                  </select>
                </td>
                <td>
                  <input class="control approveComment" type="text" placeholder="Comment (required if declined)" />
                </td>
              </tr>

              <tr>
                <td class="cvp-cell">STF9</td>
                <td>10–15k</td>
                <td><span class="current-pill"><i class="fas fa-lock"></i> 2.62</span></td>
                <td><span class="current-pill" style="background:var(--blue-weak);"><i class="fas fa-pen"></i> 2.62</span></td>
                <td>No</td>
                <td>user2</td>
                <td>2025-06-09</td>
                <td>2025-06-12</td>
                <td>2025-07-01</td>
                <td>
                  <select class="control approveDecision">
                    <option value="APPROVE">Approve</option>
                    <option value="DECLINE">Decline</option>
                  </select>
                </td>
                <td>
                  <input class="control approveComment" type="text" placeholder="Comment (required if declined)" />
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="pager">
          <div class="pager-left"><span>Approve is tier-level: CVP + Amount Tier.</span></div>
          <div class="pager-right"><span style="color:#6b7280; font-weight:900; font-size:12px;">—</span></div>
        </div>
      </section>

      <section class="table-card section-history" id="historySection">
        <div class="table-toolbar">
          <div class="toolbar-left">
            <span class="chip"><i class="far fa-clock"></i> Audit trail</span>
          </div>
          <div class="toolbar-right">
            <button class="mini-btn" id="btnHistoryDownload"><i class="fas fa-download"></i> Download</button>
          </div>
        </div>

        <div class="table-container">
          <table class="rate-table" id="historyTable">
            <thead>
              <tr>
                <th>CVP</th>
                <th>Amount Tier</th>
                <th>Old</th>
                <th>New</th>
                <th>Changed By</th>
                <th>Changed On</th>
                <th>Decision</th>
                <th>Decision By</th>
                <th>Decision On</th>
                <th>Comment</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="cvp-cell">AAXX</td>
                <td>&lt;5k</td>
                <td>2.50</td>
                <td>2.65</td>
                <td>user1</td>
                <td>2025-06-08</td>
                <td><span class="status-pill" style="background:#dcfce7;color:#166534;">Approved</span></td>
                <td>approver1</td>
                <td>2025-06-09</td>
                <td>OK</td>
              </tr>
              <tr>
                <td class="cvp-cell">AAXX</td>
                <td>5–10k</td>
                <td>2.55</td>
                <td>2.70</td>
                <td>user1</td>
                <td>2025-06-08</td>
                <td><span class="status-pill" style="background:#fee2e2;color:#991b1b;">Declined</span></td>
                <td>approver1</td>
                <td>2025-06-09</td>
                <td>Please use standard margin for this tier.</td>
              </tr>
              <tr>
                <td class="cvp-cell">STF9</td>
                <td>10–15k</td>
                <td>2.62</td>
                <td>2.62</td>
                <td>user2</td>
                <td>2025-06-09</td>
                <td><span class="status-pill status-expiring">Pending</span></td>
                <td>—</td>
                <td>—</td>
                <td>—</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="pager">
          <div class="pager-left"><span>History includes who/when/what changed.</span></div>
          <div class="pager-right"><span style="color:#6b7280; font-weight:900; font-size:12px;">—</span></div>
        </div>
      </section>

<div class="toast-wrap" id="toastWrap" aria-live="polite" aria-atomic="true"></div>
    </div>
  </main>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    function toast(title, msg, icon="fa-circle-check"){
      const wrap = $("#toastWrap");
      const el = document.createElement("div");
      el.className = "toast-lite";
      el.innerHTML = `
        <div class="ticon"><i class="fas ${icon}"></i></div>
        <div class="tmeta">
          <div class="t1">${title}</div>
          <div class="t2">${msg}</div>
        </div>
        <button aria-label="Close"><i class="fas fa-xmark"></i></button>
      `;
      el.querySelector("button").addEventListener("click", () => el.remove());
      wrap.appendChild(el);
      setTimeout(() => el.remove(), 3800);
    }

    // ----- Subcategory mapping (placeholder) -----
    const SUBS = {
      "STAFF": ["ALL"],
      "PROMO": ["SPRING25", "SUMMER25"],
      "NTB": ["ALL"]
    };

    function rebuildSubcategories(){
      const cat = $("#categorySelect").value;
      const subSel = $("#subcategorySelect");
      const hint = $("#subHint");

      const list = (cat === "ALL") ? ["ALL subcategories"] : (SUBS[cat] || []);
      subSel.innerHTML = "";

      if (cat === "ALL") {
        subSel.add(new Option("All subcategories", "ALL", true, true));
        subSel.disabled = false;
        hint.textContent = "If a category has no subcategories, this stays disabled.";
        return;
      }

      if (!list.length || (list.length === 1 && list[0] === "ALL")) {
        subSel.add(new Option("All subcategories", "ALL", true, true));
        subSel.disabled = true;
        hint.textContent = "This category has no subcategories.";
        return;
      }

      subSel.add(new Option("All subcategories", "ALL", true, true));
      list.forEach(v => subSel.add(new Option(v, v)));
      subSel.disabled = false;
      hint.textContent = "Pick a subcategory to narrow the table.";
    }

    $("#categorySelect").addEventListener("change", () => {
      rebuildSubcategories();
      applyAll();
    });
    $("#subcategorySelect").addEventListener("change", applyAll);

    // ----- Tier multi-select (hide/show columns) -----
    function closeMenus(except){
      if (except !== "tierMenu") $("#tierMenu")?.classList.remove("open");
      if (except !== "statusMenu") $("#statusMenu")?.classList.remove("open");
    }
    $("#statusBtn")?.addEventListener("click", (e) => {
      e.preventDefault();
      $("#statusMenu").classList.toggle("open");
    });

    $("#tierBtn").addEventListener("click", (e) => {
      e.preventDefault();
      $("#tierMenu").classList.toggle("open");
    });
    document.addEventListener("click", (e) => {
      const inTier = $("#tierMulti")?.contains(e.target);
      const inStatus = $("#statusMulti")?.contains(e.target);
      if (!inTier && !inStatus) closeMenus(null);
    });

    function getSelectedTiers(){
      return $$(".tierCheck").filter(cb => cb.checked).map(cb => cb.value);
    }
    function updateTierLabel(){
      const n = getSelectedTiers().length;
      $("#tierBtnLabel").textContent = (n === 5) ? "All tiers selected" : (n === 0) ? "No tiers selected" : `${n} tier(s) selected`;
    }
    function applyTierVisibility(){
      const selected = new Set(getSelectedTiers());
      ["T1","T2","T3","T4","T5"].forEach(t => {
        const hide = !selected.has(t);
        $$(".tier-" + t).forEach(el => el.classList.toggle("tier-hidden", hide));
      });
    }
    $$(".tierCheck").forEach(cb => cb.addEventListener("change", () => {
      updateTierLabel();
      applyTierVisibility();
    }));

    
    function getSelectedStatuses(){
      return $$(".statusCheck").filter(cb => cb.checked).map(cb => cb.value);
    }
    function updateStatusLabel(){
      const n = getSelectedStatuses().length;
      $("#statusBtnLabel").textContent =
        (n === 3) ? "All statuses selected" :
        (n === 0) ? "No statuses selected" :
        `${n} status(es) selected`;
    }
    $$(".statusCheck").forEach(cb => cb.addEventListener("change", () => {
      updateStatusLabel();
      applyAll();
    }));
    updateStatusLabel();

// ----- Validation + KPI -----
    function parseRate(v){
      if (v == null) return null;
      const s = String(v).trim();
      if (s === "" || s === "—" || s === "-") return null;
      const n = Number(s);
      if (!Number.isFinite(n)) return NaN;
      return n;
    }
    function validateNew(input){
      const n = parseRate(input.value);
      if (n === null) return true;
      return Number.isFinite(n) && n >= 0 && n <= 30;
    }
    function rowState(tr){
      const inputs = Array.from(tr.querySelectorAll("input.new-input, input.disc-input"));
      const anyValue = inputs.some(i => String(i.value).trim() !== "");
      const anyInvalid = inputs.some(i => i.classList.contains("new-input") && !validateNew(i));
      return { anyValue, anyInvalid };
    }
    function getVisiblePageRows(){
      const rows = getFilteredRows();
      const size = pageSize();
      const start = (currentPage - 1) * size;
      return rows.slice(start, start + size);
    }
    function refreshKpis(){
      const visible = getVisiblePageRows();
      const edited = visible.filter(r => rowState(r).anyValue).length;
      const invalid = visible.filter(r => rowState(r).anyInvalid).length;
      $("#kpiEdited").textContent = edited;
      $("#kpiInvalid").textContent = invalid;
      const c1 = $("#kpiEditedCard");
      const c2 = $("#kpiInvalidCard");
      if (c1) c1.textContent = edited;
      if (c2) c2.textContent = invalid;
    }
    function markChanged(input){
      const v = String(input.value).trim();
      input.classList.toggle("changed", v !== "");
      if (input.classList.contains("new-input")){
        input.classList.toggle("is-invalid", !validateNew(input) && v !== "");
        input.classList.toggle("is-valid", validateNew(input) && v !== "");
      }
      autoSave();
      refreshKpis();
    }
    $$(".new-input, .disc-input").forEach(inp => {
      inp.addEventListener("input", () => markChanged(inp));
      inp.addEventListener("blur", () => markChanged(inp));
    });

    // ----- Row selection -----
    function syncSelectAllState(){
      const rows = getVisiblePageRows();
      const checks = rows.map(r => r.querySelector(".rowCheck"));
      const any = checks.length && checks.some(c => c.checked);
      const all = checks.length && checks.every(c => c.checked);
      $("#selectAll").indeterminate = any && !all;
      $("#selectAll").checked = all;
    }
    $("#selectAll").addEventListener("change", () => {
      const rows = getVisiblePageRows();
      rows.forEach(r => r.querySelector(".rowCheck").checked = $("#selectAll").checked);
      syncSelectAllState();
    });
    $$(".rowCheck").forEach(cb => cb.addEventListener("change", syncSelectAllState));

    // ----- Filtering + Pagination -----
    let currentPage = 1;
    function getActiveStatusSet(){
      return new Set($$(".statusCheck").filter(cb => cb.checked).map(cb => cb.value));
    }

    function matchesFilters(tr){
      const cat = $("#categorySelect").value;
      const sub = $("#subcategorySelect").value;
      const term = $("#globalSearch").value.trim().toLowerCase();
      const statusSet = getActiveStatusSet();

      const rowCat = tr.getAttribute("data-category") || "STAFF";
      const rowSub = tr.getAttribute("data-subcategory") || "ALL";
      const rowStatus = tr.getAttribute("data-status") || "ACTIVE";

      const catOk = (cat === "ALL") || (rowCat === cat);
      const subOk = (sub === "ALL") || (rowSub === sub);
      const statusOk = statusSet.has(rowStatus);
      const searchOk = !term || tr.textContent.toLowerCase().includes(term);

      return catOk && subOk && statusOk && searchOk;
    }

    function getFilteredRows(){
      return $$("#tbody tr").filter(matchesFilters);
    }

    function pageSize(){
      return Number($("#rowsPerPage").value) || 5;
    }

    function clampPage(){
      const total = getFilteredRows().length;
      const pages = Math.max(1, Math.ceil(total / pageSize()));
      currentPage = Math.min(Math.max(1, currentPage), pages);
      $("#pagePill").textContent = String(currentPage);
      $("#btnPrev").disabled = (currentPage === 1);
      $("#btnNext").disabled = (currentPage === pages);
    }

    function renderTable(){
      const all = $$("#tbody tr");
      all.forEach(r => r.style.display = "none");

      clampPage();

      const rows = getVisiblePageRows();
      rows.forEach(r => r.style.display = "");

      const total = getFilteredRows().length;
      const size = pageSize();
      const start = total ? ((currentPage - 1) * size + 1) : 0;
      const end = Math.min(currentPage * size, total);
      $("#pagerInfo").textContent = `Showing ${start}–${end} of ${total}`;

      syncSelectAllState();
      refreshKpis();
    }

    function applyAll(){
      currentPage = 1;
      renderTable();
    }

        $("#globalSearch").addEventListener("input", applyAll);
    $("#rowsPerPage").addEventListener("change", () => { currentPage = 1; renderTable(); });
    $("#btnPrev").addEventListener("click", () => { currentPage--; renderTable(); });
    $("#btnNext").addEventListener("click", () => { currentPage++; renderTable(); });

    // ----- Copy helpers (global) -----
    function copyDownVisible(kind){
      // Copy the first non-empty value in each visible column DOWN the page (blank cells only)
      const rows = getVisiblePageRows();
      if (!rows.length) return;

      const cls = (kind === "new") ? ".new-input" : ".disc-input";
      const cols = Array.from(rows[0].querySelectorAll(cls)).map((_, idx) => idx);

      cols.forEach(colIdx => {
        // find source value for this column
        let src = "";
        for (const tr of rows){
          const el = tr.querySelectorAll(cls)[colIdx];
          if (!el) continue;
          const v = String(el.value || "").trim();
          if (v !== ""){
            src = v;
            break;
          }
        }
        if (!src) return;

        // fill down blanks
        for (const tr of rows){
          const el = tr.querySelectorAll(cls)[colIdx];
          if (!el) continue;
          if (String(el.value || "").trim() === ""){
            el.value = src;
          }
        }
      });
    }

    $("#btnCopyNewAcross").addEventListener("click", () => {
      copyDownVisible("new");
      toast("Copied", "New values copied down (blank cells only).", "fa-wand-magic-sparkles");
    });

    $("#btnCopyDiscAcross").addEventListener("click", () => {
      copyDownVisible("disc");
      toast("Copied", "Discretion copied down (blank cells only).", "fa-copy");
    });

    if ($("#btnResetAll")) $("#btnResetAll").addEventListener("click", () => {
      $$(".new-input, .disc-input").forEach(i => {
        i.value = "";
        i.classList.remove("changed","is-valid","is-invalid");
      });
      toast("Reset", "All New + Discretion cleared.", "fa-rotate-left");
      autoSave(true);
      refreshKpis();
    });

    // ----- Row actions (per-row) -----
    function copyRowAcross(tr, kind){
      const inputs = Array.from(tr.querySelectorAll(kind === "new" ? ".new-input" : ".disc-input"));
      const first = inputs.find(i => String(i.value).trim() !== "");
      if (!first) return;
      inputs.forEach(i => {
        if (i === first) return;
        if (String(i.value).trim() === "") {
          i.value = first.value;
          markChanged(i);
        }
      });
    }

    function bindRowActions(tr){
      tr.querySelector(".act-copy-new").addEventListener("click", () => {
        copyRowAcross(tr, "new");
        toast("Copied", "New copied across this row.", "fa-arrows-left-right");
      });
      tr.querySelector(".act-copy-disc").addEventListener("click", () => {
        copyRowAcross(tr, "disc");
        toast("Copied", "Discretion copied across this row.", "fa-repeat");
      });
      const dup = tr.querySelector(".act-duplicate");
      if (dup) dup.addEventListener("click", () => cloneRow(tr));
      tr.querySelector(".act-delete").addEventListener("click", () => deleteRow(tr));
    }

    function cloneRow(tr){
      const clone = tr.cloneNode(true);
      clone.querySelector(".rowCheck").checked = false;
      clone.querySelectorAll(".new-input, .disc-input").forEach(inp => {
        inp.classList.remove("changed","is-valid","is-invalid");
        inp.value = "";
        inp.addEventListener("input", () => markChanged(inp));
        inp.addEventListener("blur", () => markChanged(inp));
      });
      clone.querySelector(".rowCheck").addEventListener("change", syncSelectAllState);
      bindRowActions(clone);
      tr.parentNode.insertBefore(clone, tr.nextSibling);
      toast("Row added", "Duplicated row structure (values cleared).", "fa-plus");
      applyAll();
    }

    function deleteRow(tr){
      tr.remove();
      toast("Row removed", "Row deleted (placeholder).", "fa-trash");
      applyAll();
    }

    $$("#tbody tr").forEach(tr => bindRowActions(tr));

    // ----- Draft (localStorage placeholder) -----
    const DRAFT_KEY = "td_enter_rates_elog_v2";

    function serializeDraft(){
      const rows = $$("#tbody tr").map(tr => {
        const cvp = tr.querySelector(".cvp-cell")?.textContent?.trim() || "";
        const data = {};
        ["T1","T2","T3","T4","T5"].forEach(t => {
          const newInp = tr.querySelector(`.new-input[data-tier="${t}"]`);
          const discInp = tr.querySelector(`.disc-input[data-tier="${t}"]`);
          data[t] = { new: newInp?.value || "", disc: discInp?.value || "" };
        });

        return {
          cvp,
          category: tr.getAttribute("data-category"),
          subcategory: tr.getAttribute("data-subcategory"),
          status: tr.getAttribute("data-status"),
          selected: tr.querySelector(".rowCheck")?.checked || false,
          data
        };
      });

      return {
        categoryFilter: $("#categorySelect").value,
        subcategoryFilter: $("#subcategorySelect").value,
        statusFilter: Array.from(getActiveStatusSet()),
        tiers: getSelectedTiers(),
        search: $("#globalSearch").value,
        rows
      };
    }

    let autosaveTimer = null;
    function autoSave(){
      clearTimeout(autosaveTimer);
      autosaveTimer = setTimeout(() => {
        try{ localStorage.setItem(DRAFT_KEY, JSON.stringify(serializeDraft())); }catch(e){}
      }, 240);
    }

    function saveDraft(){
      try{
        localStorage.setItem(DRAFT_KEY, JSON.stringify(serializeDraft()));
        toast("Draft saved", "Stored locally (placeholder for API save).", "fa-floppy-disk");
      }catch(e){
        toast("Draft error", "Could not save draft.", "fa-triangle-exclamation");
      }
    }

    function loadDraft(){
      try{
        const raw = localStorage.getItem(DRAFT_KEY);
        if (!raw) return false;
        const d = JSON.parse(raw);

        if (d.categoryFilter) $("#categorySelect").value = d.categoryFilter;
        rebuildSubcategories();
        if (d.subcategoryFilter) $("#subcategorySelect").value = d.subcategoryFilter;

        const want = new Set(d.statusFilter || []);
        $$(".statusCheck").forEach(cb => cb.checked = want.has(cb.value));

        const tiers = new Set(d.tiers || []);
        $$(".tierCheck").forEach(cb => cb.checked = tiers.size ? tiers.has(cb.value) : true);
        updateTierLabel();
        applyTierVisibility();

        if (typeof d.search === "string") $("#globalSearch").value = d.search;

        const byCvp = new Map((d.rows || []).map(r => [r.cvp, r]));
        $$("#tbody tr").forEach(tr => {
          const cvp = tr.querySelector(".cvp-cell")?.textContent?.trim() || "";
          const row = byCvp.get(cvp);
          if (!row) return;

          const cbox = tr.querySelector(".rowCheck");
          if (cbox) cbox.checked = !!row.selected;

          ["T1","T2","T3","T4","T5"].forEach(t => {
            const newInp = tr.querySelector(`.new-input[data-tier="${t}"]`);
            const discInp = tr.querySelector(`.disc-input[data-tier="${t}"]`);
            if (newInp) newInp.value = row.data?.[t]?.new ?? "";
            if (discInp) discInp.value = row.data?.[t]?.disc ?? "";
            if (newInp) markChanged(newInp);
            if (discInp) markChanged(discInp);
          });
        });

        return true;
      }catch(e){
        return false;
      }
    }

    $("#btnSaveDraft").addEventListener("click", saveDraft);

    // ----- Submit -----
    function selectedRowsOnly(){
      const rows = getFilteredRows();
      const sel = rows.filter(r => r.querySelector(".rowCheck")?.checked);
      return sel.length ? sel : rows.filter(r => rowState(r).anyValue);
    }

    function submit(){
      const rows = selectedRowsOnly();
      const edited = rows.filter(r => rowState(r).anyValue).length;

      if (!edited){
        toast("Nothing to submit", "Select rows or add at least one New rate / Discretion.", "fa-circle-info");
        return;
      }
      const invalid = rows.filter(r => rowState(r).anyInvalid);
      if (invalid.length){
        toast("Fix validation first", `${invalid.length} selected/edited row(s) have invalid New rates (0–30).`, "fa-triangle-exclamation");
        return;
      }
      toast("Submitted", "Submitted for review (placeholder). Reviewer gets notified.", "fa-paper-plane");
    }

    $("#btnSubmit").addEventListener("click", submit);

    // ----- Clear all -----
    $("#clearAll").addEventListener("click", (e) => {
      e.preventDefault();
      $("#categorySelect").value = "ALL";
      rebuildSubcategories();
      $("#subcategorySelect").value = "ALL";
      $("#globalSearch").value = "";

      $$(".statusCheck").forEach(cb => cb.checked = (cb.value !== "INACTIVE"));

      $$(".tierCheck").forEach(cb => cb.checked = true);
      updateTierLabel();
      applyTierVisibility();

      $$(".rowCheck").forEach(cb => cb.checked = false);
      $("#selectAll").checked = false;
      $("#selectAll").indeterminate = false;

      applyAll();
      toast("Cleared", "Filters reset.", "fa-filter-circle-xmark");
    });

    // ----- Buttons placeholders -----
    $("#btnUpload").addEventListener("click", () => toast("Upload", "Upload Excel/CSV (placeholder).", "fa-upload"));
    $("#btnDownload").addEventListener("click", () => toast("Download", "Download current + draft (placeholder).", "fa-download"));
    $("#btnEmail").addEventListener("click", () => toast("Email", "Email reviewers / distribution list (placeholder).", "fa-envelope"));
    $("#btnNotif").addEventListener("click", () => toast("Notifications", "Reviewer feedback + rate alerts (placeholder).", "fa-bell"));
    $("#btnMsg").addEventListener("click", () => toast("Messages", "Threaded batch comments (placeholder).", "fa-comment-dots"));

    // ----- Init -----
    rebuildSubcategories();
    updateTierLabel();
    applyTierVisibility();

    const loaded = loadDraft();
    applyAll();
    if (loaded) toast("Draft loaded", "Resumed your last saved draft (local placeholder).", "fa-rotate");
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Tabs are visual modes (same layout, consistent filters/cards/table across all 4)
    (function(){
      const tabs = Array.from(document.querySelectorAll('#rateTabs .nav-link'));
      const titleH1 = document.querySelector('.top-header .title h1');
      const subtitle = document.querySelector('.top-header .title small');

      const MODE_META = {
        view:   { icon: 'far fa-eye',              color: 'var(--blue)', text: 'View Rates',   sub: 'Admin view of all rates (read-only).' },
        enter:  { icon: 'fas fa-pen-to-square',    color: 'var(--blue)', text: 'Enter Rates (e-Log)', sub: 'Only New Rate + Discretion are editable. Current stays visible.' },
        approve:{ icon: 'far fa-circle-check',     color: 'var(--blue)', text: 'Approve Rates', sub: 'Review and approve/decline rate changes.' },
        history:{ icon: 'far fa-clock',            color: 'var(--blue)', text: 'Rate History', sub: 'View past submissions and changes.' }
      };

      function setMode(mode){
        tabs.forEach(t => {
          const active = (t.getAttribute('data-mode') === mode);
          t.classList.toggle('active', active);
          t.setAttribute('aria-selected', active ? 'true' : 'false');
        });

        // Apply mode class to body for CSS toggles
        document.body.classList.remove('mode-view','mode-enter','mode-status','mode-approve','mode-history');
        document.body.classList.add('mode-' + mode);

        // Adjust tier group colspans when New column is hidden (View mode)
        const tierHeads = Array.from(document.querySelectorAll('th.tier-head'));
        tierHeads.forEach(th => {
          th.colSpan = (mode === 'view') ? 2 : 3;
        });

        const meta = MODE_META[mode] || MODE_META.enter;
        if (titleH1){
          titleH1.innerHTML = `<i class="${meta.icon}" style="color:${meta.color}"></i> ${meta.text}`;
        }
        if (subtitle) subtitle.textContent = meta.sub;
      }

      setMode('enter');

      tabs.forEach(t => t.addEventListener('click', (e) => {
        e.preventDefault();
        setMode(t.getAttribute('data-mode'));
      }));
    })();
  </script>
</body>
</html>
