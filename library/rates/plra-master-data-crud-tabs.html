<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PLRA Master Data - CRUD</title>

  <!-- Bootstrap + Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --td-green: #008A00;
      --td-green-dark: #006B00;
      --td-green-light: #E8F5E9;
      --sidebar-bg: #1a1d21;
      --sidebar-hover: #2d3136;
      --content-bg: #ffffff;
      --card-bg: #ffffff;
      --text-primary: #1d1d1d;
      --text-secondary: #616161;
      --text-muted: #9e9e9e;
      --border-color: #e5e7eb;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.06);
      --transition-fast: 0.15s ease;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'DM Sans', 'Source Sans Pro', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--content-bg);
      color: var(--text-primary);
      overflow-x: hidden;
    }

    /* Sidebar (fixed width, no expand) */
    .sidebar {
      position: fixed;
      left: 0; top: 0;
      width: 68px;
      height: 100vh;
      background: var(--sidebar-bg);
      display: flex;
      flex-direction: column;
      z-index: 1000;
    }

    .sidebar-brand {
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      min-height: 64px;
    }

    .brand-icon {
      width: 36px; height: 36px;
      background: var(--td-green);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 14px;
      flex-shrink: 0;
    }

    .sidebar-nav {
      flex: 1;
      padding: 16px 8px;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 12px 8px;
      color: rgba(255,255,255,0.7);
      text-decoration: none;
      border-radius: 8px;
      margin-bottom: 4px;
      transition: all var(--transition-fast);
      cursor: pointer;
      position: relative;
    }

    .nav-item:hover { background: var(--sidebar-hover); color: #fff; }
    .nav-item.active { background: var(--td-green); color: #fff; }

    .nav-item i { font-size: 18px; }
    .nav-item span { display: none; } /* Titles shown via tooltip only */

    /* lightweight tooltip (no sidebar resize) */
    .nav-item[data-title]::after {
      content: attr(data-title);
      position: absolute;
      left: 74px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.85);
      color: #fff;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 8px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition-fast);
    }
    .nav-item:hover::after { opacity: 1; }

    .sidebar-footer {
      padding: 12px;
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: center;
    }

    .user-avatar {
      width: 36px; height: 36px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: transform var(--transition-fast);
    }
    .user-avatar:hover { transform: scale(1.05); }

    /* Main */
    .main-content {
      margin-left: 68px;
      min-height: 100vh;
      background: var(--content-bg);
    }

    /* Header */
    .top-header {
      background: var(--card-bg);
      padding: 16px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .page-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .page-subtitle {
      font-size: 12px;
      color: var(--text-muted);
      font-weight: 500;
      margin-top: 2px;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .btn-icon {
      width: 40px;
      height: 40px;
      border: none;
      background: transparent;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    .btn-icon:hover { background: #f5f6f7; color: var(--text-primary); }

    /* Prime rate inline in header */
    .prime-pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:10px;
      border:1px solid var(--border-color);
      background: var(--td-green-light);
      color: var(--td-green-dark);
      font-weight:800;
      font-size:13px;
      line-height:1;
      white-space:nowrap;
    }
    .prime-pill .label{
      font-weight:700;
      color: var(--td-green-dark);
      opacity:0.9;
      font-size:12px;
      letter-spacing:0.2px;
    }
    .prime-pill .value{
      font-size:14px;
      color: var(--td-green);
    }


    /* Content */
    .content-area { padding: 24px 32px; }

    /* Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 22px;
    }

    .stat-card {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 14px 18px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: 14px;
      min-height: 74px;
    }

    .stat-icon {
      width: 40px; height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    .stat-icon.green { background: var(--td-green-light); color: var(--td-green); }
    .stat-icon.blue { background: #e3f2fd; color: #1976d2; }
    .stat-icon.orange { background: #fff3e0; color: #f57c00; }
    .stat-icon.purple { background: #f3e5f5; color: #7b1fa2; }

    .stat-label { font-size: 12px; color: var(--text-muted); margin-bottom: 2px; }
    .stat-value { font-size: 22px; font-weight: 700; color: var(--text-primary); }
    .stat-value.rate { color: var(--td-green); }

    /* Search row */
    .search-actions-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 16px;
    }

    .search-container {
      position: relative;
      flex: 1;
      max-width: none; /* take the space */
    }

    .search-container input {
      width: 100%;
      padding: 10px 16px 10px 44px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      font-size: 14px;
      background: var(--card-bg);
      transition: all var(--transition-fast);
    }

    .search-container input:focus {
      outline: none;
      border-color: var(--td-green);
      box-shadow: 0 0 0 3px var(--td-green-light);
    }

    .search-container i {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      font-size: 14px;
    }

    .action-buttons {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }

    .btn-action {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 9px 14px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      border: 1px solid var(--border-color);
      background: var(--card-bg);
      color: var(--text-secondary);
    }

    .btn-action:hover {
      background: #f5f6f7;
      color: var(--text-primary);
      border-color: #d1d5db;
    }

    .btn-action.primary {
      background: var(--td-green);
      color: #fff;
      border-color: var(--td-green);
    }
    .btn-action.primary:hover {
      background: var(--td-green-dark);
      border-color: var(--td-green-dark);
    }

    /* Layout */
    .main-layout { display: flex; gap: 20px; }

    /* Filter Panel */
    .filter-panel { width: 240px; flex-shrink: 0; }
    .filter-card {
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
      padding: 16px;
      position: sticky;
      top: 88px; /* under header */
    }

    .filter-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .filter-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .clear-filters {
      font-size: 12px;
      color: var(--td-green);
      cursor: pointer;
      text-decoration: none;
      font-weight: 600;
    }
    .clear-filters:hover { text-decoration: underline; }

    .filter-section { margin-bottom: 16px; }
    .filter-section:last-child { margin-bottom: 0; }

    .filter-label {
      font-size: 12px;
      font-weight: 700;
      color: var(--text-secondary);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .filter-select {
      width: 100%;
      padding: 9px 12px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      font-size: 13px;
      color: var(--text-primary);
      background: var(--card-bg);
      cursor: pointer;
    }

    .filter-select:focus { outline: none; border-color: var(--td-green); }

    /* Multi-select dropdown with checkboxes */
    .multi-select {
      position: relative;
      width: 100%;
    }

    .multi-btn {
      width: 100%;
      padding: 9px 12px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      font-size: 13px;
      background: var(--card-bg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      color: var(--text-primary);
    }

    .multi-btn.disabled {
      background: #fafafa;
      color: var(--text-muted);
      cursor: not-allowed;
    }

    .multi-menu {
      position: absolute;
      left: 0;
      top: calc(100% + 8px);
      width: 100%;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      box-shadow: 0 10px 22px rgba(0,0,0,0.10);
      padding: 10px 10px;
      z-index: 50;
      display: none;
      max-height: 240px;
      overflow: auto;
    }

    .multi-menu.open { display: block; }

    .multi-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 8px;
      border-radius: 10px;
      cursor: pointer;
    }
    .multi-item:hover { background: #f6f7f8; }

    .multi-item input {
      width: 16px;
      height: 16px;
      accent-color: var(--td-green);
      cursor: pointer;
    }
    .multi-item span { font-size: 13px; color: var(--text-primary); }

    .hint-text { font-size: 12px; color: var(--text-muted); margin-top: 6px; }

    /* Status checkboxes (keep simple) */
    .filter-checkbox {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 6px 0;
      cursor: pointer;
    }
    .filter-checkbox input {
      width: 16px; height: 16px;
      accent-color: var(--td-green);
      cursor: pointer;
    }
    .filter-checkbox span { font-size: 13px; color: var(--text-primary); }

    /* Table */
    .table-section { flex: 1; min-width: 0; }

    .table-card {
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
      overflow: hidden;
    }

    .table-container {
      overflow-x: auto;
      padding: 12px 14px 0 14px;
      background: #fff;
    }

    .rate-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .rate-table thead th {
      background: #f7f8fa;
      color: var(--text-secondary);
      padding: 14px 16px;
      text-align: left;
      font-size: 12px;
      font-weight: 700;
      white-space: nowrap;
      border-top: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
    }

    .rate-table thead th.tier-header {
      text-align: center;
      border-left: 1px solid var(--border-color);
    }

    .rate-table thead .tier-row th {
      padding: 8px 10px;
      font-size: 11px;
      background: #f1f3f5;
      font-weight: 700;
    }

    .rate-table tbody td {
      padding: 14px 16px;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border-color);
      vertical-align: middle;
    }

    .rate-table tbody tr:nth-child(even) { background: #fbfcfd; }
    .rate-table tbody tr:hover { background: #f6f8fa; }
    .rate-table tbody tr:last-child td { border-bottom: none; }

    .cvp-cell { font-weight: 700; }

    .rate-cell {
      text-align: center;
      border-left: 1px solid var(--border-color);
      min-width: 64px;
      font-weight: 600;
    }

    /* Pagination footer (bottom-right) */
    .table-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 16px;
      border-top: 1px solid var(--border-color);
      background: #fbfbfc;
    }

        .results-summary {
      color: var(--text-muted);
      font-size: 12px;
      font-weight: 700;
      white-space: nowrap;
    }

.page-size {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-muted);
      font-size: 12px;
      font-weight: 700;
    }

    .page-size select {
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 6px 10px;
      font-size: 12px;
      font-weight: 700;
      background: #fff;
    }

    .pagination .page-link {
      border-radius: 10px !important;
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-weight: 700;
      font-size: 12px;
    }
    .pagination .page-item.active .page-link {
      background: var(--td-green);
      border-color: var(--td-green);
      color: #fff;
    }
    .pagination .page-link:focus { box-shadow: 0 0 0 3px var(--td-green-light); }

    /* Tier hide helper (applied by JS) */
    .tier-hidden { display: none !important; }

    /* Responsive */
    @media (max-width: 1200px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .filter-panel { width: 220px; }
    }
    @media (max-width: 992px) {
      .main-layout { flex-direction: column; }
      .filter-panel { width: 100%; }
      .filter-card { position: static; }
    }
    @media (max-width: 768px) {
      .stats-grid { grid-template-columns: 1fr; }
      .content-area { padding: 16px; }
      .search-actions-row { flex-direction: column; align-items: stretch; }
      .action-buttons { justify-content: space-between; }
    }

/* Filter bar on top */
    .filter-bar{
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      box-shadow: var(--shadow-sm);
      padding: 16px;
      margin-top: 10px;
    }
    .filter-bar .filter-section{ margin-bottom: 0; }
    .filter-bar .filter-label{ margin-bottom: 8px; }
    .filter-bar .filter-search{
      max-width: 760px;
      margin: 0 auto;
      flex: unset;
    }

    /* Full width table (no side layout) */
    .table-section{ margin-top: 14px; }

    /* Page wrapper (no sidebar for this CRUD page) */
    .page-wrap {
      max-width: 1320px;
      margin: 0 auto;
      padding: 22px 20px 40px 20px;
    }

    .header-row {
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 16px;
      margin-bottom: 14px;
    }

    .muted {
      color: var(--text-muted);
    }

    /* Tabs */
    .td-tabs {
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 18px;
    }
    .td-tabs .nav-link {
      color: var(--text-secondary);
      font-weight: 700;
      font-size: 13px;
      padding: 12px 14px;
      border: none;
      border-bottom: 2px solid transparent;
      border-radius: 0;
      background: transparent;
    }
    .td-tabs .nav-link:hover {
      color: var(--text-primary);
      background: #f7f8fa;
      border-bottom-color: transparent;
    }
    .td-tabs .nav-link.active {
      color: var(--td-green);
      background: transparent;
      border-bottom: 2px solid var(--td-green);
    }

    /* CRUD card wrapper */
    .crud-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      box-shadow: var(--shadow-sm);
      padding: 16px;
    }

    .crud-title {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 14px;
    }
    .crud-title h2 {
      margin: 0;
      font-size: 16px;
      font-weight: 800;
      color: var(--text-primary);
    }
    .crud-title .hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 2px;
      font-weight: 600;
    }

    /* Small filter row */
    .quick-filters {
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    .quick-filters .form-select {
      border-radius: 10px;
      border-color: var(--border-color);
      font-size: 13px;
      padding: 9px 12px;
    }

    /* Action buttons inside rows */
    .row-actions {
      display:flex;
      gap: 8px;
      justify-content:flex-end;
      flex-wrap: nowrap;
    }
    .btn-row {
      border-radius: 10px;
      padding: 8px 12px;
      font-size: 13px;
      font-weight: 700;
      border: 1px solid var(--border-color);
      background: #fff;
      color: var(--text-secondary);
      display:flex;
      align-items:center;
      gap: 8px;
      transition: all var(--transition-fast);
      white-space: nowrap;
    }
    .btn-row:hover {
      background:#f7f8fa;
      color: var(--text-primary);
      border-color:#d1d5db;
    }
    .btn-row.edit {
      border-color: rgba(0,138,0,0.35);
      color: var(--td-green);
    }
    .btn-row.edit:hover {
      background: var(--td-green-light);
      border-color: rgba(0,138,0,0.45);
    }
    .btn-row.delete {
      border-color: rgba(220,38,38,0.35);
      color: #dc2626;
    }
    .btn-row.delete:hover {
      background: #fff1f2;
      border-color: rgba(220,38,38,0.45);
    }

    /* Make tables readable on wide schemas */
    .rate-table {
      min-width: 980px;
    }
    .rate-table td {
      vertical-align: middle;
    }

    /* Modal polish */
    .modal-content {
      border-radius: 14px;
      border: 1px solid var(--border-color);
      box-shadow: 0 20px 40px rgba(0,0,0,0.16);
    }
    .modal-header {
      border-bottom: 1px solid var(--border-color);
      padding: 14px 16px;
    }
    .modal-title {
      font-weight: 900;
      font-size: 15px;
    }
    .modal-body {
      padding: 16px;
    }
    .modal-footer {
      border-top: 1px solid var(--border-color);
      padding: 14px 16px;
    }
    .form-label {
      font-size: 12px;
      font-weight: 800;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    .form-control, .form-select, textarea {
      border-radius: 10px;
      border-color: var(--border-color);
      font-size: 13px;
      padding: 10px 12px;
    }
    .form-control:focus, .form-select:focus, textarea:focus {
      border-color: var(--td-green);
      box-shadow: 0 0 0 3px var(--td-green-light);
    }
    .sys-note {
      font-size: 11px;
      color: var(--text-muted);
      font-weight: 600;
      margin-top: 6px;
    }

    @media (max-width: 768px) {
      .rate-table { min-width: 860px; }
      .crud-card { padding: 14px; }
    }
  </style>
</head>

<body>
  <div class="page-wrap">
    <div class="header-row">
      <div>
        <div class="page-title"><i class="fa-solid fa-table-list"></i> Master Data (CRUD)</div>
        <div class="page-subtitle">Category, Subcategory, Product, Amount Tier, and CVP Code — consistent CRUD layout with search, upload, create, edit, delete.</div>
      </div>
      <div class="header-actions">
        <button class="btn-icon" type="button" title="Help">
          <i class="fa-regular fa-circle-question"></i>
        </button>
      </div>
    </div>

    <ul class="nav td-tabs" id="masterTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="tab-category" data-bs-toggle="tab" data-bs-target="#pane-category" type="button" role="tab">
          <i class="fa-solid fa-folder-tree me-2"></i>Category
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="tab-subcategory" data-bs-toggle="tab" data-bs-target="#pane-subcategory" type="button" role="tab">
          <i class="fa-solid fa-sitemap me-2"></i>Subcategory
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="tab-product" data-bs-toggle="tab" data-bs-target="#pane-product" type="button" role="tab">
          <i class="fa-solid fa-cubes me-2"></i>Product
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="tab-amounttier" data-bs-toggle="tab" data-bs-target="#pane-amounttier" type="button" role="tab">
          <i class="fa-solid fa-layer-group me-2"></i>Amount Tier
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="tab-cvp" data-bs-toggle="tab" data-bs-target="#pane-cvp" type="button" role="tab">
          <i class="fa-solid fa-code me-2"></i>CVP Code
        </button>
      </li>
    </ul>

    <div class="tab-content" id="masterTabsContent">
      <div class="tab-pane fade show active" id="pane-category" role="tabpanel" aria-labelledby="tab-category"></div>
      <div class="tab-pane fade" id="pane-subcategory" role="tabpanel" aria-labelledby="tab-subcategory"></div>
      <div class="tab-pane fade" id="pane-product" role="tabpanel" aria-labelledby="tab-product"></div>
      <div class="tab-pane fade" id="pane-amounttier" role="tabpanel" aria-labelledby="tab-amounttier"></div>
      <div class="tab-pane fade" id="pane-cvp" role="tabpanel" aria-labelledby="tab-cvp"></div>
    </div>
  </div>

  <!-- Create/Edit Modal -->
  <div class="modal fade" id="crudModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <div>
            <div class="modal-title" id="crudModalTitle">Create</div>
            <div class="sys-note" id="crudModalSubtitle">Enter fields and submit.</div>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <form id="crudForm">
          <div class="modal-body">
            <div class="row g-3" id="crudFormFields"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn-action" data-bs-dismiss="modal">
              <i class="fa-solid fa-xmark"></i> Cancel
            </button>
            <button type="submit" class="btn-action primary" id="crudSubmitBtn">
              <i class="fa-solid fa-check"></i> Submit
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete Confirm Modal -->
  <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">Confirm delete</div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="text-secondary fw-semibold" id="deleteText">Are you sure?</div>
          <div class="sys-note mt-2">This is a UI demo. Replace with your API call.</div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-action" data-bs-dismiss="modal">
            <i class="fa-solid fa-xmark"></i> Cancel
          </button>
          <button type="button" class="btn-action primary" id="deleteConfirmBtn">
            <i class="fa-solid fa-trash"></i> Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ---------- Demo Data (replace with API) ----------
    const dataStore = {
      category: [
        { id: "CAT-001", name: "Unsecured LOC", detail: "Standard ULOC products", active: true, createdBy: "system", createdOn: "2026-01-01", updatedBy: "admin", updatedOn: "2026-01-15", version: 3 },
        { id: "CAT-002", name: "Investment LOC", detail: "ILOC products", active: true, createdBy: "system", createdOn: "2026-01-02", updatedBy: "admin", updatedOn: "2026-01-18", version: 2 }
      ],
      subcategory: [
        { id: "SUB-101", categoryId: "CAT-001", name: "ULOC - Prime Based", detail: "Prime + spread", active: true, createdBy: "system", createdOn: "2026-01-05", updatedBy: "reviewer", updatedOn: "2026-01-20", version: 1 },
        { id: "SUB-102", categoryId: "CAT-002", name: "ILOC - Secured", detail: "Secured investment LOC", active: true, createdBy: "system", createdOn: "2026-01-06", updatedBy: "reviewer", updatedOn: "2026-01-21", version: 1 }
      ],
      product: [
        { id: "PRD-01", name: "ULOC Regular", type: "ULOC", securityCode: "ULOC-R", detail: "Regular ULOC product", active: true, createdBy: "system", createdOn: "2026-01-03", updatedBy: "admin", updatedOn: "2026-01-19", version: 5 },
        { id: "PRD-02", name: "ILOC Regular", type: "ILOC", securityCode: "ILOC-R", detail: "Regular ILOC product", active: true, createdBy: "system", createdOn: "2026-01-04", updatedBy: "admin", updatedOn: "2026-01-19", version: 4 }
      ],
      amounttier: [
        { id: "TIER-1", productId: "PRD-01", name: "$5k–$25k", detail: "Entry tier", active: true, min: 5000, max: 25000, createdBy: "system", createdOn: "2026-01-07", updatedBy: "admin", updatedOn: "2026-01-21", version: 1 },
        { id: "TIER-2", productId: "PRD-01", name: "$25k–$100k", detail: "Mid tier", active: true, min: 25000, max: 100000, createdBy: "system", createdOn: "2026-01-07", updatedBy: "admin", updatedOn: "2026-01-21", version: 1 }
      ],
      cvp: [
        { id: "CVP-9001", subCategoryId: "SUB-101", name: "CVP-A", detail: "Standard profile", active: true, createdBy: "system", createdOn: "2026-01-08", updatedBy: "admin", updatedOn: "2026-01-22", version: 2 },
        { id: "CVP-9002", subCategoryId: "SUB-102", name: "CVP-B", detail: "Enhanced profile", active: true, createdBy: "system", createdOn: "2026-01-08", updatedBy: "admin", updatedOn: "2026-01-22", version: 1 }
      ]
    };

    // ---------- Schema / Columns ----------
    const schemas = {
      category: {
        title: "Category",
        subtitle: "Manage Category master data",
        searchPlaceholder: "Search by name, detail, status...",
        columns: [
          ["id","ID"], ["name","Name"], ["detail","Detail"], ["active","Active"],
          ["createdBy","Created By"], ["createdOn","Created On"], ["updatedBy","Updated By"],
          ["updatedOn","Updated On"], ["version","Version"]
        ],
        fields: [
          { key:"id", label:"ID", type:"text" },
          { key:"name", label:"Name", type:"text" },
          { key:"detail", label:"Detail", type:"textarea" },
          { key:"active", label:"Active", type:"select_bool" },
          { key:"createdBy", label:"Created By", type:"text" },
          { key:"createdOn", label:"Created On", type:"date" },
          { key:"updatedBy", label:"Updated By", type:"text" },
          { key:"updatedOn", label:"Updated On", type:"date" },
          { key:"version", label:"Version", type:"number" }
        ]
      },
      subcategory: {
        title: "Subcategory",
        subtitle: "Manage Subcategory master data",
        searchPlaceholder: "Search by name, category, detail, status...",
        columns: [
          ["id","ID"], ["categoryId","Category ID"], ["name","Name"], ["detail","Detail"], ["active","Active"],
          ["createdBy","Created By"], ["createdOn","Created On"], ["updatedBy","Updated By"],
          ["updatedOn","Updated On"], ["version","Version"]
        ],
        fields: [
          { key:"id", label:"ID", type:"text" },
          { key:"categoryId", label:"Category", type:"select_category" },
          { key:"name", label:"Name", type:"text" },
          { key:"detail", label:"Detail", type:"textarea" },
          { key:"active", label:"Active", type:"select_bool" },
          { key:"createdBy", label:"Created By", type:"text" },
          { key:"createdOn", label:"Created On", type:"date" },
          { key:"updatedBy", label:"Updated By", type:"text" },
          { key:"updatedOn", label:"Updated On", type:"date" },
          { key:"version", label:"Version", type:"number" }
        ]
      },
      product: {
        title: "Product",
        subtitle: "Manage Product master data",
        searchPlaceholder: "Search by name, type, security code, status...",
        columns: [
          ["id","ID"], ["name","Name"], ["type","Type"], ["securityCode","Security Code"],
          ["detail","Detail"], ["active","Active"], ["createdBy","Created By"], ["createdOn","Created On"],
          ["updatedBy","Updated By"], ["updatedOn","Updated On"], ["version","Version"]
        ],
        fields: [
          { key:"id", label:"ID", type:"text" },
          { key:"name", label:"Name", type:"text" },
          { key:"type", label:"Type", type:"select_product_type" },
          { key:"securityCode", label:"Security Code", type:"text" },
          { key:"detail", label:"Detail", type:"textarea" },
          { key:"active", label:"Active", type:"select_bool" },
          { key:"createdBy", label:"Created By", type:"text" },
          { key:"createdOn", label:"Created On", type:"date" },
          { key:"updatedBy", label:"Updated By", type:"text" },
          { key:"updatedOn", label:"Updated On", type:"date" },
          { key:"version", label:"Version", type:"number" }
        ]
      },
      amounttier: {
        title: "Amount Tier",
        subtitle: "Manage Amount Tier master data",
        searchPlaceholder: "Search by name, product, min/max, status...",
        columns: [
          ["id","ID"], ["productId","Product ID"], ["name","Name"], ["detail","Detail"], ["active","Active"],
          ["min","Min"], ["max","Max"], ["createdBy","Created By"], ["createdOn","Created On"],
          ["updatedBy","Updated By"], ["updatedOn","Updated On"], ["version","Version"]
        ],
        fields: [
          { key:"id", label:"ID", type:"text" },
          { key:"productId", label:"Product", type:"select_product" },
          { key:"name", label:"Name", type:"text" },
          { key:"detail", label:"Detail", type:"textarea" },
          { key:"active", label:"Active", type:"select_bool" },
          { key:"min", label:"Min", type:"number" },
          { key:"max", label:"Max", type:"number" },
          { key:"createdBy", label:"Created By", type:"text" },
          { key:"createdOn", label:"Created On", type:"date" },
          { key:"updatedBy", label:"Updated By", type:"text" },
          { key:"updatedOn", label:"Updated On", type:"date" },
          { key:"version", label:"Version", type:"number" }
        ]
      },
      cvp: {
        title: "CVP Code",
        subtitle: "Manage CVP Code master data",
        searchPlaceholder: "Search by CVP code, subcategory, detail, status...",
        columns: [
          ["id","ID"], ["subCategoryId","Subcategory ID"], ["name","Name"], ["detail","Detail"], ["active","Active"],
          ["createdBy","Created By"], ["createdOn","Created On"], ["updatedBy","Updated By"],
          ["updatedOn","Updated On"], ["version","Version"]
        ],
        fields: [
          { key:"id", label:"ID", type:"text" },
          { key:"subCategoryId", label:"Subcategory", type:"select_subcategory" },
          { key:"name", label:"Name", type:"text" },
          { key:"detail", label:"Detail", type:"textarea" },
          { key:"active", label:"Active", type:"select_bool" },
          { key:"createdBy", label:"Created By", type:"text" },
          { key:"createdOn", label:"Created On", type:"date" },
          { key:"updatedBy", label:"Updated By", type:"text" },
          { key:"updatedOn", label:"Updated On", type:"date" },
          { key:"version", label:"Version", type:"number" }
        ]
      }
    };

    // ---------- UI State ----------
    const state = {
      category: { q:"", status:"all", page:1, pageSize:10 },
      subcategory: { q:"", status:"all", page:1, pageSize:10 },
      product: { q:"", status:"all", page:1, pageSize:10 },
      amounttier: { q:"", status:"all", page:1, pageSize:10 },
      cvp: { q:"", status:"all", page:1, pageSize:10 }
    };

    let activeEntity = "category";
    let deleteEntity = null;
    let deleteId = null;

    const crudModalEl = document.getElementById("crudModal");
    const crudModal = new bootstrap.Modal(crudModalEl);
    const deleteModal = new bootstrap.Modal(document.getElementById("deleteModal"));

    // ---------- Helpers ----------
    function boolBadge(v) {
      return v ? '<span class="badge text-bg-success">active</span>' : '<span class="badge text-bg-secondary">inactive</span>';
    }

    function escapeHtml(str) {
      if (str === null || str === undefined) return "";
      return String(str).replace(/[&<>"']/g, (m) => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"}[m]));
    }

    function filterRows(entity) {
      const q = (state[entity].q || "").trim().toLowerCase();
      const st = state[entity].status;
      return dataStore[entity].filter(r => {
        const hay = JSON.stringify(r).toLowerCase();
        const matchQ = q ? hay.includes(q) : true;
        const matchS = (st === "all") ? true : (st === "active" ? !!r.active : !r.active);
        return matchQ && matchS;
      });
    }

    function paginate(rows, entity) {
      const pageSize = state[entity].pageSize;
      const total = rows.length;
      const totalPages = Math.max(1, Math.ceil(total / pageSize));
      const page = Math.min(state[entity].page, totalPages);
      state[entity].page = page;

      const startIdx = (page - 1) * pageSize;
      const endIdx = Math.min(startIdx + pageSize, total);
      const slice = rows.slice(startIdx, endIdx);
      return { slice, total, totalPages, startIdx, endIdx };
    }

    function paginationHtml(entity, totalPages) {
      const p = state[entity].page;

      const btn = (label, targetPage, disabled=false, icon=null) => `
        <button class="page-btn ${disabled ? "disabled":""}" ${disabled ? "disabled":""} data-entity="${entity}" data-page="${targetPage}">
          ${icon ? `<i class="fa-solid ${icon}"></i>` : ""} ${label}
        </button>
      `;

      const nums = [];
      const windowSize = 5;
      let start = Math.max(1, p - 2);
      let end = Math.min(totalPages, start + windowSize - 1);
      start = Math.max(1, end - windowSize + 1);

      for (let i = start; i <= end; i++) {
        nums.push(`<button class="page-num ${i===p ? "active":""}" data-entity="${entity}" data-page="${i}">${i}</button>`);
      }

      return `
        <div class="pager">
          ${btn("First", 1, p===1, "fa-angles-left")}
          ${btn("Previous", Math.max(1,p-1), p===1, "fa-angle-left")}
          <div class="page-nums">${nums.join("")}</div>
          ${btn("Next", Math.min(totalPages,p+1), p===totalPages, "fa-angle-right")}
          ${btn("Last", totalPages, p===totalPages, "fa-angles-right")}
        </div>
      `;
    }

    // ---------- Render ----------
    function renderEntity(entity) {
      const schema = schemas[entity];
      const rowsAll = filterRows(entity);
      const { slice, total, totalPages, startIdx, endIdx } = paginate(rowsAll, entity);

      const pane = document.getElementById(`pane-${entity}`);
      pane.innerHTML = `
        <div class="crud-card">
          <div class="crud-title">
            <div>
              <h2>${schema.title}</h2>
              <div class="hint">${schema.subtitle}</div>
            </div>
          </div>

          <div class="search-actions-row">
            <div class="search-container">
              <i class="fa-solid fa-magnifying-glass"></i>
              <input id="${entity}-search" type="text" value="${escapeHtml(state[entity].q)}" placeholder="${escapeHtml(schema.searchPlaceholder)}"/>
            </div>

            <div class="action-buttons">
              <button class="btn-action" type="button" data-action="upload" data-entity="${entity}">
                <i class="fa-solid fa-upload"></i> Upload
              </button>
              <button class="btn-action primary" type="button" data-action="create" data-entity="${entity}">
                <i class="fa-solid fa-plus"></i> Create
              </button>
              <input type="file" id="${entity}-file" class="d-none" />
            </div>
          </div>

          <div class="quick-filters">
            <select class="form-select" style="max-width: 200px;" data-filter="status" data-entity="${entity}">
              <option value="all" ${state[entity].status==="all"?"selected":""}>Status: All</option>
              <option value="active" ${state[entity].status==="active"?"selected":""}>Status: Active</option>
              <option value="inactive" ${state[entity].status==="inactive"?"selected":""}>Status: Inactive</option>
            </select>
            <select class="form-select" style="max-width: 180px;" data-filter="pagesize" data-entity="${entity}">
              <option value="10" ${state[entity].pageSize===10?"selected":""}>Rows: 10</option>
              <option value="15" ${state[entity].pageSize===15?"selected":""}>Rows: 15</option>
              <option value="25" ${state[entity].pageSize===25?"selected":""}>Rows: 25</option>
              <option value="50" ${state[entity].pageSize===50?"selected":""}>Rows: 50</option>
            </select>
          </div>

          <div class="table-card">
            <div class="table-container">
              <table class="rate-table">
                <thead>
                  <tr>
                    ${schema.columns.map(c => `<th>${c[1]}</th>`).join("")}
                    <th style="text-align:right;">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  ${
                    slice.length ? slice.map((r) => `
                      <tr>
                        ${schema.columns.map(c => {
                          const k = c[0];
                          const v = r[k];
                          if (k === "active") return `<td>${boolBadge(!!v)}</td>`;
                          return `<td title="${escapeHtml(v)}">${escapeHtml(v)}</td>`;
                        }).join("")}
                        <td style="text-align:right;">
                          <div class="row-actions">
                            <button class="btn-row edit" type="button" data-action="edit" data-entity="${entity}" data-id="${escapeHtml(r.id)}">
                              <i class="fa-regular fa-pen-to-square"></i> Edit
                            </button>
                            <button class="btn-row delete" type="button" data-action="delete" data-entity="${entity}" data-id="${escapeHtml(r.id)}">
                              <i class="fa-regular fa-trash-can"></i> Delete
                            </button>
                          </div>
                        </td>
                      </tr>
                    `).join("") : `
                      <tr>
                        <td colspan="${schema.columns.length + 1}" class="text-center text-secondary fw-semibold" style="padding: 18px;">
                          No records found.
                        </td>
                      </tr>
                    `
                  }
                </tbody>
              </table>
            </div>

            <div class="table-footer">
              <div class="footer-left">
                <span class="muted fw-semibold">
                  Showing ${total ? (startIdx+1) : 0}–${endIdx} of ${total}
                </span>
              </div>
              <div class="footer-right">
                ${paginationHtml(entity, totalPages)}
              </div>
            </div>
          </div>
        </div>
      `;

      const searchInput = document.getElementById(`${entity}-search`);
      searchInput.addEventListener("input", (e) => {
        state[entity].q = e.target.value || "";
        state[entity].page = 1;
        renderEntity(entity);
      });
    }

    // ---------- Modal Field Builder ----------
    function optionList(items, valueKey, labelKey, selectedValue) {
      return items.map(it => {
        const v = it[valueKey];
        const l = it[labelKey];
        return `<option value="${escapeHtml(v)}" ${String(v)===String(selectedValue) ? "selected":""}>${escapeHtml(l)} (${escapeHtml(v)})</option>`;
      }).join("");
    }

    function buildField(entity, field, value) {
      const key = field.key;
      const id = `f-${key}`;
      const label = field.label;

      if (field.type === "select_bool") {
        return `
          <div class="col-12 col-md-6">
            <label class="form-label" for="${id}">${label}</label>
            <select class="form-select" id="${id}" name="${key}">
              <option value="true" ${(value===true || value==="true") ? "selected":""}>Active</option>
              <option value="false" ${(value===false || value==="false") ? "selected":""}>Inactive</option>
            </select>
          </div>
        `;
      }

      if (field.type === "select_category") {
        const opts = optionList(dataStore.category, "id", "name", value);
        return `
          <div class="col-12 col-md-6">
            <label class="form-label" for="${id}">${label}</label>
            <select class="form-select" id="${id}" name="${key}">
              <option value="">Select category</option>
              ${opts}
            </select>
          </div>
        `;
      }

      if (field.type === "select_subcategory") {
        const opts = optionList(dataStore.subcategory, "id", "name", value);
        return `
          <div class="col-12 col-md-6">
            <label class="form-label" for="${id}">${label}</label>
            <select class="form-select" id="${id}" name="${key}">
              <option value="">Select subcategory</option>
              ${opts}
            </select>
          </div>
        `;
      }

      if (field.type === "select_product") {
        const opts = optionList(dataStore.product, "id", "name", value);
        return `
          <div class="col-12 col-md-6">
            <label class="form-label" for="${id}">${label}</label>
            <select class="form-select" id="${id}" name="${key}">
              <option value="">Select product</option>
              ${opts}
            </select>
          </div>
        `;
      }

      if (field.type === "select_product_type") {
        const types = ["ULOC","ILOC","SLOC","OTHER"];
        return `
          <div class="col-12 col-md-6">
            <label class="form-label" for="${id}">${label}</label>
            <select class="form-select" id="${id}" name="${key}">
              ${types.map(t => `<option value="${t}" ${String(value)===t?"selected":""}>${t}</option>`).join("")}
            </select>
          </div>
        `;
      }

      if (field.type === "textarea") {
        return `
          <div class="col-12">
            <label class="form-label" for="${id}">${label}</label>
            <textarea class="form-control" id="${id}" name="${key}" rows="3" placeholder="Enter ${label.toLowerCase()}">${escapeHtml(value||"")}</textarea>
          </div>
        `;
      }

      const inputType = field.type === "date" ? "date" : (field.type === "number" ? "number" : "text");
      return `
        <div class="col-12 col-md-6">
          <label class="form-label" for="${id}">${label}</label>
          <input class="form-control" id="${id}" name="${key}" type="${inputType}" value="${escapeHtml(value||"")}"/>
        </div>
      `;
    }

    function openModal(entity, mode, row) {
      activeEntity = entity;

      const schema = schemas[entity];
      document.getElementById("crudModalTitle").textContent = `${mode === "create" ? "Create" : "Edit"} ${schema.title}`;
      document.getElementById("crudModalSubtitle").textContent = "Enter fields and submit.";
      document.getElementById("crudSubmitBtn").innerHTML = `<i class="fa-solid fa-check"></i> ${mode === "create" ? "Create" : "Save Changes"}`;

      const values = row || {};
      document.getElementById("crudFormFields").innerHTML = schema.fields.map(f => buildField(entity, f, values[f.key])).join("");

      crudModalEl.setAttribute("data-mode", mode);
      crudModalEl.setAttribute("data-edit-id", mode === "edit" ? row.id : "");
      crudModal.show();
    }

    function handleUpload(entity) {
      const inp = document.getElementById(`${entity}-file`);
      inp.click();
      inp.onchange = () => {
        alert("Upload clicked (demo). Wire to your upload API + parse file.");
        inp.value = "";
      };
    }

    function handleDelete(entity, id) {
      deleteEntity = entity;
      deleteId = id;
      document.getElementById("deleteText").textContent = `Delete ${schemas[entity].title} '${id}'?`;
      deleteModal.show();
    }

    document.getElementById("deleteConfirmBtn").addEventListener("click", () => {
      if (!deleteEntity || !deleteId) return;
      const idx = dataStore[deleteEntity].findIndex(r => String(r.id) === String(deleteId));
      if (idx >= 0) dataStore[deleteEntity].splice(idx, 1);
      deleteModal.hide();
      renderEntity(deleteEntity);
      deleteEntity = null;
      deleteId = null;
    });

    document.getElementById("crudForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const mode = crudModalEl.getAttribute("data-mode");
      const editId = crudModalEl.getAttribute("data-edit-id");

      const fd = new FormData(e.target);
      const obj = {};
      fd.forEach((v, k) => obj[k] = v);

      if ("active" in obj) obj.active = (obj.active === "true");
      ["min","max","version"].forEach(k => {
        if (k in obj && obj[k] !== "") obj[k] = Number(obj[k]);
      });

      if (mode === "create") {
        if (!obj.id) {
          const prefix = { category:"CAT", subcategory:"SUB", product:"PRD", amounttier:"TIER", cvp:"CVP" }[activeEntity] || "ID";
          obj.id = `${prefix}-${Math.floor(Math.random()*9000 + 1000)}`;
        }
        dataStore[activeEntity].unshift(obj);
      } else {
        const idx = dataStore[activeEntity].findIndex(r => String(r.id) === String(editId));
        if (idx >= 0) dataStore[activeEntity][idx] = { ...dataStore[activeEntity][idx], ...obj };
      }

      crudModal.hide();
      renderEntity(activeEntity);
    });

    document.addEventListener("click", (e) => {
      const t = e.target.closest("[data-action]");
      if (t) {
        const action = t.getAttribute("data-action");
        const entity = t.getAttribute("data-entity");
        const id = t.getAttribute("data-id");

        if (action === "create") openModal(entity, "create", null);
        if (action === "upload") handleUpload(entity);
        if (action === "edit") {
          const row = dataStore[entity].find(r => String(r.id) === String(id));
          if (row) openModal(entity, "edit", row);
        }
        if (action === "delete") handleDelete(entity, id);
      }

      const pbtn = e.target.closest("[data-page]");
      if (pbtn && (pbtn.classList.contains("page-btn") || pbtn.classList.contains("page-num"))) {
        const entity = pbtn.getAttribute("data-entity");
        const page = Number(pbtn.getAttribute("data-page") || "1");
        state[entity].page = page;
        renderEntity(entity);
      }

      const filter = e.target.closest("[data-filter]");
      if (filter) {
        const entity = filter.getAttribute("data-entity");
        const f = filter.getAttribute("data-filter");
        if (f === "status") {
          state[entity].status = filter.value;
          state[entity].page = 1;
          renderEntity(entity);
        }
        if (f === "pagesize") {
          state[entity].pageSize = Number(filter.value);
          state[entity].page = 1;
          renderEntity(entity);
        }
      }
    });

    // Initial render
    ["category","subcategory","product","amounttier","cvp"].forEach(renderEntity);
  </script>

  <style>
    /* Pager styles */
    .pager { display:flex; align-items:center; gap: 8px; }
    .page-btn {
      border: 1px solid var(--border-color);
      background: #fff;
      color: var(--text-secondary);
      border-radius: 10px;
      padding: 8px 12px;
      font-size: 13px;
      font-weight: 700;
      display:flex;
      align-items:center;
      gap: 8px;
      transition: all var(--transition-fast);
      white-space: nowrap;
    }
    .page-btn:hover { background:#f7f8fa; color: var(--text-primary); border-color:#d1d5db; }
    .page-btn.disabled { opacity: 0.45; pointer-events:none; }
    .page-nums {
      display:flex;
      align-items:center;
      gap: 6px;
      padding: 6px;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      background: #fff;
    }
    .page-num {
      width: 34px;
      height: 34px;
      border-radius: 10px;
      border: 1px solid transparent;
      background: transparent;
      font-size: 13px;
      font-weight: 800;
      color: var(--text-secondary);
      transition: all var(--transition-fast);
    }
    .page-num:hover { background:#f7f8fa; color: var(--text-primary); }
    .page-num.active { background: var(--td-green); color:#fff; border-color: var(--td-green); }
  </style>
</body>
</html>
